How to stream files from Next.js Route Handlers | Eric Burel Tech Blog

Eric Burel dot Tech

[Home](/)[Blog](/blog)[Work](/publications)

{"@context":"https://schema.org","@type":"BlogPosting","headline":"How to stream files from Next.js Route Handlers","datePublished":"2024-01-31","dateModified":"2024-01-31","description":"Learn how the Route Handlers paradigm affects file streaming in Next.js","image":"https://www.ericburel.tech/posts/nextjs-stream-files/filestream.png","url":"https://www.ericburel.tech/blog/nextjs-stream-files","author":{"@type":"Person","name":"Eric Burel"}}

How to stream files from Next.js Route Handlers
===============================================

January 31, 2024 (last year)

![Cover image](/posts/nextjs-stream-files/filestream.png)

Well, I've tried hard to write a catchy introduction, explaining why files are so important in a developer's life and that you should definitely read this article.

But the thing is that unless you just got out of a time machine, I am pretty sure you already now what a file is, that files are important for computers, and that files can be big.

So let's skip it the babbling and dive directly into the question that bothers you : how to stream files from Next.js Route Handlers.

You will learn:

*   How to serve big files with Next.js without bloating your RAM, using API Routes and Route Handlers
*   What are streams in Node.js and the browser
*   The philosophical differences between API Routes and Route Handlers

> **UPDATE: I've just released a live demo of this pattern on [NextPatterns.dev](https://nextpatterns.dev/p/gems/route-handlers-file-streaming)!**

[](#why-using-an-api-endpoint-to-serve-files-rather-than-the-public-folder)Why using an API endpoint to serve files, rather than the "public" folder?
-----------------------------------------------------------------------------------------------------------------------------------------------------

In Node.js applications, we traditionally use a "public" folder to serve files, like images, fonts, vendor scripts or the latest version of your resume in PDF.

In Express.js, the public folder is setup in a single line of code ([documented here](https://expressjs.com/en/starter/static-files.html)):

```js
app.use(express.static('public'))
```

In Next.js, this is done in 0 lines of code, because [it works out of the box](https://nextjs.org/docs/pages/building-your-application/optimizing/static-assets).

However this works only for public, generic files. Next.js calls them "static assets". Yet, some files are neither public nor generic or static.

Some counter-examples that don't fit the public folder:

*   Personalized files: a generic url "/user/profile-picture" may serve a different image depending on the currently logged user
*   Private files: you may want to check some permissions before serving "extremely\_confidential\_report.docx"
*   Generated files: the State of JavaScript administration app can generate CSV exports of the responses to the survey. This means we generate the file on the fly depending on the selected survey when we receive an export request.

For these files, you need to craft an API endpoint that returns the content of the file. **Let's do that.**

[](#how-to-serve-files-in-nextjs-with-route-handlers-the-easy-way)How to serve files in Next.js with Route Handlers, the easy way
---------------------------------------------------------------------------------------------------------------------------------

The easy way to serve files is to load them in memory and then return the result. Here is the full-code that you may copy-paste to create a new route handler.

```ts
// File "app/api/serve-file/route.ts" 
// (This file is a Next.js 13+ Route Handler)

// fs/promises gives a nice async/await syntax
import fsPromises from "fs/promises" 

// "Request" type doesn't have to be imported, 
// it's part of the web platform API and available in Node.js too
export const GET = (req: Request) => {
  // I suppose the file exists to simplify the code
  const filePath = "/tmp/some-file.zip"
  const stats = await fsPromises.stat(filePath);
  // read your file
  const fileContent = await fsPromises.readFile(filePath)
  // and serve it by returning a response
  return new Response(
      fileContent, 
      {
        status: 200,
        headers: new Headers({
          // this optional header triggers a download in the browser
          "content-disposition": `attachment; filename=${
            path.basename(filePath)
            }`,
          "content-type": "application/zip",
          "content-length": stats.size + "",
      })
    })
}
```

> Sometimes, instead of `Request` and `Response`, you'll see `NextResponse` and `NextRequest`. The Next versions are just wrappers around native `Response` and `Request` objects. They provide a few helpers like the parsed URL in the `nextUrl` field.

This is an intuitive solution, totally fine if you operate at a small scale.

But the problem is that you have to load the whole file in memory before returning it.

This is not good if the file is very big. Even if the file is small, if you have a high number of requests, this will also bloat your RAM.

```ts
// this "data" variable comes at a cost for big files!
// it copies the whole file in the server memory
const data = await fsPromises.readFile(filePath)
```

The solution to this limitation consists in streaming the file. It will be read in chunks that are immediately sent to the end user, which reduces the pressure on your server's RAM.

[](#2024-update-one-liner-solution)2024 UPDATE : one-liner solution
-------------------------------------------------------------------

A new API has been brought to my attention lately (thanks [Karl Horky!](https://github.com/karlhorky)): [`filehandle.readableWebStream`](https://nodejs.org/docs/v20.16.0/api/fs.html#filehandlereadablewebstreamoptions).

It's an experimental Node.js feature that solves our issue in a single line of code:

```ts
const fileHandle = await fs.open(filePath)
const stream = fileHandle.readableWebStream({ type: "bytes" })
return new Response(stream)
```

The remainder of this article describes alternative methods that works outside of Node.js.

[](#how-to-stream-big-files-the-old-way-with-api-routes-nextjs-9)How to stream big files, the old way with API routes (Next.js 9+)
----------------------------------------------------------------------------------------------------------------------------------

Let's start with the traditional solution, using Next.js API Routes from the "Page Router" (aka the "pages" folder). Here is how you would stream files in an API Route, without copying them in memory.

This is similar to what you could find in a typical Express application.

```ts
// File "pages/api/serve-file.ts" 
// <- It's a good ol' Next.js 9+ API route
import { NextApiRequest, NextApiResponse } from 'next'

export default async function serveFile(
  req: NextApiRequest, res: NextApiResponse){
  const filePath = "/tmp/some-file.zip";
  const stats = await fsPromises.stat(filePath);
    res.writeHead(200, {
      "Content-Disposition": 
      `attachment; filename=${path.basename(
        filePath
      )}`,
      "Content-Type": "application/zip",
      "Content-Length": stats.size,
    });
    await new Promise(function (resolve) {
      const nodeStream = fs.createReadStream(filePath);
      nodeStream.pipe(res);
      nodeStream.on("end", resolve);
    });
}
```

> `NextApiRequest`/`NextApiResponse` are for API Routes (Next 9+), while `NextRequest` and `NextResponse` are for `Route Handlers` (Next 13+). They are totally different things, and not directly compatible! We'll explain this difference in the next section.

[](#moving-to-route-handlers-its-not-that-easy)Moving to route handlers: it's not that easy
-------------------------------------------------------------------------------------------

Now imagine that we want to move to route handlers, the new way of creating API endpoints brought by Next.js App Router.

Sadly, we can't copy-paste the code we wrote for the API Route into a Route Handler.

The problem is that the stream expected by Route Handlers, or more precisely by the `Response` constructor, is a "web platform stream". It is totally different from the `ReadStream` structure we use in API Routes, which is defined by Node.js `fs` package!

You cannot just pass the result of `fs.createReadStream` to a `Response` object. This means we need an additional conversion step.

```ts
// create a "ReadStream"  
const nodeStream = fs.createReadStream(filePath);
  // and pass it to a Response, which accepts a "ReadStream" object
  return new Response(
      // ❌ nope, that won't work! 
      // This is not the right type of "stream"!
      nodeStream, 
```

This is unsettling, a stream is a stream, so why does this fail?

[](#route-handlers-and-api-routes-are-built-on-different-paradigms)Route Handlers and API Routes are built on different paradigms
---------------------------------------------------------------------------------------------------------------------------------

The new Route Handlers differ quite a lot from traditional API Routes.

*   Next.js API Routes, which exist since version 9 and will be kept around likely forever, are based on Node.js. They are cousins to Express, that's why you can easily use Express middlewares and libraries, like Passport for authentication, in Next.js.
    
*   Route Handlers are newcomers brought by version 13. The main difference with API routes is that they are not strictly tied to Node.js. They will still use Node as the default runtime, but you can optionally use a lighter alternative called the "Edge Runtime". More broadly, this approach favors using JavaScript data structure that should exist in any runtime, be it Node.js, the Edge runtime, Deno, Bun or the runtime you are maybe building in your garage 'cause we need more.
    

That's why Route Handlers use generic `Response` and `Request` objects, that were originally designed for the browser `fetch` API.

Also, handlers use a different approach for "responding" to the user HTTP request. In an API route, you call `res.send`, or you pipe a stream to the `res` object. You don't need to return anything. In a Route Handler, you must return a `Response` object. Then Next.js takes care of turning that into an HTTP response.

Here is how the code will look like in each paradigm:

```ts
// API route style for basic JSON data
res.send({foo: "bar"})

// API route style for streaming files: 
// piping will send the HTTP response directly to the client
const nodeStream = fs.createReadStream(filePath);
nodeStream.pipe(res);

// Route Handler style for streaming: you return a Response object
// and Next takes care of actually send an HTTP response
// streamFile is the function we want to build in this article!
const webPlatformStream = streamFile(filePath)
return Response(webPlatformStream) // the return is important
```

I'd like to mention that you don't have to use Route Handlers at all if you don't want to!

API Routes are fine and will be fine in any forseeable future. Features brought by Next 13+ App Router are great, but they are also sharp and hard to use. It's totally safe to wait a year or even more before even getting started with them.

Now we understand why we have 2 different approaches. Route Handlers aim to be more generic than API routes, that are specific to Node.js.

Still, if we do want a route handler, this means we need to learn how to convert Node-specific structures into generic web platform structures, and it requires a bit of work. Let's see how to get things done for streaming files.

[](#from-nodejs-streams-to-web-platform-streams-via-generators)From Node.js streams to web platform streams via generators
--------------------------------------------------------------------------------------------------------------------------

So, our problem is that we need to convert a Node.js `fs.ReadStream` to a web platform `ReadableStream`. We also need to take the difference of syntaxes between both worlds.

When I first digged this issue, there was no documented solution, so I had to craft one. More precisely, I sewed various pieces of code found on Stack Overflow and Google (remember Lurch from the Adams Family? he's my fav). You can read the gory details on [Stack Overflow](https://stackoverflow.com/a/76780381/5513532).

Generators are a generic data structure in JavaScript, so it should be possible to use them as an intermediate language between Node and the web platform.

> I will use the terms generator and iterator interchangeably. Formally, you use a generator function to produce an iterator. More details in [Mozilla Developer documentation](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Guide/Iterators_and_generators).

So here is the pseudocode we want to implement:

1.  Convert `fs.ReadStream` (given by Node.js) to a JavaScript iterator
2.  Convert JavaScript iterator to`ReadableStream` (wanted by Next.js route handlers)

If that sounds tricky, this is because it is tricky. We are trying to establish a link between 2 completely different worlds, Node.js world and the web platform world. I mean, it's literally involving generators!

### [](#step-1-from-fsreadstream-to-iterator)Step 1: from fs.ReadStream to iterator

Here is a generator function that returns an iterator over an `fs.ReadStream`:

```ts
// Syntax taken from 
// https://github.com/MattMorgis/async-stream-generator
// itself taken from 
// https://nextjs.org/docs/app/building-your-application/routing/router-handlers#streaming
// probably itself taken from 
// https://nodejs.org/api/stream.html
// Always quote your sources!
async function* nodeStreamToIterator(stream: fs.ReadStream) {
    for await (const chunk of stream) {
        yield new Uint8Array(chunk);
    }
}
```

The `const chunk of stream` part read the file one chunk at a time. The `await` part is just there because reading a chunk of a file is an asynchronous operation, similarly to reading the whole file. This is possible because Node.js streams are [asynchronous iterators](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/AsyncIterator), so this syntax works on them.

You may not be used to iterators, but basically think of them as arrays of arbitrary size (even infinite) that you can read one value by one value. That's why you "yield" one chunk of data, instead of returning the whole file.

The `new Uint8Array` call is needed so your data get the proper encoding. I am serving binary files here, for text file you may want to use [TextEncoder](https://developer.mozilla.org/en-US/docs/Web/API/TextEncoder) instead. See [this GitHub ticket](https://github.com/vercel/next.js/issues/38736) for more info.

> In Node.js, streams are meant to be consumed primarily via events. According to Node.js documentation, setting a "data" event handler on a stream will make it flowing. You can also use the `pipe` method as demonstrate earlier. This explains why the iterator version is less common in the wild, yet it's better suited for our goal.

### [](#step-2-from-iterator-to-readablestream)Step 2: from iterator to ReadableStream

Now that we have an iterator, [Mozilla documentation](https://developer.mozilla.org/en-US/docs/Web/API/ReadableStream#convert_async_iterator_to_stream) shows us how to convert it into a web platform `ReadableStream`:

```ts
// Provided by Mozilla Developer documentation
// https://developer.mozilla.org/en-US/docs/Web/API/ReadableStream#convert_async_iterator_to_stream
// Please say thanks to Mozilla !!
function iteratorToStream(iterator) {
  return new ReadableStream({
    async pull(controller) {
      const { value, done } = await iterator.next();
      if (done) {
        controller.close();
      } else {
        controller.enqueue(value);
      }
    },
  });
}
```

### [](#plugging-the-functions-together)Plugging the functions together

So, we can convert a Node.js stream into an iterator, and an iterator into a web platform ReadableStream.

We are ready to craft our `streamFile` function, usable in Route Handlers!

```ts
// This finally turns a file path into a ReadableStream!
export function streamFile(path: string): ReadableStream {
    const nodeStream = fs.createReadStream(path);
    const data: ReadableStream = iteratorToStream(
        nodeStreamToIterator(
            nodeStream
        )
    )
    return data
}
```

You may notice that `createReadStream` is a Node.js function, so this code works only in Node.js despite returning a generic ReadableStream. It's not compatible with the Edge runtime.

That's completely normal. Route Handlers are meant to be compatible with different runtimes, however you still have to write runtime specific code anytime you actually want to do a non-trivial operation. If you use Deno, you will have Deno specific code.

Ideally, JavaScript would provide a generic function for opening files, that would return a  `ReadableStream` out of the box. However I am not aware of such an API. Ping me on [Twitter](https://twitter.com/ericbureltech) if you have more info than I do!

[](#serving-the-file-using-a-route-handler)Serving the file, using a Route Handler
----------------------------------------------------------------------------------

We've been so far into advanced JavaScript that we almost forgot the initial goal: we just wanted to stream a file in a route handler, to let the end user download something!

Obtaining a `ReadableStream` was the hardest part, now we just have to pass it to the `Response` object:

```ts
 // File "app/api/serve-file/route.ts"
 // This is the final code, 
 // reusing the "streamFile" helper
 // that we have crafted above
 const stats = await fsPromises.stat(filePath);
 const stream: ReadableStream = streamFile(filePath)
 return new Response(stream, {
   status: 200,
   headers: new Headers({
    "content-disposition": 
    `attachment; filename=${path.basename(
       filePath
     )}`,
    "content-type": "application/zip",
    "content-length": stats.size + "",
 })
```

You can see a real-file example usage in the [State of JavaScript codebase](https://github.com/Devographics/Monorepo/blob/e1179268188111380ccaaa0a134318273d9f6594/surveyadmin/src/app/api/data-export/route.ts), to download a CSV+JSON zip out of a Mongo database.

[](#recap-and-conclusion)Recap and conclusion
---------------------------------------------

Let's try to recap what we have learnt in this article:

*   Serving files via an API endpoint is necessary for custom, private or generated files
*   Using a stream is necessary to avoid bloating your server RAM, it avoids loading the whole file in memory and instead returns it as chunks
*   Next.js API routes are using Node.js syntax and data structure, it's easy to stream a file
*   Next.js Route handlers strive to rely on more generic JavaScript built-in structures, namely the `Request` and `Response` objects from the fetch API
*   We had to craft an helper to convert the stream produced by `fs.createReadStream(filePath)` , which is specific to Node.js, into a generic `ReadableStream`
*   Finally, we can pass the converted stream to the `Response` object. Tada!

Thanks [@rohithandique](https://github.com/rohithandique) for the feedback [on Next.js GitHub](https://github.com/vercel/next.js/discussions/15453#discussioncomment-6565699) and the many people whose code I had to copy paste and merge to produce this beauty.

[](#bonus)Bonus
---------------

As a final experiment, I've also tried to convert `Request` to `NextAPIRequest`, in order to be able to reuse Express/Connect logic in route handlers, which would enable using Passport namely. If you are interested, you can contribute to this GitHub issue on [the next-connect project](https://github.com/hoangvvo/next-connect/issues/228).

If you want to learn more about streams in Next.js, I recommend this article from [Mohammad (Minimalist Web Dev)](https://minimalistweb.dev/p/streams-and-react-server-components). It explains how stream are used by React Server Components to deliver HTML progressively.

[Comment this article on X (Twitter)](https://twitter.com/intent/tweet?text=How%20to%20stream%20files%20from%20Next.js%20Route%20Handlers&url=https://www.ericburel.tech/blog/nextjs-stream-files&hashtags=NextJS,React&via=ericbureltech)Copy link in clipboard

![French flag](/icons/frflag.svg)

Speak French?

[Retrouvez mes articles en français sur FormationNextjs.fr](https://www.formationnextjs.fr/ressources)

Loved this article?

You will probably also like my Next.js course,

["Blazing Fast Next.js with React Server Components"](https://www.newline.co/courses/blazing-fast-next.js-with-react-server-components)

[![](/publications/raw/newline.png)](https://www.newline.co/courses/blazing-fast-next.js-with-react-server-components)

RSCs, Server Actions, Partial Prerendering, revalidation... everything's in there to fully grasp Next.js server-centric optimizations.

[![GitHub](/icons/github.svg)](https://github.com/eric-burel)[![Bluesky](/icons/bluesky.svg)](https://bsky.app/profile/ericburel.tech)[![Twitter](/icons/twitter.svg)](https://twitter.com/ericbureltech)[![Linkedin](/icons/linkedin.svg)](https://www.linkedin.com/in/ericburel/)[![RSS Feed](/icons/rss.svg)](https://www.ericburel.tech/rss.xml)

Receive an email when new articles are published

Subscribe

© 2023-2025 Eric Burel. All rights reserved.

Blog template adapted from [Lee Robinson's blog](https://leerob.io/)

This blog is a work in progress, using Next.js canary release, expect a few bugs :)

(self.\_\_next\_f=self.\_\_next\_f||\[\]).push(\[0\]);self.\_\_next\_f.push(\[2,null\])self.\_\_next\_f.push(\[1,"1:HL\[\\"/\_next/static/media/414fe043d41639e8.p.woff2\\",\\"font\\",{\\"crossOrigin\\":\\"\\",\\"type\\":\\"font/woff2\\"}\]\\n2:HL\[\\"/\_next/static/media/4f117ec02fc103f8-s.p.woff2\\",\\"font\\",{\\"crossOrigin\\":\\"\\",\\"type\\":\\"font/woff2\\"}\]\\n3:HL\[\\"/\_next/static/css/1bd16061e46d0d23.css\\",\\"style\\"\]\\n4:HL\[\\"/\_next/static/css/d5d7f3cd4c0e80a8.css\\",\\"style\\"\]\\n5:HL\[\\"/\_next/static/css/bf6c604d90e812a8.css\\",\\"style\\"\]\\n6:HL\[\\"/\_next/static/css/5b77d408dd6f834e.css\\",\\"style\\"\]\\n"\])self.\_\_next\_f.push(\[1,"7:I\[6048,\[\],\\"\\"\]\\n9:\\"$Sreact.suspense\\"\\nc:I\[494,\[\\"630\\",\\"static/chunks/630-20f6ddd90f189fc5.js\\",\\"128\\",\\"static/chunks/128-8affc95ec7b9d350.js\\",\\"308\\",\\"static/chunks/app/blog/%5Bslug%5D/page-55f65de77bc8f5db.js\\"\],\\"CopyArticleLink\\"\]\\ne:I\[5759,\[\],\\"\\"\]\\nf:I\[8201,\[\],\\"\\"\]\\n10:I\[8630,\[\\"630\\",\\"static/chunks/630-20f6ddd90f189fc5.js\\",\\"128\\",\\"static/chunks/128-8affc95ec7b9d350.js\\",\\"308\\",\\"static/chunks/app/blog/%5Bslug%5D/page-55f65de77bc8f5db.js\\"\],\\"\\"\]\\n11:I\[1764,\[\\"601\\",\\"static/chunks/app/error-1c41162e8a8bee79.js\\"\],\\"default\\"\]\\n1a:I\[2170,\[\\"630\\",\\"static/chunks/630-20f6ddd90f189fc5.js\\",\\"899\\",\\"static/chunks/899-6adf8b8997cb677d.js\\",\\"185\\",\\"static/chunks/app/layout-776303db15aab660.js\\"\],\\"Analytics\\"\]\\n1b:I\[725,\[\\"630\\",\\"static/chunks/630-20f6ddd90f189fc5.js\\",\\"899\\",\\"static/chunks/899-6adf8b8997cb677d.js\\",\\"185\\",\\"static/chunks/app/layout-776303db15aab660.js\\"\],\\"SpeedInsights\\"\]\\n1c:I\[4783,\[\\"630\\",\\"static/chunks/630-20f6ddd90f189fc5.js\\",\\"899\\",\\"static/chunks/899-6adf8b8997cb677d.js\\",\\"185\\",\\"static/chunks/app/layout-776303db15aab660.js\\"\],\\"PreloadResources\\"\]\\n1d:I\[9477,\[\\"630\\",\\"static/chunks/630-20f6ddd90f189fc5.js\\",\\"899\\",\\"static/chunks/899-6adf8b8997cb677d.js\\",\\"185\\",\\"static/chunks/app/layout-776303db15aab660.js\\"\],\\"SubscriptionForm\\"\]\\n1f:I\[4395,\[\],\\"\\"\]\\nd:T45f5,"\])self.\_\_next\_f.push(\[1,"!\[Cover image\](/posts/nextjs-stream-files/filestream.png)\\n\\n\\nWell, I've tried hard to write a catchy introduction, explaining why files are so important in a developer's life and that you should definitely read this article. \\n\\nBut the thing is that unless you just got out of a time machine, I am pretty sure you already now what a file is, that files are important for computers, and that files can be big.\\n\\nSo let's skip it the babbling and dive directly into the question that bothers you : how to stream files from Next.js Route Handlers.\\n\\nYou will learn:\\n\\n- How to serve big files with Next.js without bloating your RAM, using API Routes and Route Handlers\\n- What are streams in Node.js and the browser\\n- The philosophical differences between API Routes and Route Handlers\\n\\n\\u003e \*\*UPDATE: I've just released a live demo of this pattern on \[NextPatterns.dev\](https://nextpatterns.dev/p/gems/route-handlers-file-streaming)!\*\*\\n\\n## Why using an API endpoint to serve files, rather than the \\"public\\" folder?\\n\\nIn Node.js applications, we traditionally use a \\"public\\" folder to serve files, like images, fonts, vendor scripts or the latest version of your resume in PDF.\\n\\nIn Express.js, the public folder is setup in a single line of code (\[documented here\](https://expressjs.com/en/starter/static-files.html)):\\n\\n\`\`\`js\\napp.use(express.static('public'))\\n\`\`\`\\n\\nIn Next.js, this is done in 0 lines of code, because \[it works out of the box\](https://nextjs.org/docs/pages/building-your-application/optimizing/static-assets).\\n\\nHowever this works only for public, generic files. Next.js calls them \\"static assets\\". Yet, some files are neither public nor generic or static. \\n\\nSome counter-examples that don't fit the public folder:\\n\\n- Personalized files: a generic url \\"/user/profile-picture\\" may serve a different image depending on the currently logged user\\n- Private files: you may want to check some permissions before serving \\"extremely\_confidential\_report.docx\\"\\n- Generated files: the State of JavaScript administration app can generate CSV exports of the responses to the survey. This means we generate the file on the fly depending on the selected survey when we receive an export request.\\n\\nFor these files, you need to craft an API endpoint that returns the content of the file. \*\*Let's do that.\*\*\\n\\n## How to serve files in Next.js with Route Handlers, the easy way\\n\\nThe easy way to serve files is to load them in memory and then return the result. Here is the full-code that you may copy-paste to create a new route handler.\\n\\n\`\`\`ts\\n// File \\"app/api/serve-file/route.ts\\" \\n// (This file is a Next.js 13+ Route Handler)\\n\\n// fs/promises gives a nice async/await syntax\\nimport fsPromises from \\"fs/promises\\" \\n\\n// \\"Request\\" type doesn't have to be imported, \\n// it's part of the web platform API and available in Node.js too\\nexport const GET = (req: Request) =\\u003e {\\n // I suppose the file exists to simplify the code\\n const filePath = \\"/tmp/some-file.zip\\"\\n const stats = await fsPromises.stat(filePath);\\n // read your file\\n const fileContent = await fsPromises.readFile(filePath)\\n // and serve it by returning a response\\n return new Response(\\n fileContent, \\n {\\n status: 200,\\n headers: new Headers({\\n // this optional header triggers a download in the browser\\n \\"content-disposition\\": \`attachment; filename=${\\n path.basename(filePath)\\n }\`,\\n \\"content-type\\": \\"application/zip\\",\\n \\"content-length\\": stats.size + \\"\\",\\n })\\n })\\n}\\n\`\`\`\\n\\n\\u003e Sometimes, instead of \`Request\` and \`Response\`, you'll see \`NextResponse\` and \`NextRequest\`. The Next versions are just wrappers around native \`Response\` and \`Request\` objects. They provide a few helpers like the parsed URL in the \`nextUrl\` field.\\n\\nThis is an intuitive solution, totally fine if you operate at a small scale. \\n\\nBut the problem is that you have to load the whole file in memory before returning it. \\n\\nThis is not good if the file is very big. Even if the file is small, if you have a high number of requests, this will also bloat your RAM.\\n\\n\`\`\`ts\\n// this \\"data\\" variable comes at a cost for big files!\\n// it copies the whole file in the server memory\\nconst data = await fsPromises.readFile(filePath)\\n\`\`\`\\n\\nThe solution to this limitation consists in streaming the file. It will be read in chunks that are immediately sent to the end user, which reduces the pressure on your server's RAM.\\n\\n## 2024 UPDATE : one-liner solution\\n\\nA new API has been brought to my attention lately (thanks \[Karl Horky!\](https://github.com/karlhorky)): \[\`filehandle.readableWebStream\`\](https://nodejs.org/docs/v20.16.0/api/fs.html#filehandlereadablewebstreamoptions). \\n\\nIt's an experimental Node.js feature that solves our issue in a single line of code:\\n\\n\`\`\`ts\\nconst fileHandle = await fs.open(filePath)\\nconst stream = fileHandle.readableWebStream({ type: \\"bytes\\" })\\nreturn new Response(stream)\\n\`\`\`\\n\\nThe remainder of this article describes alternative methods that works outside of Node.js.\\n\\n\\n\\n## How to stream big files, the old way with API routes (Next.js 9+)\\n\\nLet's start with the traditional solution, using Next.js API Routes from the \\"Page Router\\" (aka the \\"pages\\" folder). Here is how you would stream files in an API Route, without copying them in memory. \\n\\nThis is similar to what you could find in a typical Express application.\\n\\n\`\`\`ts\\n// File \\"pages/api/serve-file.ts\\" \\n// \\u003c- It's a good ol' Next.js 9+ API route\\nimport { NextApiRequest, NextApiResponse } from 'next'\\n\\nexport default async function serveFile(\\n req: NextApiRequest, res: NextApiResponse){\\n const filePath = \\"/tmp/some-file.zip\\";\\n const stats = await fsPromises.stat(filePath);\\n res.writeHead(200, {\\n \\"Content-Disposition\\": \\n \`attachment; filename=${path.basename(\\n filePath\\n )}\`,\\n \\"Content-Type\\": \\"application/zip\\",\\n \\"Content-Length\\": stats.size,\\n });\\n await new Promise(function (resolve) {\\n const nodeStream = fs.createReadStream(filePath);\\n nodeStream.pipe(res);\\n nodeStream.on(\\"end\\", resolve);\\n });\\n}\\n\`\`\`\\n\\n\\u003e \`NextApiRequest\`/\`NextApiResponse\` are for API Routes (Next 9+), while \`NextRequest\` and \`NextResponse\` are for \`Route Handlers\` (Next 13+). They are totally different things, and not directly compatible! We'll explain this difference in the next section.\\n\\n\\n\\n## Moving to route handlers: it's not that easy\\n\\nNow imagine that we want to move to route handlers,\\nthe new way of creating API endpoints brought by Next.js App Router.\\n\\nSadly, we can't copy-paste the code we wrote for the API Route\\ninto a Route Handler.\\n\\nThe problem is that the stream expected by Route Handlers, or more precisely by the \`Response\` constructor, is a \\"web platform stream\\". It is totally different from the \`ReadStream\` structure we use in API Routes, which is defined by Node.js \`fs\` package!\\n\\nYou cannot just pass the result of \`fs.createReadStream\` to a \`Response\` object. This means we need an additional conversion step.\\n\\n\`\`\`ts\\n// create a \\"ReadStream\\" \\nconst nodeStream = fs.createReadStream(filePath);\\n // and pass it to a Response, which accepts a \\"ReadStream\\" object\\n return new Response(\\n // ❌ nope, that won't work! \\n // This is not the right type of \\"stream\\"!\\n nodeStream, \\n\`\`\`\\n\\nThis is unsettling, a stream is a stream, so why does this fail? \\n\\n## Route Handlers and API Routes are built on different paradigms\\n\\nThe new Route Handlers differ quite a lot from traditional API Routes.\\n\\n- Next.js API Routes, which exist since version 9 and will be kept around likely forever, are based on Node.js. They are cousins to Express, that's why you can easily use Express middlewares and libraries, like Passport for authentication, in Next.js.\\n\\n- Route Handlers are newcomers brought by version 13. The main difference with API routes is that they are not strictly tied to Node.js. They will still use Node as the default runtime, but you can optionally use a lighter alternative called the \\"Edge Runtime\\". \\nMore broadly, this approach favors using JavaScript data structure that should exist in any runtime, be it Node.js, the Edge runtime, Deno, Bun or the runtime you are maybe building in your garage 'cause we need more.\\n\\nThat's why Route Handlers use generic \`Response\` and \`Request\` objects, that were originally designed for the browser \`fetch\` API.\\n\\nAlso, handlers use a different approach for \\"responding\\" to the user HTTP request. In an API route, you call \`res.send\`, or you pipe a stream to the \`res\` object. You don't need to return anything. In a Route Handler, you must return a \`Response\` object. Then Next.js takes care of turning that into an HTTP response.\\n\\nHere is how the code will look like in each paradigm:\\n\\n\`\`\`ts\\n// API route style for basic JSON data\\nres.send({foo: \\"bar\\"})\\n\\n// API route style for streaming files: \\n// piping will send the HTTP response directly to the client\\nconst nodeStream = fs.createReadStream(filePath);\\nnodeStream.pipe(res);\\n\\n// Route Handler style for streaming: you return a Response object\\n// and Next takes care of actually send an HTTP response\\n// streamFile is the function we want to build in this article!\\nconst webPlatformStream = streamFile(filePath)\\nreturn Response(webPlatformStream) // the return is important\\n\`\`\`\\n\\nI'd like to mention that you don't have to use Route Handlers at all if you don't want to!\\n\\nAPI Routes are fine and will be fine in any forseeable future. Features brought by Next 13+ App Router are great, but they are also sharp and hard to use. It's totally safe to wait a year or even more before even getting started with them.\\n\\nNow we understand why we have 2 different approaches. Route Handlers aim to be more generic than API routes, that are specific to Node.js.\\n\\nStill, if we do want a route handler, this means we need to learn how to convert Node-specific structures into generic web platform structures, and it requires a bit of work. Let's see how to get things done for streaming files.\\n\\n## From Node.js streams to web platform streams via generators\\n\\nSo, our problem is that we need to convert a Node.js \`fs.ReadStream\` to a web platform \`ReadableStream\`. We also need to take the difference of syntaxes between both worlds.\\n\\nWhen I first digged this issue, there was no documented solution, so I had to craft one. More precisely, I sewed various pieces of code found on Stack Overflow and Google (remember Lurch from the Adams Family? he's my fav). You can read the gory details on \[Stack Overflow\](https://stackoverflow.com/a/76780381/5513532).\\n\\nGenerators are a generic data structure in JavaScript, so it should be possible to use them as an intermediate language between Node and the web platform.\\n\\n\\u003e I will use the terms generator and iterator interchangeably. Formally, you use a generator function to produce an iterator. More details in \[Mozilla Developer documentation\](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Guide/Iterators\_and\_generators).\\n\\nSo here is the pseudocode we want to implement:\\n\\n1) Convert \`fs.ReadStream\` (given by Node.js) to a JavaScript iterator \\n2) Convert JavaScript iterator to\`ReadableStream\` (wanted by Next.js route handlers)\\n\\nIf that sounds tricky, this is because it is tricky. We are trying to establish a link between 2 completely different worlds, Node.js world and the web platform world. I mean, it's literally involving generators!\\n\\n### Step 1: from fs.ReadStream to iterator\\n\\nHere is a generator function that returns an iterator over an \`fs.ReadStream\`:\\n\\n\`\`\`ts\\n// Syntax taken from \\n// https://github.com/MattMorgis/async-stream-generator\\n// itself taken from \\n// https://nextjs.org/docs/app/building-your-application/routing/router-handlers#streaming\\n// probably itself taken from \\n// https://nodejs.org/api/stream.html\\n// Always quote your sources!\\nasync function\* nodeStreamToIterator(stream: fs.ReadStream) {\\n for await (const chunk of stream) {\\n yield new Uint8Array(chunk);\\n }\\n}\\n\`\`\`\\n\\nThe \`const chunk of stream\` part read the file one chunk at a time. The \`await\` part is just there because reading a chunk of a file is an asynchronous operation, similarly to reading the whole file. This is possible because Node.js streams are \[asynchronous iterators\](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global\_Objects/AsyncIterator), so this syntax works on them. \\n\\n\\nYou may not be used to iterators, but basically think of them as arrays of arbitrary size (even infinite) that you can read one value by one value. That's why you \\"yield\\" one chunk of data, instead of returning the whole file.\\n\\nThe \`new Uint8Array\` call is needed so your data get the proper encoding. I am serving binary files here, for text file you may want to use \[TextEncoder\](https://developer.mozilla.org/en-US/docs/Web/API/TextEncoder) instead. See \[this GitHub ticket\](https://github.com/vercel/next.js/issues/38736) for more info.\\n\\n\\u003eIn Node.js, streams are meant to be consumed primarily via events. According to Node.js documentation, setting a \\"data\\" event handler on a stream will make it flowing. You can also use the \`pipe\` method as demonstrate earlier. This explains why the iterator version is less common in the wild, yet it's better suited for our goal.\\n\\n### Step 2: from iterator to ReadableStream\\nNow that we have an iterator, \[Mozilla documentation\](https://developer.mozilla.org/en-US/docs/Web/API/ReadableStream#convert\_async\_iterator\_to\_stream) shows us how to convert it into a web platform \`ReadableStream\`: \\n\\n\`\`\`ts\\n// Provided by Mozilla Developer documentation\\n// https://developer.mozilla.org/en-US/docs/Web/API/ReadableStream#convert\_async\_iterator\_to\_stream\\n// Please say thanks to Mozilla !!\\nfunction iteratorToStream(iterator) {\\n return new ReadableStream({\\n async pull(controller) {\\n const { value, done } = await iterator.next();\\n if (done) {\\n controller.close();\\n } else {\\n controller.enqueue(value);\\n }\\n },\\n });\\n}\\n\`\`\`\\n\\n### Plugging the functions together\\n\\nSo, we can convert a Node.js stream into an iterator, and an iterator into a web platform ReadableStream.\\n\\nWe are ready to craft our \`streamFile\` function,\\nusable in Route Handlers!\\n\\n\`\`\`ts\\n// This finally turns a file path into a ReadableStream!\\nexport function streamFile(path: string): ReadableStream {\\n const nodeStream = fs.createReadStream(path);\\n const data: ReadableStream = iteratorToStream(\\n nodeStreamToIterator(\\n nodeStream\\n )\\n )\\n return data\\n}\\n\`\`\`\\n\\nYou may notice that \`createReadStream\` is a Node.js function, so this code works only in Node.js despite returning a generic ReadableStream. It's not compatible with the Edge runtime.\\n\\nThat's completely normal. Route Handlers are meant to be compatible with different runtimes, however you still have to write runtime specific code anytime you actually want to do a non-trivial operation. If you use Deno, you will have Deno specific code.\\n\\nIdeally, JavaScript would provide a generic function for opening files, that would return a  \`ReadableStream\` out of the box. However I am not aware of such an API. Ping me on \[Twitter\](https://twitter.com/ericbureltech) if you have more info than I do!\\n\\n## Serving the file, using a Route Handler\\n\\nWe've been so far into advanced JavaScript that we almost forgot the initial goal: we just wanted to stream a file in a route handler, to let the end user download something!\\n\\nObtaining a \`ReadableStream\` was the hardest part, now we just have to pass it to the \`Response\` object:\\n\\n\`\`\`ts\\n // File \\"app/api/serve-file/route.ts\\"\\n // This is the final code, \\n // reusing the \\"streamFile\\" helper\\n // that we have crafted above\\n const stats = await fsPromises.stat(filePath);\\n const stream: ReadableStream = streamFile(filePath)\\n return new Response(stream, {\\n status: 200,\\n headers: new Headers({\\n \\"content-disposition\\": \\n \`attachment; filename=${path.basename(\\n filePath\\n )}\`,\\n \\"content-type\\": \\"application/zip\\",\\n \\"content-length\\": stats.size + \\"\\",\\n })\\n\`\`\`\\n\\nYou can see a real-file example usage in the \[State of JavaScript codebase\](https://github.com/Devographics/Monorepo/blob/e1179268188111380ccaaa0a134318273d9f6594/surveyadmin/src/app/api/data-export/route.ts), to download a CSV+JSON zip out of a Mongo database.\\n\\n## Recap and conclusion\\n\\nLet's try to recap what we have learnt in this article:\\n\\n- Serving files via an API endpoint is necessary for custom, private or generated files\\n- Using a stream is necessary to avoid bloating your server RAM, it avoids loading the whole file in memory and instead returns it as chunks\\n- Next.js API routes are using Node.js syntax and data structure, it's easy to stream a file\\n- Next.js Route handlers strive to rely on more generic JavaScript built-in structures, namely the \`Request\` and \`Response\` objects from the fetch API\\n- We had to craft an helper to convert the stream produced by \`fs.createReadStream(filePath)\` , which is specific to Node.js, into a generic \`ReadableStream\`\\n- Finally, we can pass the converted stream to the \`Response\` object. Tada!\\n\\nThanks \[@rohithandique\](https://github.com/rohithandique) for the feedback \[on Next.js GitHub\](https://github.com/vercel/next.js/discussions/15453#discussioncomment-6565699)\\n and the many people whose code I had to copy paste and merge to produce this beauty.\\n\\n## Bonus\\n\\nAs a final experiment, I've also tried to convert \`Request\` to \`NextAPIRequest\`, in order to be able to reuse Express/Connect logic in route handlers, which would enable using Passport namely. If you are interested, you can contribute to this GitHub issue on \[the next-connect project\](https://github.com/hoangvvo/next-connect/issues/228).\\n\\nIf you want to learn more about streams in Next.js, I recommend this article from \[Mohammad (Minimalist Web Dev)\](https://minimalistweb.dev/p/streams-and-react-server-components). It explains how stream are used by React Server Components to deliver HTML progressively."\])self.\_\_next\_f.push(\[1,"20:\[\]\\n"\])self.\_\_next\_f.push(\[1,"0:\[\[\[\\"$\\",\\"link\\",\\"0\\",{\\"rel\\":\\"stylesheet\\",\\"href\\":\\"/\_next/static/css/1bd16061e46d0d23.css\\",\\"precedence\\":\\"next\\",\\"crossOrigin\\":\\"$undefined\\",\\"nonce\\":\\"$undefined\\"}\],\[\\"$\\",\\"link\\",\\"1\\",{\\"rel\\":\\"stylesheet\\",\\"href\\":\\"/\_next/static/css/d5d7f3cd4c0e80a8.css\\",\\"precedence\\":\\"next\\",\\"crossOrigin\\":\\"$undefined\\",\\"nonce\\":\\"$undefined\\"}\]\],\[\\"$\\",\\"$L7\\",null,{\\"buildId\\":\\"HGXe3mVFvnYYATuN3JVRX\\",\\"assetPrefix\\":\\"\\",\\"initialCanonicalUrl\\":\\"/blog/nextjs-stream-files\\",\\"initialTree\\":\[\\"\\",{\\"children\\":\[\\"blog\\",{\\"children\\":\[\[\\"slug\\",\\"nextjs-stream-files\\",\\"d\\"\],{\\"children\\":\[\\"\_\_PAGE\_\_\\",{}\]}\]}\]},\\"$undefined\\",\\"$undefined\\",true\],\\"initialSeedData\\":\[\\"\\",{\\"children\\":\[\\"blog\\",{\\"children\\":\[\[\\"slug\\",\\"nextjs-stream-files\\",\\"d\\"\],{\\"children\\":\[\\"\_\_PAGE\_\_\\",{},\[\[\\"$L8\\",\[\\"$\\",\\"section\\",null,{\\"className\\":\\"mb-32\\",\\"children\\":\[\[\\"$\\",\\"script\\",null,{\\"type\\":\\"application/ld+json\\",\\"suppressHydrationWarning\\":true,\\"dangerouslySetInnerHTML\\":{\\"\_\_html\\":\\"{\\\\\\"@context\\\\\\":\\\\\\"https://schema.org\\\\\\",\\\\\\"@type\\\\\\":\\\\\\"BlogPosting\\\\\\",\\\\\\"headline\\\\\\":\\\\\\"How to stream files from Next.js Route Handlers\\\\\\",\\\\\\"datePublished\\\\\\":\\\\\\"2024-01-31\\\\\\",\\\\\\"dateModified\\\\\\":\\\\\\"2024-01-31\\\\\\",\\\\\\"description\\\\\\":\\\\\\"Learn how the Route Handlers paradigm affects file streaming in Next.js\\\\\\",\\\\\\"image\\\\\\":\\\\\\"https://www.ericburel.tech/posts/nextjs-stream-files/filestream.png\\\\\\",\\\\\\"url\\\\\\":\\\\\\"https://www.ericburel.tech/blog/nextjs-stream-files\\\\\\",\\\\\\"author\\\\\\":{\\\\\\"@type\\\\\\":\\\\\\"Person\\\\\\",\\\\\\"name\\\\\\":\\\\\\"Eric Burel\\\\\\"}}\\"}}\],\[\\"$\\",\\"h1\\",null,{\\"className\\":\\"title text-blue-800 dark:text-blue-500 font-medium text-2xl md:text-4xl tracking-tighter max-w-\[650px\]\\",\\"children\\":\\"How to stream files from Next.js Route Handlers\\"}\],\[\\"$\\",\\"div\\",null,{\\"className\\":\\"flex justify-between items-center mt-2 mb-8 text-sm max-w-\[650px\]\\",\\"children\\":\[\[\\"$\\",\\"p\\",null,{\\"className\\":\\"text-sm text-neutral-600 dark:text-neutral-400\\",\\"children\\":\\"January 31, 2024 (last year)\\"}\],\[\\"$\\",\\"$9\\",null,{\\"fallback\\":\[\\"$\\",\\"p\\",null,{\\"className\\":\\"h-5\\"}\],\\"children\\":\\"$La\\"}\]\]}\],\[\\"$\\",\\"article\\",null,{\\"className\\":\\" prose prose-quoteless prose-neutral prose-img:mx-auto prose-p:text-\[#010101\] prose-li:text-\[#010101\] dark:prose-li:text-\[#fefefe\] md:prose-lg dark:prose-invert \\",\\"children\\":\\"$Lb\\"}\],\[\\"$\\",\\"div\\",null,{\\"children\\":\[\\"$\\",\\"div\\",null,{\\"className\\":\\"text-sm md:text-md my-2 md:my-8 flex flex-col md:flex-row md:space-x-4 space-y-4 md:space-y-0\\",\\"children\\":\[\[\\"$\\",\\"a\\",null,{\\"className\\":\\"p-4 rounded inline-block text-center bg-blue-800 text-white dark:bg-cyan-300 dark:text-black hover:brightness-150\\",\\"href\\":\\"https://twitter.com/intent/tweet?text=How%20to%20stream%20files%20from%20Next.js%20Route%20Handlers\\u0026url=https://www.ericburel.tech/blog/nextjs-stream-files\\u0026hashtags=NextJS,React\\u0026via=ericbureltech\\",\\"target\\":\\"\_blank\\",\\"children\\":\\"Comment this article on X (Twitter)\\"}\],\[\\"$\\",\\"$Lc\\",null,{\\"post\\":{\\"metadata\\":{\\"title\\":\\"How to stream files from Next.js Route Handlers\\",\\"summary\\":\\"Learn how the Route Handlers paradigm affects file streaming in Next.js\\",\\"publishedAt\\":\\"2024-01-31\\",\\"image\\":\\"/posts/nextjs-stream-files/filestream.png\\",\\"alternateFr\\":\\"https://www.formationnextjs.fr/ressources/route-handlers-et-fichiers\\"},\\"slug\\":\\"nextjs-stream-files\\",\\"tweetIds\\":\[\],\\"content\\":\\"$d\\"}}\]\]}\]}\],\[\\"$\\",\\"div\\",null,{\\"className\\":\\"my-8\\",\\"children\\":\[\[\\"$\\",\\"span\\",null,{\\"className\\":\\"inline-flex items-baseline space-x-2\\",\\"children\\":\[\[\\"$\\",\\"img\\",null,{\\"src\\":\\"/icons/frflag.svg\\",\\"width\\":\\"16px\\",\\"height\\":\\"16px\\",\\"alt\\":\\"French flag\\"}\],\[\\"$\\",\\"p\\",null,{\\"className\\":\\"italic\\",\\"children\\":\\"Speak French?\\"}\]\]}\],\[\\"$\\",\\"p\\",null,{\\"children\\":\[\\"$\\",\\"a\\",null,{\\"href\\":\\"https://www.formationnextjs.fr/ressources\\",\\"target\\":\\"\_blank\\",\\"children\\":\\"Retrouvez mes articles en français sur FormationNextjs.fr\\"}\]}\]\]}\],\[\\"$\\",\\"section\\",null,{\\"className\\":\\"mt-4 p-8 text-center border-l-8 border-gray-200 bg-pink-100 rounded-xl dark:bg-emerald-800\\",\\"children\\":\[\[\\"$\\",\\"p\\",null,{\\"className\\":\\"text-lg font-bold\\",\\"children\\":\\"Loved this article?\\"}\],\[\\"$\\",\\"p\\",null,{\\"className\\":\\"m-0\\",\\"children\\":\\"You will probably also like my Next.js course,\\"}\],\[\\"$\\",\\"p\\",null,{\\"children\\":\[\\"$\\",\\"a\\",null,{\\"href\\":\\"https://www.newline.co/courses/blazing-fast-next.js-with-react-server-components\\",\\"children\\":\\"\\\\\\"Blazing Fast Next.js with React Server Components\\\\\\"\\"}\]}\],\[\\"$\\",\\"a\\",null,{\\"href\\":\\"https://www.newline.co/courses/blazing-fast-next.js-with-react-server-components\\",\\"className\\":\\"hover:brightness-150\\",\\"children\\":\[\\"$\\",\\"img\\",null,{\\"className\\":\\"mx-auto\\",\\"src\\":\\"/publications/raw/newline.png\\"}\]}\],\[\\"$\\",\\"p\\",null,{\\"className\\":\\"mt-4\\",\\"children\\":\\"RSCs, Server Actions, Partial Prerendering, revalidation... everything's in there to fully grasp Next.js server-centric optimizations.\\"}\]\]}\]\]}\]\],null\],null\]},\[\\"$\\",\\"$Le\\",null,{\\"parallelRouterKey\\":\\"children\\",\\"segmentPath\\":\[\\"children\\",\\"blog\\",\\"children\\",\[\\"slug\\",\\"nextjs-stream-files\\",\\"d\\"\],\\"children\\"\],\\"error\\":\\"$undefined\\",\\"errorStyles\\":\\"$undefined\\",\\"errorScripts\\":\\"$undefined\\",\\"template\\":\[\\"$\\",\\"$Lf\\",null,{}\],\\"templateStyles\\":\\"$undefined\\",\\"templateScripts\\":\\"$undefined\\",\\"notFound\\":\\"$undefined\\",\\"notFoundStyles\\":\\"$undefined\\",\\"styles\\":\[\[\\"$\\",\\"link\\",\\"0\\",{\\"rel\\":\\"stylesheet\\",\\"href\\":\\"/\_next/static/css/bf6c604d90e812a8.css\\",\\"precedence\\":\\"next\\",\\"crossOrigin\\":\\"$undefined\\",\\"nonce\\":\\"$undefined\\"}\],\[\\"$\\",\\"link\\",\\"1\\",{\\"rel\\":\\"stylesheet\\",\\"href\\":\\"/\_next/static/css/5b77d408dd6f834e.css\\",\\"precedence\\":\\"next\\",\\"crossOrigin\\":\\"$undefined\\",\\"nonce\\":\\"$undefined\\"}\]\]}\],null\]},\[\\"$\\",\\"$Le\\",null,{\\"parallelRouterKey\\":\\"children\\",\\"segmentPath\\":\[\\"children\\",\\"blog\\",\\"children\\"\],\\"error\\":\\"$undefined\\",\\"errorStyles\\":\\"$undefined\\",\\"errorScripts\\":\\"$undefined\\",\\"template\\":\[\\"$\\",\\"$Lf\\",null,{}\],\\"templateStyles\\":\\"$undefined\\",\\"templateScripts\\":\\"$undefined\\",\\"notFound\\":\\"$undefined\\",\\"notFoundStyles\\":\\"$undefined\\",\\"styles\\":null}\],null\]},\[\[\\"$\\",\\"html\\",null,{\\"lang\\":\\"en\\",\\"className\\":\\"text-black bg-white dark:text-\[#fefefe\] dark:bg-\[#19191a\] \_\_variable\_343187 \_\_variable\_1e81eb\\",\\"children\\":\[\\"$\\",\\"body\\",null,{\\"className\\":\\"antialiased max-w-2xl flex flex-col md:flex-row mx-4 mt-8 lg:mx-auto\\",\\"children\\":\[\\"$\\",\\"main\\",null,{\\"className\\":\\"flex-auto min-w-0 mt-6 flex flex-col px-2 md:px-0\\",\\"children\\":\[\[\\"$\\",\\"aside\\",null,{\\"className\\":\\"lg:-ml-\[64px\] mb-16 tracking-tight\\",\\"children\\":\[\\"$\\",\\"div\\",null,{\\"className\\":\\"lg:sticky lg:top-20\\",\\"children\\":\[\\"$\\",\\"nav\\",null,{\\"className\\":\\"flex flex-col md:flex-row items-start relative px-0 pb-0 fade md:overflow-auto scroll-pr-6 md:relative\\",\\"id\\":\\"nav\\",\\"children\\":\[\[\\"$\\",\\"div\\",null,{\\"className\\":\\"flex flex-row align-middle pr-10 py-1 font-bold\\",\\"children\\":\[\[\\"$\\",\\"span\\",null,{\\"className\\":\\"text-nowrap\\",\\"children\\":\\"Eric Burel\\"}\],\[\\"$\\",\\"span\\",null,{\\"className\\":\\"text-blue-800\\",\\"children\\":\\" dot \\"}\],\[\\"$\\",\\"span\\",null,{\\"children\\":\\"Tech\\"}\]\]}\],\[\\"$\\",\\"div\\",null,{\\"className\\":\\"flex flex-row space-x-0 pr-10\\",\\"children\\":\[\[\\"$\\",\\"$L10\\",\\"/\\",{\\"href\\":\\"/\\",\\"className\\":\\"transition-all hover:border-b-4 hover:text-blue-800 dark:hover:text-neutral-200 flex align-middle relative py-1 px-2 md:px-4\\",\\"children\\":\\"Home\\"}\],\[\\"$\\",\\"$L10\\",\\"/blog\\",{\\"href\\":\\"/blog\\",\\"className\\":\\"transition-all hover:border-b-4 hover:text-blue-800 dark:hover:text-neutral-200 flex align-middle relative py-1 px-2 md:px-4\\",\\"children\\":\\"Blog\\"}\],\[\\"$\\",\\"$L10\\",\\"/publications\\",{\\"href\\":\\"/publications\\",\\"className\\":\\"transition-all hover:border-b-4 hover:text-blue-800 dark:hover:text-neutral-200 flex align-middle relative py-1 px-2 md:px-4\\",\\"children\\":\\"Work\\"}\]\]}\]\]}\]}\]}\],\[\\"$\\",\\"$Le\\",null,{\\"parallelRouterKey\\":\\"children\\",\\"segmentPath\\":\[\\"children\\"\],\\"error\\":\\"$11\\",\\"errorStyles\\":\[\],\\"errorScripts\\":\[\],\\"template\\":\[\\"$\\",\\"$Lf\\",null,{}\],\\"templateStyles\\":\\"$undefined\\",\\"templateScripts\\":\\"$undefined\\",\\"notFound\\":\[\\"$\\",\\"section\\",null,{\\"className\\":\\"mb-16\\",\\"children\\":\[\[\\"$\\",\\"h1\\",null,{\\"className\\":\\"text-center m-16 text-xl\\",\\"children\\":\\"404 | Content not found\\"}\],\[\\"$\\",\\"p\\",null,{\\"className\\":\\"mb-4\\",\\"children\\":\\"Maybe you were looking for one of my latest blog posts?\\"}\],\[\\"$\\",\\"div\\",null,{\\"children\\":\[\[\\"$\\",\\"$L10\\",\\"vercel-crons\\",{\\"className\\":\\"flex flex-col space-y-1 mb-4 border border-l-4 border-gray-200 dark:border-gray-600 p-4 rounded hover:bg-sky-50 dark:hover:bg-sky-900\\",\\"href\\":\\"/blog/vercel-crons\\",\\"children\\":\[\\"$\\",\\"div\\",null,{\\"className\\":\\"w-full flex flex-col\\",\\"children\\":\[\[\\"$\\",\\"p\\",null,{\\"className\\":\\" text-blue-900 dark:text-blue-100 tracking-tight\\",\\"children\\":\\"Computing the State of JS user rank with Vercel Cron jobs\\"}\],\[\\"$\\",\\"$9\\",null,{\\"fallback\\":\[\\"$\\",\\"p\\",null,{\\"className\\":\\"h-6\\"}\],\\"children\\":\\"$L12\\"}\]\]}\]}\],\[\\"$\\",\\"$L10\\",\\"hybrid-i18n-next-astro-4\\",{\\"className\\":\\"flex flex-col space-y-1 mb-4 border border-l-4 border-gray-200 dark:border-gray-600 p-4 rounded hover:bg-sky-50 dark:hover:bg-sky-900\\",\\"href\\":\\"/blog/hybrid-i18n-next-astro-4\\",\\"children\\":\[\\"$\\",\\"div\\",null,{\\"className\\":\\"w-full flex flex-col\\",\\"children\\":\[\[\\"$\\",\\"p\\",null,{\\"className\\":\\" text-blue-900 dark:text-blue-100 tracking-tight\\",\\"children\\":\\"Hybrid i18n with Next and Astro (part 4)\\"}\],\[\\"$\\",\\"$9\\",null,{\\"fallback\\":\[\\"$\\",\\"p\\",null,{\\"className\\":\\"h-6\\"}\],\\"children\\":\\"$L13\\"}\]\]}\]}\],\[\\"$\\",\\"$L10\\",\\"hybrid-i18n-next-astro-3\\",{\\"className\\":\\"flex flex-col space-y-1 mb-4 border border-l-4 border-gray-200 dark:border-gray-600 p-4 rounded hover:bg-sky-50 dark:hover:bg-sky-900\\",\\"href\\":\\"/blog/hybrid-i18n-next-astro-3\\",\\"children\\":\[\\"$\\",\\"div\\",null,{\\"className\\":\\"w-full flex flex-col\\",\\"children\\":\[\[\\"$\\",\\"p\\",null,{\\"className\\":\\" text-blue-900 dark:text-blue-100 tracking-tight\\",\\"children\\":\\"Hybrid i18n with Next and Astro (part 3)\\"}\],\[\\"$\\",\\"$9\\",null,{\\"fallback\\":\[\\"$\\",\\"p\\",null,{\\"className\\":\\"h-6\\"}\],\\"children\\":\\"$L14\\"}\]\]}\]}\],\[\\"$\\",\\"$L10\\",\\"hybrid-i18n-next-astro-2\\",{\\"className\\":\\"flex flex-col space-y-1 mb-4 border border-l-4 border-gray-200 dark:border-gray-600 p-4 rounded hover:bg-sky-50 dark:hover:bg-sky-900\\",\\"href\\":\\"/blog/hybrid-i18n-next-astro-2\\",\\"children\\":\[\\"$\\",\\"div\\",null,{\\"className\\":\\"w-full flex flex-col\\",\\"children\\":\[\[\\"$\\",\\"p\\",null,{\\"className\\":\\" text-blue-900 dark:text-blue-100 tracking-tight\\",\\"children\\":\\"Hybrid i18n with Next and Astro (part 2)\\"}\],\[\\"$\\",\\"$9\\",null,{\\"fallback\\":\[\\"$\\",\\"p\\",null,{\\"className\\":\\"h-6\\"}\],\\"children\\":\\"$L15\\"}\]\]}\]}\],\[\\"$\\",\\"$L10\\",\\"hybrid-i18n-next-astro-1\\",{\\"className\\":\\"flex flex-col space-y-1 mb-4 border border-l-4 border-gray-200 dark:border-gray-600 p-4 rounded hover:bg-sky-50 dark:hover:bg-sky-900\\",\\"href\\":\\"/blog/hybrid-i18n-next-astro-1\\",\\"children\\":\[\\"$\\",\\"div\\",null,{\\"className\\":\\"w-full flex flex-col\\",\\"children\\":\[\[\\"$\\",\\"p\\",null,{\\"className\\":\\" text-blue-900 dark:text-blue-100 tracking-tight\\",\\"children\\":\\"Hybrid i18n with Next and Astro (part 1)\\"}\],\[\\"$\\",\\"$9\\",null,{\\"fallback\\":\[\\"$\\",\\"p\\",null,{\\"className\\":\\"h-6\\"}\],\\"children\\":\\"$L16\\"}\]\]}\]}\],\[\\"$\\",\\"$L10\\",\\"what-layout-means-in-react\\",{\\"className\\":\\"flex flex-col space-y-1 mb-4 border border-l-4 border-gray-200 dark:border-gray-600 p-4 rounded hover:bg-sky-50 dark:hover:bg-sky-900\\",\\"href\\":\\"/blog/what-layout-means-in-react\\",\\"children\\":\[\\"$\\",\\"div\\",null,{\\"className\\":\\"w-full flex flex-col\\",\\"children\\":\[\[\\"$\\",\\"p\\",null,{\\"className\\":\\" text-blue-900 dark:text-blue-100 tracking-tight\\",\\"children\\":\\"What is a layout in React?\\"}\],\[\\"$\\",\\"$9\\",null,{\\"fallback\\":\[\\"$\\",\\"p\\",null,{\\"className\\":\\"h-6\\"}\],\\"children\\":\\"$L17\\"}\]\]}\]}\],\[\\"$\\",\\"$L10\\",\\"static-paid-content-app-router\\",{\\"className\\":\\"flex flex-col space-y-1 mb-4 border border-l-4 border-gray-200 dark:border-gray-600 p-4 rounded hover:bg-sky-50 dark:hover:bg-sky-900\\",\\"href\\":\\"/blog/static-paid-content-app-router\\",\\"children\\":\[\\"$\\",\\"div\\",null,{\\"className\\":\\"w-full flex flex-col\\",\\"children\\":\[\[\\"$\\",\\"p\\",null,{\\"className\\":\\" text-blue-900 dark:text-blue-100 tracking-tight\\",\\"children\\":\\"Secure statically rendered paid content in Next.js (with the App Router)\\"}\],\[\\"$\\",\\"$9\\",null,{\\"fallback\\":\[\\"$\\",\\"p\\",null,{\\"className\\":\\"h-6\\"}\],\\"children\\":\\"$L18\\"}\]\]}\]}\],\[\\"$\\",\\"$L10\\",\\"nextjs-stream-files\\",{\\"className\\":\\"flex flex-col space-y-1 mb-4 border border-l-4 border-gray-200 dark:border-gray-600 p-4 rounded hover:bg-sky-50 dark:hover:bg-sky-900\\",\\"href\\":\\"/blog/nextjs-stream-files\\",\\"children\\":\[\\"$\\",\\"div\\",null,{\\"className\\":\\"w-full flex flex-col\\",\\"children\\":\[\[\\"$\\",\\"p\\",null,{\\"className\\":\\" text-blue-900 dark:text-blue-100 tracking-tight\\",\\"children\\":\\"How to stream files from Next.js Route Handlers\\"}\],\[\\"$\\",\\"$9\\",null,{\\"fallback\\":\[\\"$\\",\\"p\\",null,{\\"className\\":\\"h-6\\"}\],\\"children\\":\\"$L19\\"}\]\]}\]}\]\]}\]\]}\],\\"notFoundStyles\\":\[\],\\"styles\\":null}\],\[\\"$\\",\\"$L1a\\",null,{}\],\[\\"$\\",\\"$L1b\\",null,{}\],\[\\"$\\",\\"$L1c\\",null,{}\],\[\\"$\\",\\"footer\\",null,{\\"className\\":\\"w-full rounded-t-md bg-gray-100 dark:bg-gray-800 py-8 px-4 md:px-6 pb-32\\",\\"children\\":\[\[\\"$\\",\\"div\\",null,{\\"className\\":\\"container mx-auto flex flex-col md:flex-row items-center justify-between space-y-4 md:space-y-0\\",\\"children\\":\[\[\\"$\\",\\"div\\",null,{\\"className\\":\\"flex items-center space-x-4\\",\\"children\\":\[\[\\"$\\",\\"a\\",null,{\\"href\\":\\"https://github.com/eric-burel\\",\\"rel\\":\\"noopener noreferrer\\",\\"target\\":\\"\_blank\\",\\"children\\":\[\\"$\\",\\"img\\",null,{\\"alt\\":\\"GitHub\\",\\"src\\":\\"/icons/github.svg\\",\\"className\\":\\"h-6 w-6 text-gray-500 dark:text-gray-400 hover:text-blue-400 dark:hover:text-blue-300\\"}\]}\],\[\\"$\\",\\"a\\",null,{\\"href\\":\\"https://bsky.app/profile/ericburel.tech\\",\\"rel\\":\\"noopener noreferrer\\",\\"target\\":\\"\_blank\\",\\"children\\":\[\\"$\\",\\"img\\",null,{\\"alt\\":\\"Bluesky\\",\\"src\\":\\"/icons/bluesky.svg\\",\\"className\\":\\"h-6 w-6 text-gray-500 dark:text-gray-400 hover:text-blue-400 dark:hover:text-blue-300\\"}\]}\],\[\\"$\\",\\"a\\",null,{\\"href\\":\\"https://twitter.com/ericbureltech\\",\\"rel\\":\\"noopener noreferrer\\",\\"target\\":\\"\_blank\\",\\"children\\":\[\\"$\\",\\"img\\",null,{\\"alt\\":\\"Twitter\\",\\"src\\":\\"/icons/twitter.svg\\",\\"className\\":\\"h-6 w-6 text-gray-500 dark:text-gray-400 hover:text-blue-400 dark:hover:text-blue-300\\"}\]}\],\[\\"$\\",\\"a\\",null,{\\"href\\":\\"https://www.linkedin.com/in/ericburel/\\",\\"rel\\":\\"noopener noreferrer\\",\\"target\\":\\"\_blank\\",\\"children\\":\[\\"$\\",\\"img\\",null,{\\"alt\\":\\"Linkedin\\",\\"src\\":\\"/icons/linkedin.svg\\",\\"className\\":\\"h-6 w-6 text-gray-500 dark:text-gray-400 hover:text-blue-400 dark:hover:text-blue-300\\"}\]}\],\[\\"$\\",\\"a\\",null,{\\"href\\":\\"https://www.ericburel.tech/rss.xml\\",\\"rel\\":\\"noopener noreferrer\\",\\"target\\":\\"\_blank\\",\\"children\\":\[\\"$\\",\\"img\\",null,{\\"alt\\":\\"RSS Feed\\",\\"src\\":\\"/icons/rss.svg\\",\\"className\\":\\"h-6 w-6 text-gray-500 dark:text-gray-400 hover:text-blue-400 dark:hover:text-blue-300\\"}\]}\]\]}\],\[\\"$\\",\\"div\\",null,{\\"children\\":\[\[\\"$\\",\\"p\\",null,{\\"className\\":\\"text-sm italic mb-2\\",\\"children\\":\\"Receive an email when new articles are published\\"}\],\[\\"$\\",\\"$9\\",null,{\\"children\\":\[\\"$\\",\\"$L1d\\",null,{}\]}\]\]}\]\]}\],\[\\"$\\",\\"div\\",null,{\\"className\\":\\"mt-4 text-center text-sm text-gray-500 dark:text-gray-400\\",\\"children\\":\[\\"© 2023-\\",2025,\\" Eric Burel. All rights reserved.\\"\]}\],\[\\"$\\",\\"div\\",null,{\\"className\\":\\"mt-4 text-center text-sm text-gray-500 dark:text-gray-400\\",\\"children\\":\[\\"Blog template adapted from\\",\\" \\",\[\\"$\\",\\"a\\",null,{\\"href\\":\\"https://leerob.io/\\",\\"children\\":\\"Lee Robinson's blog\\"}\]\]}\],\[\\"$\\",\\"div\\",null,{\\"className\\":\\"mt-4 text-center font-bold text-sm text-gray-500 dark:text-gray-400\\",\\"children\\":\\"This blog is a work in progress, using Next.js canary release, expect a few bugs :)\\"}\]\]}\]\]}\]}\]}\],null\],null\],\\"couldBeIntercepted\\":false,\\"initialHead\\":\[false,\\"$L1e\\"\],\\"globalErrorComponent\\":\\"$1f\\",\\"missingSlots\\":\\"$W20\\"}\]\]\\n"\])self.\_\_next\_f.push(\[1,"2c:\\"$Sreact.fragment\\"\\n21:T431,\\u003cspan class=\\"sh\_\_line\\"\\u003e\\u003cspan class=\\"sh\_\_token--identifier\\" style=\\"color: var(--sh-identifier)\\"\\u003eapp\\u003c/span\\u003e\\u003cspan class=\\"sh\_\_token--sign\\" style=\\"color: var(--sh-sign)\\"\\u003e.\\u003c/span\\u003e\\u003cspan class=\\"sh\_\_token--identifier\\" style=\\"color: var(--sh-identifier)\\"\\u003euse\\u003c/span\\u003e\\u003cspan class=\\"sh\_\_token--sign\\" style=\\"color: var(--sh-sign)\\"\\u003e(\\u003c/span\\u003e\\u003cspan class=\\"sh\_\_token--identifier\\" style=\\"color: var(--sh-identifier)\\"\\u003eexpress\\u003c/span\\u003e\\u003cspan class=\\"sh\_\_token--sign\\" style=\\"color: var(--sh-sign)\\"\\u003e.\\u003c/span\\u003e\\u003cspan class=\\"sh\_\_token--identifier\\" style=\\"color: var(--sh-identifier)\\"\\u003estatic\\u003c/span\\u003e\\u003cspan class=\\"sh\_\_token--sign\\" style=\\"color: var(--sh-sign)\\"\\u003e(\\u003c/span\\u003e\\u003cspan class=\\"sh\_\_token--string\\" style=\\"color: var(--sh-string)\\"\\u003e\\u0026#039;\\u003c/span\\u003e\\u003cspan class=\\"sh\_\_token--string\\" style=\\"color: var(--sh-string)\\"\\u003epublic\\u003c/span\\u003e\\u003cspan class=\\"sh\_\_token--string\\" style=\\"color: var(--sh-string)\\"\\u003e\\u0026#039;\\u003c/span\\u003e\\u003cspan class=\\"sh\_\_token--sign\\" style=\\"color: var(--sh-sign)\\"\\u003e)\\u003c/span\\u003e\\u003cspan class=\\"sh\_\_token--sign\\" style=\\"color: var(--sh-sign)\\"\\u003e)\\u003c/span\\u003e\\u003cspan class=\\"sh\_\_token--break\\" style=\\"color: var(--sh-break)\\"\\u003e\\u003c/span\\u003e\\u003c/span\\u003e22:T3c6a,"\])self.\_\_next\_f.push(\[1,"\\u003cspan class=\\"sh\_\_line\\"\\u003e\\u003cspan class=\\"sh\_\_token--comment\\" style=\\"color: var(--sh-comment)\\"\\u003e// File \\u0026quot;app/api/serve-file/route.ts\\u0026quot; \\u003c/span\\u003e\\u003c/span\\u003e\\n\\u003cspan class=\\"sh\_\_line\\"\\u003e\\u003cspan class=\\"sh\_\_token--comment\\" style=\\"color: var(--sh-comment)\\"\\u003e\\u003c/span\\u003e\\u003cspan class=\\"sh\_\_token--comment\\" style=\\"color: var(--sh-comment)\\"\\u003e// (This file is a Next.js 13+ Route Handler)\\u003c/span\\u003e\\u003c/span\\u003e\\n\\u003cspan class=\\"sh\_\_line\\"\\u003e\\u003cspan class=\\"sh\_\_token--comment\\" style=\\"color: var(--sh-comment)\\"\\u003e\\u003c/span\\u003e\\u003cspan class=\\"sh\_\_token--break\\" style=\\"color: var(--sh-break)\\"\\u003e\\u003c/span\\u003e\\u003c/span\\u003e\\n\\u003cspan class=\\"sh\_\_line\\"\\u003e\\u003cspan class=\\"sh\_\_token--comment\\" style=\\"color: var(--sh-comment)\\"\\u003e// fs/promises gives a nice async/await syntax\\u003c/span\\u003e\\u003c/span\\u003e\\n\\u003cspan class=\\"sh\_\_line\\"\\u003e\\u003cspan class=\\"sh\_\_token--comment\\" style=\\"color: var(--sh-comment)\\"\\u003e\\u003c/span\\u003e\\u003cspan class=\\"sh\_\_token--keyword\\" style=\\"color: var(--sh-keyword)\\"\\u003eimport\\u003c/span\\u003e\\u003cspan class=\\"sh\_\_token--space\\" style=\\"color: var(--sh-space)\\"\\u003e \\u003c/span\\u003e\\u003cspan class=\\"sh\_\_token--identifier\\" style=\\"color: var(--sh-identifier)\\"\\u003efsPromises\\u003c/span\\u003e\\u003cspan class=\\"sh\_\_token--space\\" style=\\"color: var(--sh-space)\\"\\u003e \\u003c/span\\u003e\\u003cspan class=\\"sh\_\_token--keyword\\" style=\\"color: var(--sh-keyword)\\"\\u003efrom\\u003c/span\\u003e\\u003cspan class=\\"sh\_\_token--space\\" style=\\"color: var(--sh-space)\\"\\u003e \\u003c/span\\u003e\\u003cspan class=\\"sh\_\_token--string\\" style=\\"color: var(--sh-string)\\"\\u003e\\u0026quot;\\u003c/span\\u003e\\u003cspan class=\\"sh\_\_token--string\\" style=\\"color: var(--sh-string)\\"\\u003efs/promises\\u003c/span\\u003e\\u003cspan class=\\"sh\_\_token--string\\" style=\\"color: var(--sh-string)\\"\\u003e\\u0026quot;\\u003c/span\\u003e\\u003cspan class=\\"sh\_\_token--space\\" style=\\"color: var(--sh-space)\\"\\u003e \\u003c/span\\u003e\\u003cspan class=\\"sh\_\_token--break\\" style=\\"color: var(--sh-break)\\"\\u003e\\u003c/span\\u003e\\u003c/span\\u003e\\n\\u003cspan class=\\"sh\_\_line\\"\\u003e\\u003cspan class=\\"sh\_\_token--break\\" style=\\"color: var(--sh-break)\\"\\u003e\\u003c/span\\u003e\\u003c/span\\u003e\\n\\u003cspan class=\\"sh\_\_line\\"\\u003e\\u003cspan class=\\"sh\_\_token--comment\\" style=\\"color: var(--sh-comment)\\"\\u003e// \\u0026quot;Request\\u0026quot; type doesn\\u0026#039;t have to be imported, \\u003c/span\\u003e\\u003c/span\\u003e\\n\\u003cspan class=\\"sh\_\_line\\"\\u003e\\u003cspan class=\\"sh\_\_token--comment\\" style=\\"color: var(--sh-comment)\\"\\u003e\\u003c/span\\u003e\\u003cspan class=\\"sh\_\_token--comment\\" style=\\"color: var(--sh-comment)\\"\\u003e// it\\u0026#039;s part of the web platform API and available in Node.js too\\u003c/span\\u003e\\u003c/span\\u003e\\n\\u003cspan class=\\"sh\_\_line\\"\\u003e\\u003cspan class=\\"sh\_\_token--comment\\" style=\\"color: var(--sh-comment)\\"\\u003e\\u003c/span\\u003e\\u003cspan class=\\"sh\_\_token--keyword\\" style=\\"color: var(--sh-keyword)\\"\\u003eexport\\u003c/span\\u003e\\u003cspan class=\\"sh\_\_token--space\\" style=\\"color: var(--sh-space)\\"\\u003e \\u003c/span\\u003e\\u003cspan class=\\"sh\_\_token--keyword\\" style=\\"color: var(--sh-keyword)\\"\\u003econst\\u003c/span\\u003e\\u003cspan class=\\"sh\_\_token--space\\" style=\\"color: var(--sh-space)\\"\\u003e \\u003c/span\\u003e\\u003cspan class=\\"sh\_\_token--class\\" style=\\"color: var(--sh-class)\\"\\u003eGET\\u003c/span\\u003e\\u003cspan class=\\"sh\_\_token--space\\" style=\\"color: var(--sh-space)\\"\\u003e \\u003c/span\\u003e\\u003cspan class=\\"sh\_\_token--sign\\" style=\\"color: var(--sh-sign)\\"\\u003e=\\u003c/span\\u003e\\u003cspan class=\\"sh\_\_token--space\\" style=\\"color: var(--sh-space)\\"\\u003e \\u003c/span\\u003e\\u003cspan class=\\"sh\_\_token--sign\\" style=\\"color: var(--sh-sign)\\"\\u003e(\\u003c/span\\u003e\\u003cspan class=\\"sh\_\_token--identifier\\" style=\\"color: var(--sh-identifier)\\"\\u003ereq\\u003c/span\\u003e\\u003cspan class=\\"sh\_\_token--sign\\" style=\\"color: var(--sh-sign)\\"\\u003e:\\u003c/span\\u003e\\u003cspan class=\\"sh\_\_token--space\\" style=\\"color: var(--sh-space)\\"\\u003e \\u003c/span\\u003e\\u003cspan class=\\"sh\_\_token--class\\" style=\\"color: var(--sh-class)\\"\\u003eRequest\\u003c/span\\u003e\\u003cspan class=\\"sh\_\_token--sign\\" style=\\"color: var(--sh-sign)\\"\\u003e)\\u003c/span\\u003e\\u003cspan class=\\"sh\_\_token--space\\" style=\\"color: var(--sh-space)\\"\\u003e \\u003c/span\\u003e\\u003cspan class=\\"sh\_\_token--sign\\" style=\\"color: var(--sh-sign)\\"\\u003e=\\u003c/span\\u003e\\u003cspan class=\\"sh\_\_token--sign\\" style=\\"color: var(--sh-sign)\\"\\u003e\\u0026gt;\\u003c/span\\u003e\\u003cspan class=\\"sh\_\_token--space\\" style=\\"color: var(--sh-space)\\"\\u003e \\u003c/span\\u003e\\u003cspan class=\\"sh\_\_token--sign\\" style=\\"color: var(--sh-sign)\\"\\u003e{\\u003c/span\\u003e\\u003cspan class=\\"sh\_\_token--break\\" style=\\"color: var(--sh-break)\\"\\u003e\\u003c/span\\u003e\\u003c/span\\u003e\\n\\u003cspan class=\\"sh\_\_line\\"\\u003e\\u003cspan class=\\"sh\_\_token--space\\" style=\\"color: var(--sh-space)\\"\\u003e \\u003c/span\\u003e\\u003cspan class=\\"sh\_\_token--comment\\" style=\\"color: var(--sh-comment)\\"\\u003e// I suppose the file exists to simplify the code\\u003c/span\\u003e\\u003c/span\\u003e\\n\\u003cspan class=\\"sh\_\_line\\"\\u003e\\u003cspan class=\\"sh\_\_token--comment\\" style=\\"color: var(--sh-comment)\\"\\u003e\\u003c/span\\u003e\\u003cspan class=\\"sh\_\_token--space\\" style=\\"color: var(--sh-space)\\"\\u003e \\u003c/span\\u003e\\u003cspan class=\\"sh\_\_token--keyword\\" style=\\"color: var(--sh-keyword)\\"\\u003econst\\u003c/span\\u003e\\u003cspan class=\\"sh\_\_token--space\\" style=\\"color: var(--sh-space)\\"\\u003e \\u003c/span\\u003e\\u003cspan class=\\"sh\_\_token--identifier\\" style=\\"color: var(--sh-identifier)\\"\\u003efilePath\\u003c/span\\u003e\\u003cspan class=\\"sh\_\_token--space\\" style=\\"color: var(--sh-space)\\"\\u003e \\u003c/span\\u003e\\u003cspan class=\\"sh\_\_token--sign\\" style=\\"color: var(--sh-sign)\\"\\u003e=\\u003c/span\\u003e\\u003cspan class=\\"sh\_\_token--space\\" style=\\"color: var(--sh-space)\\"\\u003e \\u003c/span\\u003e\\u003cspan class=\\"sh\_\_token--string\\" style=\\"color: var(--sh-string)\\"\\u003e\\u0026quot;\\u003c/span\\u003e\\u003cspan class=\\"sh\_\_token--string\\" style=\\"color: var(--sh-string)\\"\\u003e/tmp/some-file.zip\\u003c/span\\u003e\\u003cspan class=\\"sh\_\_token--string\\" style=\\"color: var(--sh-string)\\"\\u003e\\u0026quot;\\u003c/span\\u003e\\u003cspan class=\\"sh\_\_token--break\\" style=\\"color: var(--sh-break)\\"\\u003e\\u003c/span\\u003e\\u003c/span\\u003e\\n\\u003cspan class=\\"sh\_\_line\\"\\u003e\\u003cspan class=\\"sh\_\_token--space\\" style=\\"color: var(--sh-space)\\"\\u003e \\u003c/span\\u003e\\u003cspan class=\\"sh\_\_token--keyword\\" style=\\"color: var(--sh-keyword)\\"\\u003econst\\u003c/span\\u003e\\u003cspan class=\\"sh\_\_token--space\\" style=\\"color: var(--sh-space)\\"\\u003e \\u003c/span\\u003e\\u003cspan class=\\"sh\_\_token--identifier\\" style=\\"color: var(--sh-identifier)\\"\\u003estats\\u003c/span\\u003e\\u003cspan class=\\"sh\_\_token--space\\" style=\\"color: var(--sh-space)\\"\\u003e \\u003c/span\\u003e\\u003cspan class=\\"sh\_\_token--sign\\" style=\\"color: var(--sh-sign)\\"\\u003e=\\u003c/span\\u003e\\u003cspan class=\\"sh\_\_token--space\\" style=\\"color: var(--sh-space)\\"\\u003e \\u003c/span\\u003e\\u003cspan class=\\"sh\_\_token--keyword\\" style=\\"color: var(--sh-keyword)\\"\\u003eawait\\u003c/span\\u003e\\u003cspan class=\\"sh\_\_token--space\\" style=\\"color: var(--sh-space)\\"\\u003e \\u003c/span\\u003e\\u003cspan class=\\"sh\_\_token--identifier\\" style=\\"color: var(--sh-identifier)\\"\\u003efsPromises\\u003c/span\\u003e\\u003cspan class=\\"sh\_\_token--sign\\" style=\\"color: var(--sh-sign)\\"\\u003e.\\u003c/span\\u003e\\u003cspan class=\\"sh\_\_token--identifier\\" style=\\"color: var(--sh-identifier)\\"\\u003estat\\u003c/span\\u003e\\u003cspan class=\\"sh\_\_token--sign\\" style=\\"color: var(--sh-sign)\\"\\u003e(\\u003c/span\\u003e\\u003cspan class=\\"sh\_\_token--identifier\\" style=\\"color: var(--sh-identifier)\\"\\u003efilePath\\u003c/span\\u003e\\u003cspan class=\\"sh\_\_token--sign\\" style=\\"color: var(--sh-sign)\\"\\u003e)\\u003c/span\\u003e\\u003cspan class=\\"sh\_\_token--sign\\" style=\\"color: var(--sh-sign)\\"\\u003e;\\u003c/span\\u003e\\u003cspan class=\\"sh\_\_token--break\\" style=\\"color: var(--sh-break)\\"\\u003e\\u003c/span\\u003e\\u003c/span\\u003e\\n\\u003cspan class=\\"sh\_\_line\\"\\u003e\\u003cspan class=\\"sh\_\_token--space\\" style=\\"color: var(--sh-space)\\"\\u003e \\u003c/span\\u003e\\u003cspan class=\\"sh\_\_token--comment\\" style=\\"color: var(--sh-comment)\\"\\u003e// read your file\\u003c/span\\u003e\\u003c/span\\u003e\\n\\u003cspan class=\\"sh\_\_line\\"\\u003e\\u003cspan class=\\"sh\_\_token--comment\\" style=\\"color: var(--sh-comment)\\"\\u003e\\u003c/span\\u003e\\u003cspan class=\\"sh\_\_token--space\\" style=\\"color: var(--sh-space)\\"\\u003e \\u003c/span\\u003e\\u003cspan class=\\"sh\_\_token--keyword\\" style=\\"color: var(--sh-keyword)\\"\\u003econst\\u003c/span\\u003e\\u003cspan class=\\"sh\_\_token--space\\" style=\\"color: var(--sh-space)\\"\\u003e \\u003c/span\\u003e\\u003cspan class=\\"sh\_\_token--identifier\\" style=\\"color: var(--sh-identifier)\\"\\u003efileContent\\u003c/span\\u003e\\u003cspan class=\\"sh\_\_token--space\\" style=\\"color: var(--sh-space)\\"\\u003e \\u003c/span\\u003e\\u003cspan class=\\"sh\_\_token--sign\\" style=\\"color: var(--sh-sign)\\"\\u003e=\\u003c/span\\u003e\\u003cspan class=\\"sh\_\_token--space\\" style=\\"color: var(--sh-space)\\"\\u003e \\u003c/span\\u003e\\u003cspan class=\\"sh\_\_token--keyword\\" style=\\"color: var(--sh-keyword)\\"\\u003eawait\\u003c/span\\u003e\\u003cspan class=\\"sh\_\_token--space\\" style=\\"color: var(--sh-space)\\"\\u003e \\u003c/span\\u003e\\u003cspan class=\\"sh\_\_token--identifier\\" style=\\"color: var(--sh-identifier)\\"\\u003efsPromises\\u003c/span\\u003e\\u003cspan class=\\"sh\_\_token--sign\\" style=\\"color: var(--sh-sign)\\"\\u003e.\\u003c/span\\u003e\\u003cspan class=\\"sh\_\_token--identifier\\" style=\\"color: var(--sh-identifier)\\"\\u003ereadFile\\u003c/span\\u003e\\u003cspan class=\\"sh\_\_token--sign\\" style=\\"color: var(--sh-sign)\\"\\u003e(\\u003c/span\\u003e\\u003cspan class=\\"sh\_\_token--identifier\\" style=\\"color: var(--sh-identifier)\\"\\u003efilePath\\u003c/span\\u003e\\u003cspan class=\\"sh\_\_token--sign\\" style=\\"color: var(--sh-sign)\\"\\u003e)\\u003c/span\\u003e\\u003cspan class=\\"sh\_\_token--break\\" style=\\"color: var(--sh-break)\\"\\u003e\\u003c/span\\u003e\\u003c/span\\u003e\\n\\u003cspan class=\\"sh\_\_line\\"\\u003e\\u003cspan class=\\"sh\_\_token--space\\" style=\\"color: var(--sh-space)\\"\\u003e \\u003c/span\\u003e\\u003cspan class=\\"sh\_\_token--comment\\" style=\\"color: var(--sh-comment)\\"\\u003e// and serve it by returning a response\\u003c/span\\u003e\\u003c/span\\u003e\\n\\u003cspan class=\\"sh\_\_line\\"\\u003e\\u003cspan class=\\"sh\_\_token--comment\\" style=\\"color: var(--sh-comment)\\"\\u003e\\u003c/span\\u003e\\u003cspan class=\\"sh\_\_token--space\\" style=\\"color: var(--sh-space)\\"\\u003e \\u003c/span\\u003e\\u003cspan class=\\"sh\_\_token--keyword\\" style=\\"color: var(--sh-keyword)\\"\\u003ereturn\\u003c/span\\u003e\\u003cspan class=\\"sh\_\_token--space\\" style=\\"color: var(--sh-space)\\"\\u003e \\u003c/span\\u003e\\u003cspan class=\\"sh\_\_token--keyword\\" style=\\"color: var(--sh-keyword)\\"\\u003enew\\u003c/span\\u003e\\u003cspan class=\\"sh\_\_token--space\\" style=\\"color: var(--sh-space)\\"\\u003e \\u003c/span\\u003e\\u003cspan class=\\"sh\_\_token--class\\" style=\\"color: var(--sh-class)\\"\\u003eResponse\\u003c/span\\u003e\\u003cspan class=\\"sh\_\_token--sign\\" style=\\"color: var(--sh-sign)\\"\\u003e(\\u003c/span\\u003e\\u003cspan class=\\"sh\_\_token--break\\" style=\\"color: var(--sh-break)\\"\\u003e\\u003c/span\\u003e\\u003c/span\\u003e\\n\\u003cspan class=\\"sh\_\_line\\"\\u003e\\u003cspan class=\\"sh\_\_token--space\\" style=\\"color: var(--sh-space)\\"\\u003e \\u003c/span\\u003e\\u003cspan class=\\"sh\_\_token--identifier\\" style=\\"color: var(--sh-identifier)\\"\\u003efileContent\\u003c/span\\u003e\\u003cspan class=\\"sh\_\_token--sign\\" style=\\"color: var(--sh-sign)\\"\\u003e,\\u003c/span\\u003e\\u003cspan class=\\"sh\_\_token--space\\" style=\\"color: var(--sh-space)\\"\\u003e \\u003c/span\\u003e\\u003cspan class=\\"sh\_\_token--break\\" style=\\"color: var(--sh-break)\\"\\u003e\\u003c/span\\u003e\\u003c/span\\u003e\\n\\u003cspan class=\\"sh\_\_line\\"\\u003e\\u003cspan class=\\"sh\_\_token--space\\" style=\\"color: var(--sh-space)\\"\\u003e \\u003c/span\\u003e\\u003cspan class=\\"sh\_\_token--sign\\" style=\\"color: var(--sh-sign)\\"\\u003e{\\u003c/span\\u003e\\u003cspan class=\\"sh\_\_token--break\\" style=\\"color: var(--sh-break)\\"\\u003e\\u003c/span\\u003e\\u003c/span\\u003e\\n\\u003cspan class=\\"sh\_\_line\\"\\u003e\\u003cspan class=\\"sh\_\_token--space\\" style=\\"color: var(--sh-space)\\"\\u003e \\u003c/span\\u003e\\u003cspan class=\\"sh\_\_token--identifier\\" style=\\"color: var(--sh-identifier)\\"\\u003estatus\\u003c/span\\u003e\\u003cspan class=\\"sh\_\_token--sign\\" style=\\"color: var(--sh-sign)\\"\\u003e:\\u003c/span\\u003e\\u003cspan class=\\"sh\_\_token--space\\" style=\\"color: var(--sh-space)\\"\\u003e \\u003c/span\\u003e\\u003cspan class=\\"sh\_\_token--class\\" style=\\"color: var(--sh-class)\\"\\u003e200\\u003c/span\\u003e\\u003cspan class=\\"sh\_\_token--sign\\" style=\\"color: var(--sh-sign)\\"\\u003e,\\u003c/span\\u003e\\u003cspan class=\\"sh\_\_token--break\\" style=\\"color: var(--sh-break)\\"\\u003e\\u003c/span\\u003e\\u003c/span\\u003e\\n\\u003cspan class=\\"sh\_\_line\\"\\u003e\\u003cspan class=\\"sh\_\_token--space\\" style=\\"color: var(--sh-space)\\"\\u003e \\u003c/span\\u003e\\u003cspan class=\\"sh\_\_token--identifier\\" style=\\"color: var(--sh-identifier)\\"\\u003eheaders\\u003c/span\\u003e\\u003cspan class=\\"sh\_\_token--sign\\" style=\\"color: var(--sh-sign)\\"\\u003e:\\u003c/span\\u003e\\u003cspan class=\\"sh\_\_token--space\\" style=\\"color: var(--sh-space)\\"\\u003e \\u003c/span\\u003e\\u003cspan class=\\"sh\_\_token--keyword\\" style=\\"color: var(--sh-keyword)\\"\\u003enew\\u003c/span\\u003e\\u003cspan class=\\"sh\_\_token--space\\" style=\\"color: var(--sh-space)\\"\\u003e \\u003c/span\\u003e\\u003cspan class=\\"sh\_\_token--class\\" style=\\"color: var(--sh-class)\\"\\u003eHeaders\\u003c/span\\u003e\\u003cspan class=\\"sh\_\_token--sign\\" style=\\"color: var(--sh-sign)\\"\\u003e(\\u003c/span\\u003e\\u003cspan class=\\"sh\_\_token--sign\\" style=\\"color: var(--sh-sign)\\"\\u003e{\\u003c/span\\u003e\\u003cspan class=\\"sh\_\_token--break\\" style=\\"color: var(--sh-break)\\"\\u003e\\u003c/span\\u003e\\u003c/span\\u003e\\n\\u003cspan class=\\"sh\_\_line\\"\\u003e\\u003cspan class=\\"sh\_\_token--space\\" style=\\"color: var(--sh-space)\\"\\u003e \\u003c/span\\u003e\\u003cspan class=\\"sh\_\_token--comment\\" style=\\"color: var(--sh-comment)\\"\\u003e// this optional header triggers a download in the browser\\u003c/span\\u003e\\u003c/span\\u003e\\n\\u003cspan class=\\"sh\_\_line\\"\\u003e\\u003cspan class=\\"sh\_\_token--comment\\" style=\\"color: var(--sh-comment)\\"\\u003e\\u003c/span\\u003e\\u003cspan class=\\"sh\_\_token--space\\" style=\\"color: var(--sh-space)\\"\\u003e \\u003c/span\\u003e\\u003cspan class=\\"sh\_\_token--string\\" style=\\"color: var(--sh-string)\\"\\u003e\\u0026quot;\\u003c/span\\u003e\\u003cspan class=\\"sh\_\_token--string\\" style=\\"color: var(--sh-string)\\"\\u003econtent-disposition\\u003c/span\\u003e\\u003cspan class=\\"sh\_\_token--string\\" style=\\"color: var(--sh-string)\\"\\u003e\\u0026quot;\\u003c/span\\u003e\\u003cspan class=\\"sh\_\_token--sign\\" style=\\"color: var(--sh-sign)\\"\\u003e:\\u003c/span\\u003e\\u003cspan class=\\"sh\_\_token--space\\" style=\\"color: var(--sh-space)\\"\\u003e \\u003c/span\\u003e\\u003cspan class=\\"sh\_\_token--string\\" style=\\"color: var(--sh-string)\\"\\u003e\`\\u003c/span\\u003e\\u003cspan class=\\"sh\_\_token--string\\" style=\\"color: var(--sh-string)\\"\\u003eattachment; filename=\\u003c/span\\u003e\\u003cspan class=\\"sh\_\_token--sign\\" style=\\"color: var(--sh-sign)\\"\\u003e${\\u003c/span\\u003e\\u003cspan class=\\"sh\_\_token--break\\" style=\\"color: var(--sh-break)\\"\\u003e\\u003c/span\\u003e\\u003c/span\\u003e\\n\\u003cspan class=\\"sh\_\_line\\"\\u003e\\u003cspan class=\\"sh\_\_token--space\\" style=\\"color: var(--sh-space)\\"\\u003e \\u003c/span\\u003e\\u003cspan class=\\"sh\_\_token--identifier\\" style=\\"color: var(--sh-identifier)\\"\\u003epath\\u003c/span\\u003e\\u003cspan class=\\"sh\_\_token--sign\\" style=\\"color: var(--sh-sign)\\"\\u003e.\\u003c/span\\u003e\\u003cspan class=\\"sh\_\_token--identifier\\" style=\\"color: var(--sh-identifier)\\"\\u003ebasename\\u003c/span\\u003e\\u003cspan class=\\"sh\_\_token--sign\\" style=\\"color: var(--sh-sign)\\"\\u003e(\\u003c/span\\u003e\\u003cspan class=\\"sh\_\_token--identifier\\" style=\\"color: var(--sh-identifier)\\"\\u003efilePath\\u003c/span\\u003e\\u003cspan class=\\"sh\_\_token--sign\\" style=\\"color: var(--sh-sign)\\"\\u003e)\\u003c/span\\u003e\\u003cspan class=\\"sh\_\_token--break\\" style=\\"color: var(--sh-break)\\"\\u003e\\u003c/span\\u003e\\u003c/span\\u003e\\n\\u003cspan class=\\"sh\_\_line\\"\\u003e\\u003cspan class=\\"sh\_\_token--space\\" style=\\"color: var(--sh-space)\\"\\u003e \\u003c/span\\u003e\\u003cspan class=\\"sh\_\_token--sign\\" style=\\"color: var(--sh-sign)\\"\\u003e}\\u003c/span\\u003e\\u003cspan class=\\"sh\_\_token--string\\" style=\\"color: var(--sh-string)\\"\\u003e\`\\u003c/span\\u003e\\u003cspan class=\\"sh\_\_token--sign\\" style=\\"color: var(--sh-sign)\\"\\u003e,\\u003c/span\\u003e\\u003cspan class=\\"sh\_\_token--break\\" style=\\"color: var(--sh-break)\\"\\u003e\\u003c/span\\u003e\\u003c/span\\u003e\\n\\u003cspan class=\\"sh\_\_line\\"\\u003e\\u003cspan class=\\"sh\_\_token--space\\" style=\\"color: var(--sh-space)\\"\\u003e \\u003c/span\\u003e\\u003cspan class=\\"sh\_\_token--string\\" style=\\"color: var(--sh-string)\\"\\u003e\\u0026quot;\\u003c/span\\u003e\\u003cspan class=\\"sh\_\_token--string\\" style=\\"color: var(--sh-string)\\"\\u003econtent-type\\u003c/span\\u003e\\u003cspan class=\\"sh\_\_token--string\\" style=\\"color: var(--sh-string)\\"\\u003e\\u0026quot;\\u003c/span\\u003e\\u003cspan class=\\"sh\_\_token--sign\\" style=\\"color: var(--sh-sign)\\"\\u003e:\\u003c/span\\u003e\\u003cspan class=\\"sh\_\_token--space\\" style=\\"color: var(--sh-space)\\"\\u003e \\u003c/span\\u003e\\u003cspan class=\\"sh\_\_token--string\\" style=\\"color: var(--sh-string)\\"\\u003e\\u0026quot;\\u003c/span\\u003e\\u003cspan class=\\"sh\_\_token--string\\" style=\\"color: var(--sh-string)\\"\\u003eapplication/zip\\u003c/span\\u003e\\u003cspan class=\\"sh\_\_token--string\\" style=\\"color: var(--sh-string)\\"\\u003e\\u0026quot;\\u003c/span\\u003e\\u003cspan class=\\"sh\_\_token--sign\\" style=\\"color: var(--sh-sign)\\"\\u003e,\\u003c/span\\u003e\\u003cspan class=\\"sh\_\_token--break\\" style=\\"color: var(--sh-break)\\"\\u003e\\u003c/span\\u003e\\u003c/span\\u003e\\n\\u003cspan class=\\"sh\_\_line\\"\\u003e\\u003cspan class=\\"sh\_\_token--space\\" style=\\"color: var(--sh-space)\\"\\u003e \\u003c/span\\u003e\\u003cspan class=\\"sh\_\_token--string\\" style=\\"color: var(--sh-string)\\"\\u003e\\u0026quot;\\u003c/span\\u003e\\u003cspan class=\\"sh\_\_token--string\\" style=\\"color: var(--sh-string)\\"\\u003econtent-length\\u003c/span\\u003e\\u003cspan class=\\"sh\_\_token--string\\" style=\\"color: var(--sh-string)\\"\\u003e\\u0026quot;\\u003c/span\\u003e\\u003cspan class=\\"sh\_\_token--sign\\" style=\\"color: var(--sh-sign)\\"\\u003e:\\u003c/span\\u003e\\u003cspan class=\\"sh\_\_token--space\\" style=\\"color: var(--sh-space)\\"\\u003e \\u003c/span\\u003e\\u003cspan class=\\"sh\_\_token--identifier\\" style=\\"color: var(--sh-identifier)\\"\\u003estats\\u003c/span\\u003e\\u003cspan class=\\"sh\_\_token--sign\\" style=\\"color: var(--sh-sign)\\"\\u003e.\\u003c/span\\u003e\\u003cspan class=\\"sh\_\_token--identifier\\" style=\\"color: var(--sh-identifier)\\"\\u003esize\\u003c/span\\u003e\\u003cspan class=\\"sh\_\_token--space\\" style=\\"color: var(--sh-space)\\"\\u003e \\u003c/span\\u003e\\u003cspan class=\\"sh\_\_token--sign\\" style=\\"color: var(--sh-sign)\\"\\u003e+\\u003c/span\\u003e\\u003cspan class=\\"sh\_\_token--space\\" style=\\"color: var(--sh-space)\\"\\u003e \\u003c/span\\u003e\\u003cspan class=\\"sh\_\_token--string\\" style=\\"color: var(--sh-string)\\"\\u003e\\u0026quot;\\u003c/span\\u003e\\u003cspan class=\\"sh\_\_token--string\\" style=\\"color: var(--sh-string)\\"\\u003e\\u0026quot;\\u003c/span\\u003e\\u003cspan class=\\"sh\_\_token--sign\\" style=\\"color: var(--sh-sign)\\"\\u003e,\\u003c/span\\u003e\\u003cspan class=\\"sh\_\_token--break\\" style=\\"color: var(--sh-break)\\"\\u003e\\u003c/span\\u003e\\u003c/span\\u003e\\n\\u003cspan class=\\"sh\_\_line\\"\\u003e\\u003cspan class=\\"sh\_\_token--space\\" style=\\"color: var(--sh-space)\\"\\u003e \\u003c/span\\u003e\\u003cspan class=\\"sh\_\_token--sign\\" style=\\"color: var(--sh-sign)\\"\\u003e}\\u003c/span\\u003e\\u003cspan class=\\"sh\_\_token--sign\\" style=\\"color: var(--sh-sign)\\"\\u003e)\\u003c/span\\u003e\\u003cspan class=\\"sh\_\_token--break\\" style=\\"color: var(--sh-break)\\"\\u003e\\u003c/span\\u003e\\u003c/span\\u003e\\n\\u003cspan class=\\"sh\_\_line\\"\\u003e\\u003cspan class=\\"sh\_\_token--space\\" style=\\"color: var(--sh-space)\\"\\u003e \\u003c/span\\u003e\\u003cspan class=\\"sh\_\_token--sign\\" style=\\"color: var(--sh-sign)\\"\\u003e}\\u003c/span\\u003e\\u003cspan class=\\"sh\_\_token--sign\\" style=\\"color: var(--sh-sign)\\"\\u003e)\\u003c/span\\u003e\\u003cspan class=\\"sh\_\_token--break\\" style=\\"color: var(--sh-break)\\"\\u003e\\u003c/span\\u003e\\u003c/span\\u003e\\n\\u003cspan class=\\"sh\_\_line\\"\\u003e\\u003cspan class=\\"sh\_\_token--sign\\" style=\\"color: var(--sh-sign)\\"\\u003e}\\u003c/span\\u003e\\u003cspan class=\\"sh\_\_token--break\\" style=\\"color: var(--sh-break)\\"\\u003e\\u003c/span\\u003e\\u003c/span\\u003e"\])self.\_\_next\_f.push(\[1,"23:T653,\\u003cspan class=\\"sh\_\_line\\"\\u003e\\u003cspan class=\\"sh\_\_token--comment\\" style=\\"color: var(--sh-comment)\\"\\u003e// this \\u0026quot;data\\u0026quot; variable comes at a cost for big files!\\u003c/span\\u003e\\u003c/span\\u003e\\n\\u003cspan class=\\"sh\_\_line\\"\\u003e\\u003cspan class=\\"sh\_\_token--comment\\" style=\\"color: var(--sh-comment)\\"\\u003e\\u003c/span\\u003e\\u003cspan class=\\"sh\_\_token--comment\\" style=\\"color: var(--sh-comment)\\"\\u003e// it copies the whole file in the server memory\\u003c/span\\u003e\\u003c/span\\u003e\\n\\u003cspan class=\\"sh\_\_line\\"\\u003e\\u003cspan class=\\"sh\_\_token--comment\\" style=\\"color: var(--sh-comment)\\"\\u003e\\u003c/span\\u003e\\u003cspan class=\\"sh\_\_token--keyword\\" style=\\"color: var(--sh-keyword)\\"\\u003econst\\u003c/span\\u003e\\u003cspan class=\\"sh\_\_token--space\\" style=\\"color: var(--sh-space)\\"\\u003e \\u003c/span\\u003e\\u003cspan class=\\"sh\_\_token--identifier\\" style=\\"color: var(--sh-identifier)\\"\\u003edata\\u003c/span\\u003e\\u003cspan class=\\"sh\_\_token--space\\" style=\\"color: var(--sh-space)\\"\\u003e \\u003c/span\\u003e\\u003cspan class=\\"sh\_\_token--sign\\" style=\\"color: var(--sh-sign)\\"\\u003e=\\u003c/span\\u003e\\u003cspan class=\\"sh\_\_token--space\\" style=\\"color: var(--sh-space)\\"\\u003e \\u003c/span\\u003e\\u003cspan class=\\"sh\_\_token--keyword\\" style=\\"color: var(--sh-keyword)\\"\\u003eawait\\u003c/span\\u003e\\u003cspan class=\\"sh\_\_token--space\\" style=\\"color: var(--sh-space)\\"\\u003e \\u003c/span\\u003e\\u003cspan class=\\"sh\_\_token--identifier\\" style=\\"color: var(--sh-identifier)\\"\\u003efsPromises\\u003c/span\\u003e\\u003cspan class=\\"sh\_\_token--sign\\" style=\\"color: var(--sh-sign)\\"\\u003e.\\u003c/span\\u003e\\u003cspan class=\\"sh\_\_token--identifier\\" style=\\"color: var(--sh-identifier)\\"\\u003ereadFile\\u003c/span\\u003e\\u003cspan class=\\"sh\_\_token--sign\\" style=\\"color: var(--sh-sign)\\"\\u003e(\\u003c/span\\u003e\\u003cspan class=\\"sh\_\_token--identifier\\" style=\\"color: var(--sh-identifier)\\"\\u003efilePath\\u003c/span\\u003e\\u003cspan class=\\"sh\_\_token--sign\\" style=\\"color: var(--sh-sign)\\"\\u003e)\\u003c/span\\u003e\\u003cspan class=\\"sh\_\_token--break\\" style=\\"color: var(--sh-break)\\"\\u003e\\u003c/span\\u003e\\u003c/span\\u003e24:Tda9,"\])self.\_\_next\_f.push(\[1,"\\u003cspan class=\\"sh\_\_line\\"\\u003e\\u003cspan class=\\"sh\_\_token--keyword\\" style=\\"color: var(--sh-keyword)\\"\\u003econst\\u003c/span\\u003e\\u003cspan class=\\"sh\_\_token--space\\" style=\\"color: var(--sh-space)\\"\\u003e \\u003c/span\\u003e\\u003cspan class=\\"sh\_\_token--identifier\\" style=\\"color: var(--sh-identifier)\\"\\u003efileHandle\\u003c/span\\u003e\\u003cspan class=\\"sh\_\_token--space\\" style=\\"color: var(--sh-space)\\"\\u003e \\u003c/span\\u003e\\u003cspan class=\\"sh\_\_token--sign\\" style=\\"color: var(--sh-sign)\\"\\u003e=\\u003c/span\\u003e\\u003cspan class=\\"sh\_\_token--space\\" style=\\"color: var(--sh-space)\\"\\u003e \\u003c/span\\u003e\\u003cspan class=\\"sh\_\_token--keyword\\" style=\\"color: var(--sh-keyword)\\"\\u003eawait\\u003c/span\\u003e\\u003cspan class=\\"sh\_\_token--space\\" style=\\"color: var(--sh-space)\\"\\u003e \\u003c/span\\u003e\\u003cspan class=\\"sh\_\_token--identifier\\" style=\\"color: var(--sh-identifier)\\"\\u003efs\\u003c/span\\u003e\\u003cspan class=\\"sh\_\_token--sign\\" style=\\"color: var(--sh-sign)\\"\\u003e.\\u003c/span\\u003e\\u003cspan class=\\"sh\_\_token--identifier\\" style=\\"color: var(--sh-identifier)\\"\\u003eopen\\u003c/span\\u003e\\u003cspan class=\\"sh\_\_token--sign\\" style=\\"color: var(--sh-sign)\\"\\u003e(\\u003c/span\\u003e\\u003cspan class=\\"sh\_\_token--identifier\\" style=\\"color: var(--sh-identifier)\\"\\u003efilePath\\u003c/span\\u003e\\u003cspan class=\\"sh\_\_token--sign\\" style=\\"color: var(--sh-sign)\\"\\u003e)\\u003c/span\\u003e\\u003cspan class=\\"sh\_\_token--break\\" style=\\"color: var(--sh-break)\\"\\u003e\\u003c/span\\u003e\\u003c/span\\u003e\\n\\u003cspan class=\\"sh\_\_line\\"\\u003e\\u003cspan class=\\"sh\_\_token--keyword\\" style=\\"color: var(--sh-keyword)\\"\\u003econst\\u003c/span\\u003e\\u003cspan class=\\"sh\_\_token--space\\" style=\\"color: var(--sh-space)\\"\\u003e \\u003c/span\\u003e\\u003cspan class=\\"sh\_\_token--identifier\\" style=\\"color: var(--sh-identifier)\\"\\u003estream\\u003c/span\\u003e\\u003cspan class=\\"sh\_\_token--space\\" style=\\"color: var(--sh-space)\\"\\u003e \\u003c/span\\u003e\\u003cspan class=\\"sh\_\_token--sign\\" style=\\"color: var(--sh-sign)\\"\\u003e=\\u003c/span\\u003e\\u003cspan class=\\"sh\_\_token--space\\" style=\\"color: var(--sh-space)\\"\\u003e \\u003c/span\\u003e\\u003cspan class=\\"sh\_\_token--identifier\\" style=\\"color: var(--sh-identifier)\\"\\u003efileHandle\\u003c/span\\u003e\\u003cspan class=\\"sh\_\_token--sign\\" style=\\"color: var(--sh-sign)\\"\\u003e.\\u003c/span\\u003e\\u003cspan class=\\"sh\_\_token--identifier\\" style=\\"color: var(--sh-identifier)\\"\\u003ereadableWebStream\\u003c/span\\u003e\\u003cspan class=\\"sh\_\_token--sign\\" style=\\"color: var(--sh-sign)\\"\\u003e(\\u003c/span\\u003e\\u003cspan class=\\"sh\_\_token--sign\\" style=\\"color: var(--sh-sign)\\"\\u003e{\\u003c/span\\u003e\\u003cspan class=\\"sh\_\_token--space\\" style=\\"color: var(--sh-space)\\"\\u003e \\u003c/span\\u003e\\u003cspan class=\\"sh\_\_token--identifier\\" style=\\"color: var(--sh-identifier)\\"\\u003etype\\u003c/span\\u003e\\u003cspan class=\\"sh\_\_token--sign\\" style=\\"color: var(--sh-sign)\\"\\u003e:\\u003c/span\\u003e\\u003cspan class=\\"sh\_\_token--space\\" style=\\"color: var(--sh-space)\\"\\u003e \\u003c/span\\u003e\\u003cspan class=\\"sh\_\_token--string\\" style=\\"color: var(--sh-string)\\"\\u003e\\u0026quot;\\u003c/span\\u003e\\u003cspan class=\\"sh\_\_token--string\\" style=\\"color: var(--sh-string)\\"\\u003ebytes\\u003c/span\\u003e\\u003cspan class=\\"sh\_\_token--string\\" style=\\"color: var(--sh-string)\\"\\u003e\\u0026quot;\\u003c/span\\u003e\\u003cspan class=\\"sh\_\_token--space\\" style=\\"color: var(--sh-space)\\"\\u003e \\u003c/span\\u003e\\u003cspan class=\\"sh\_\_token--sign\\" style=\\"color: var(--sh-sign)\\"\\u003e}\\u003c/span\\u003e\\u003cspan class=\\"sh\_\_token--sign\\" style=\\"color: var(--sh-sign)\\"\\u003e)\\u003c/span\\u003e\\u003cspan class=\\"sh\_\_token--break\\" style=\\"color: var(--sh-break)\\"\\u003e\\u003c/span\\u003e\\u003c/span\\u003e\\n\\u003cspan class=\\"sh\_\_line\\"\\u003e\\u003cspan class=\\"sh\_\_token--keyword\\" style=\\"color: var(--sh-keyword)\\"\\u003ereturn\\u003c/span\\u003e\\u003cspan class=\\"sh\_\_token--space\\" style=\\"color: var(--sh-space)\\"\\u003e \\u003c/span\\u003e\\u003cspan class=\\"sh\_\_token--keyword\\" style=\\"color: var(--sh-keyword)\\"\\u003enew\\u003c/span\\u003e\\u003cspan class=\\"sh\_\_token--space\\" style=\\"color: var(--sh-space)\\"\\u003e \\u003c/span\\u003e\\u003cspan class=\\"sh\_\_token--class\\" style=\\"color: var(--sh-class)\\"\\u003eResponse\\u003c/span\\u003e\\u003cspan class=\\"sh\_\_token--sign\\" style=\\"color: var(--sh-sign)\\"\\u003e(\\u003c/span\\u003e\\u003cspan class=\\"sh\_\_token--identifier\\" style=\\"color: var(--sh-identifier)\\"\\u003estream\\u003c/span\\u003e\\u003cspan class=\\"sh\_\_token--sign\\" style=\\"color: var(--sh-sign)\\"\\u003e)\\u003c/span\\u003e\\u003cspan class=\\"sh\_\_token--break\\" style=\\"color: var(--sh-break)\\"\\u003e\\u003c/span\\u003e\\u003c/span\\u003e"\])self.\_\_next\_f.push(\[1,"25:T3c0e,"\])self.\_\_next\_f.push(\[1,"\\u003cspan class=\\"sh\_\_line\\"\\u003e\\u003cspan class=\\"sh\_\_token--comment\\" style=\\"color: var(--sh-comment)\\"\\u003e// File \\u0026quot;pages/api/serve-file.ts\\u0026quot; \\u003c/span\\u003e\\u003c/span\\u003e\\n\\u003cspan class=\\"sh\_\_line\\"\\u003e\\u003cspan class=\\"sh\_\_token--comment\\" style=\\"color: var(--sh-comment)\\"\\u003e\\u003c/span\\u003e\\u003cspan class=\\"sh\_\_token--comment\\" style=\\"color: var(--sh-comment)\\"\\u003e// \\u0026lt;- It\\u0026#039;s a good ol\\u0026#039; Next.js 9+ API route\\u003c/span\\u003e\\u003c/span\\u003e\\n\\u003cspan class=\\"sh\_\_line\\"\\u003e\\u003cspan class=\\"sh\_\_token--comment\\" style=\\"color: var(--sh-comment)\\"\\u003e\\u003c/span\\u003e\\u003cspan class=\\"sh\_\_token--keyword\\" style=\\"color: var(--sh-keyword)\\"\\u003eimport\\u003c/span\\u003e\\u003cspan class=\\"sh\_\_token--space\\" style=\\"color: var(--sh-space)\\"\\u003e \\u003c/span\\u003e\\u003cspan class=\\"sh\_\_token--sign\\" style=\\"color: var(--sh-sign)\\"\\u003e{\\u003c/span\\u003e\\u003cspan class=\\"sh\_\_token--space\\" style=\\"color: var(--sh-space)\\"\\u003e \\u003c/span\\u003e\\u003cspan class=\\"sh\_\_token--class\\" style=\\"color: var(--sh-class)\\"\\u003eNextApiRequest\\u003c/span\\u003e\\u003cspan class=\\"sh\_\_token--sign\\" style=\\"color: var(--sh-sign)\\"\\u003e,\\u003c/span\\u003e\\u003cspan class=\\"sh\_\_token--space\\" style=\\"color: var(--sh-space)\\"\\u003e \\u003c/span\\u003e\\u003cspan class=\\"sh\_\_token--class\\" style=\\"color: var(--sh-class)\\"\\u003eNextApiResponse\\u003c/span\\u003e\\u003cspan class=\\"sh\_\_token--space\\" style=\\"color: var(--sh-space)\\"\\u003e \\u003c/span\\u003e\\u003cspan class=\\"sh\_\_token--sign\\" style=\\"color: var(--sh-sign)\\"\\u003e}\\u003c/span\\u003e\\u003cspan class=\\"sh\_\_token--space\\" style=\\"color: var(--sh-space)\\"\\u003e \\u003c/span\\u003e\\u003cspan class=\\"sh\_\_token--keyword\\" style=\\"color: var(--sh-keyword)\\"\\u003efrom\\u003c/span\\u003e\\u003cspan class=\\"sh\_\_token--space\\" style=\\"color: var(--sh-space)\\"\\u003e \\u003c/span\\u003e\\u003cspan class=\\"sh\_\_token--string\\" style=\\"color: var(--sh-string)\\"\\u003e\\u0026#039;\\u003c/span\\u003e\\u003cspan class=\\"sh\_\_token--string\\" style=\\"color: var(--sh-string)\\"\\u003enext\\u003c/span\\u003e\\u003cspan class=\\"sh\_\_token--string\\" style=\\"color: var(--sh-string)\\"\\u003e\\u0026#039;\\u003c/span\\u003e\\u003cspan class=\\"sh\_\_token--break\\" style=\\"color: var(--sh-break)\\"\\u003e\\u003c/span\\u003e\\u003c/span\\u003e\\n\\u003cspan class=\\"sh\_\_line\\"\\u003e\\u003cspan class=\\"sh\_\_token--break\\" style=\\"color: var(--sh-break)\\"\\u003e\\u003c/span\\u003e\\u003c/span\\u003e\\n\\u003cspan class=\\"sh\_\_line\\"\\u003e\\u003cspan class=\\"sh\_\_token--keyword\\" style=\\"color: var(--sh-keyword)\\"\\u003eexport\\u003c/span\\u003e\\u003cspan class=\\"sh\_\_token--space\\" style=\\"color: var(--sh-space)\\"\\u003e \\u003c/span\\u003e\\u003cspan class=\\"sh\_\_token--keyword\\" style=\\"color: var(--sh-keyword)\\"\\u003edefault\\u003c/span\\u003e\\u003cspan class=\\"sh\_\_token--space\\" style=\\"color: var(--sh-space)\\"\\u003e \\u003c/span\\u003e\\u003cspan class=\\"sh\_\_token--keyword\\" style=\\"color: var(--sh-keyword)\\"\\u003easync\\u003c/span\\u003e\\u003cspan class=\\"sh\_\_token--space\\" style=\\"color: var(--sh-space)\\"\\u003e \\u003c/span\\u003e\\u003cspan class=\\"sh\_\_token--keyword\\" style=\\"color: var(--sh-keyword)\\"\\u003efunction\\u003c/span\\u003e\\u003cspan class=\\"sh\_\_token--space\\" style=\\"color: var(--sh-space)\\"\\u003e \\u003c/span\\u003e\\u003cspan class=\\"sh\_\_token--identifier\\" style=\\"color: var(--sh-identifier)\\"\\u003eserveFile\\u003c/span\\u003e\\u003cspan class=\\"sh\_\_token--sign\\" style=\\"color: var(--sh-sign)\\"\\u003e(\\u003c/span\\u003e\\u003cspan class=\\"sh\_\_token--break\\" style=\\"color: var(--sh-break)\\"\\u003e\\u003c/span\\u003e\\u003c/span\\u003e\\n\\u003cspan class=\\"sh\_\_line\\"\\u003e\\u003cspan class=\\"sh\_\_token--space\\" style=\\"color: var(--sh-space)\\"\\u003e \\u003c/span\\u003e\\u003cspan class=\\"sh\_\_token--identifier\\" style=\\"color: var(--sh-identifier)\\"\\u003ereq\\u003c/span\\u003e\\u003cspan class=\\"sh\_\_token--sign\\" style=\\"color: var(--sh-sign)\\"\\u003e:\\u003c/span\\u003e\\u003cspan class=\\"sh\_\_token--space\\" style=\\"color: var(--sh-space)\\"\\u003e \\u003c/span\\u003e\\u003cspan class=\\"sh\_\_token--class\\" style=\\"color: var(--sh-class)\\"\\u003eNextApiRequest\\u003c/span\\u003e\\u003cspan class=\\"sh\_\_token--sign\\" style=\\"color: var(--sh-sign)\\"\\u003e,\\u003c/span\\u003e\\u003cspan class=\\"sh\_\_token--space\\" style=\\"color: var(--sh-space)\\"\\u003e \\u003c/span\\u003e\\u003cspan class=\\"sh\_\_token--identifier\\" style=\\"color: var(--sh-identifier)\\"\\u003eres\\u003c/span\\u003e\\u003cspan class=\\"sh\_\_token--sign\\" style=\\"color: var(--sh-sign)\\"\\u003e:\\u003c/span\\u003e\\u003cspan class=\\"sh\_\_token--space\\" style=\\"color: var(--sh-space)\\"\\u003e \\u003c/span\\u003e\\u003cspan class=\\"sh\_\_token--class\\" style=\\"color: var(--sh-class)\\"\\u003eNextApiResponse\\u003c/span\\u003e\\u003cspan class=\\"sh\_\_token--sign\\" style=\\"color: var(--sh-sign)\\"\\u003e)\\u003c/span\\u003e\\u003cspan class=\\"sh\_\_token--sign\\" style=\\"color: var(--sh-sign)\\"\\u003e{\\u003c/span\\u003e\\u003cspan class=\\"sh\_\_token--break\\" style=\\"color: var(--sh-break)\\"\\u003e\\u003c/span\\u003e\\u003c/span\\u003e\\n\\u003cspan class=\\"sh\_\_line\\"\\u003e\\u003cspan class=\\"sh\_\_token--space\\" style=\\"color: var(--sh-space)\\"\\u003e \\u003c/span\\u003e\\u003cspan class=\\"sh\_\_token--keyword\\" style=\\"color: var(--sh-keyword)\\"\\u003econst\\u003c/span\\u003e\\u003cspan class=\\"sh\_\_token--space\\" style=\\"color: var(--sh-space)\\"\\u003e \\u003c/span\\u003e\\u003cspan class=\\"sh\_\_token--identifier\\" style=\\"color: var(--sh-identifier)\\"\\u003efilePath\\u003c/span\\u003e\\u003cspan class=\\"sh\_\_token--space\\" style=\\"color: var(--sh-space)\\"\\u003e \\u003c/span\\u003e\\u003cspan class=\\"sh\_\_token--sign\\" style=\\"color: var(--sh-sign)\\"\\u003e=\\u003c/span\\u003e\\u003cspan class=\\"sh\_\_token--space\\" style=\\"color: var(--sh-space)\\"\\u003e \\u003c/span\\u003e\\u003cspan class=\\"sh\_\_token--string\\" style=\\"color: var(--sh-string)\\"\\u003e\\u0026quot;\\u003c/span\\u003e\\u003cspan class=\\"sh\_\_token--string\\" style=\\"color: var(--sh-string)\\"\\u003e/tmp/some-file.zip\\u003c/span\\u003e\\u003cspan class=\\"sh\_\_token--string\\" style=\\"color: var(--sh-string)\\"\\u003e\\u0026quot;\\u003c/span\\u003e\\u003cspan class=\\"sh\_\_token--sign\\" style=\\"color: var(--sh-sign)\\"\\u003e;\\u003c/span\\u003e\\u003cspan class=\\"sh\_\_token--break\\" style=\\"color: var(--sh-break)\\"\\u003e\\u003c/span\\u003e\\u003c/span\\u003e\\n\\u003cspan class=\\"sh\_\_line\\"\\u003e\\u003cspan class=\\"sh\_\_token--space\\" style=\\"color: var(--sh-space)\\"\\u003e \\u003c/span\\u003e\\u003cspan class=\\"sh\_\_token--keyword\\" style=\\"color: var(--sh-keyword)\\"\\u003econst\\u003c/span\\u003e\\u003cspan class=\\"sh\_\_token--space\\" style=\\"color: var(--sh-space)\\"\\u003e \\u003c/span\\u003e\\u003cspan class=\\"sh\_\_token--identifier\\" style=\\"color: var(--sh-identifier)\\"\\u003estats\\u003c/span\\u003e\\u003cspan class=\\"sh\_\_token--space\\" style=\\"color: var(--sh-space)\\"\\u003e \\u003c/span\\u003e\\u003cspan class=\\"sh\_\_token--sign\\" style=\\"color: var(--sh-sign)\\"\\u003e=\\u003c/span\\u003e\\u003cspan class=\\"sh\_\_token--space\\" style=\\"color: var(--sh-space)\\"\\u003e \\u003c/span\\u003e\\u003cspan class=\\"sh\_\_token--keyword\\" style=\\"color: var(--sh-keyword)\\"\\u003eawait\\u003c/span\\u003e\\u003cspan class=\\"sh\_\_token--space\\" style=\\"color: var(--sh-space)\\"\\u003e \\u003c/span\\u003e\\u003cspan class=\\"sh\_\_token--identifier\\" style=\\"color: var(--sh-identifier)\\"\\u003efsPromises\\u003c/span\\u003e\\u003cspan class=\\"sh\_\_token--sign\\" style=\\"color: var(--sh-sign)\\"\\u003e.\\u003c/span\\u003e\\u003cspan class=\\"sh\_\_token--identifier\\" style=\\"color: var(--sh-identifier)\\"\\u003estat\\u003c/span\\u003e\\u003cspan class=\\"sh\_\_token--sign\\" style=\\"color: var(--sh-sign)\\"\\u003e(\\u003c/span\\u003e\\u003cspan class=\\"sh\_\_token--identifier\\" style=\\"color: var(--sh-identifier)\\"\\u003efilePath\\u003c/span\\u003e\\u003cspan class=\\"sh\_\_token--sign\\" style=\\"color: var(--sh-sign)\\"\\u003e)\\u003c/span\\u003e\\u003cspan class=\\"sh\_\_token--sign\\" style=\\"color: var(--sh-sign)\\"\\u003e;\\u003c/span\\u003e\\u003cspan class=\\"sh\_\_token--break\\" style=\\"color: var(--sh-break)\\"\\u003e\\u003c/span\\u003e\\u003c/span\\u003e\\n\\u003cspan class=\\"sh\_\_line\\"\\u003e\\u003cspan class=\\"sh\_\_token--space\\" style=\\"color: var(--sh-space)\\"\\u003e \\u003c/span\\u003e\\u003cspan class=\\"sh\_\_token--identifier\\" style=\\"color: var(--sh-identifier)\\"\\u003eres\\u003c/span\\u003e\\u003cspan class=\\"sh\_\_token--sign\\" style=\\"color: var(--sh-sign)\\"\\u003e.\\u003c/span\\u003e\\u003cspan class=\\"sh\_\_token--identifier\\" style=\\"color: var(--sh-identifier)\\"\\u003ewriteHead\\u003c/span\\u003e\\u003cspan class=\\"sh\_\_token--sign\\" style=\\"color: var(--sh-sign)\\"\\u003e(\\u003c/span\\u003e\\u003cspan class=\\"sh\_\_token--class\\" style=\\"color: var(--sh-class)\\"\\u003e200\\u003c/span\\u003e\\u003cspan class=\\"sh\_\_token--sign\\" style=\\"color: var(--sh-sign)\\"\\u003e,\\u003c/span\\u003e\\u003cspan class=\\"sh\_\_token--space\\" style=\\"color: var(--sh-space)\\"\\u003e \\u003c/span\\u003e\\u003cspan class=\\"sh\_\_token--sign\\" style=\\"color: var(--sh-sign)\\"\\u003e{\\u003c/span\\u003e\\u003cspan class=\\"sh\_\_token--break\\" style=\\"color: var(--sh-break)\\"\\u003e\\u003c/span\\u003e\\u003c/span\\u003e\\n\\u003cspan class=\\"sh\_\_line\\"\\u003e\\u003cspan class=\\"sh\_\_token--space\\" style=\\"color: var(--sh-space)\\"\\u003e \\u003c/span\\u003e\\u003cspan class=\\"sh\_\_token--string\\" style=\\"color: var(--sh-string)\\"\\u003e\\u0026quot;\\u003c/span\\u003e\\u003cspan class=\\"sh\_\_token--string\\" style=\\"color: var(--sh-string)\\"\\u003eContent-Disposition\\u003c/span\\u003e\\u003cspan class=\\"sh\_\_token--string\\" style=\\"color: var(--sh-string)\\"\\u003e\\u0026quot;\\u003c/span\\u003e\\u003cspan class=\\"sh\_\_token--sign\\" style=\\"color: var(--sh-sign)\\"\\u003e:\\u003c/span\\u003e\\u003cspan class=\\"sh\_\_token--space\\" style=\\"color: var(--sh-space)\\"\\u003e \\u003c/span\\u003e\\u003cspan class=\\"sh\_\_token--break\\" style=\\"color: var(--sh-break)\\"\\u003e\\u003c/span\\u003e\\u003c/span\\u003e\\n\\u003cspan class=\\"sh\_\_line\\"\\u003e\\u003cspan class=\\"sh\_\_token--space\\" style=\\"color: var(--sh-space)\\"\\u003e \\u003c/span\\u003e\\u003cspan class=\\"sh\_\_token--string\\" style=\\"color: var(--sh-string)\\"\\u003e\`\\u003c/span\\u003e\\u003cspan class=\\"sh\_\_token--string\\" style=\\"color: var(--sh-string)\\"\\u003eattachment; filename=\\u003c/span\\u003e\\u003cspan class=\\"sh\_\_token--sign\\" style=\\"color: var(--sh-sign)\\"\\u003e${\\u003c/span\\u003e\\u003cspan class=\\"sh\_\_token--identifier\\" style=\\"color: var(--sh-identifier)\\"\\u003epath\\u003c/span\\u003e\\u003cspan class=\\"sh\_\_token--sign\\" style=\\"color: var(--sh-sign)\\"\\u003e.\\u003c/span\\u003e\\u003cspan class=\\"sh\_\_token--identifier\\" style=\\"color: var(--sh-identifier)\\"\\u003ebasename\\u003c/span\\u003e\\u003cspan class=\\"sh\_\_token--sign\\" style=\\"color: var(--sh-sign)\\"\\u003e(\\u003c/span\\u003e\\u003cspan class=\\"sh\_\_token--break\\" style=\\"color: var(--sh-break)\\"\\u003e\\u003c/span\\u003e\\u003c/span\\u003e\\n\\u003cspan class=\\"sh\_\_line\\"\\u003e\\u003cspan class=\\"sh\_\_token--space\\" style=\\"color: var(--sh-space)\\"\\u003e \\u003c/span\\u003e\\u003cspan class=\\"sh\_\_token--identifier\\" style=\\"color: var(--sh-identifier)\\"\\u003efilePath\\u003c/span\\u003e\\u003cspan class=\\"sh\_\_token--break\\" style=\\"color: var(--sh-break)\\"\\u003e\\u003c/span\\u003e\\u003c/span\\u003e\\n\\u003cspan class=\\"sh\_\_line\\"\\u003e\\u003cspan class=\\"sh\_\_token--space\\" style=\\"color: var(--sh-space)\\"\\u003e \\u003c/span\\u003e\\u003cspan class=\\"sh\_\_token--sign\\" style=\\"color: var(--sh-sign)\\"\\u003e)\\u003c/span\\u003e\\u003cspan class=\\"sh\_\_token--sign\\" style=\\"color: var(--sh-sign)\\"\\u003e}\\u003c/span\\u003e\\u003cspan class=\\"sh\_\_token--string\\" style=\\"color: var(--sh-string)\\"\\u003e\`\\u003c/span\\u003e\\u003cspan class=\\"sh\_\_token--sign\\" style=\\"color: var(--sh-sign)\\"\\u003e,\\u003c/span\\u003e\\u003cspan class=\\"sh\_\_token--break\\" style=\\"color: var(--sh-break)\\"\\u003e\\u003c/span\\u003e\\u003c/span\\u003e\\n\\u003cspan class=\\"sh\_\_line\\"\\u003e\\u003cspan class=\\"sh\_\_token--space\\" style=\\"color: var(--sh-space)\\"\\u003e \\u003c/span\\u003e\\u003cspan class=\\"sh\_\_token--string\\" style=\\"color: var(--sh-string)\\"\\u003e\\u0026quot;\\u003c/span\\u003e\\u003cspan class=\\"sh\_\_token--string\\" style=\\"color: var(--sh-string)\\"\\u003eContent-Type\\u003c/span\\u003e\\u003cspan class=\\"sh\_\_token--string\\" style=\\"color: var(--sh-string)\\"\\u003e\\u0026quot;\\u003c/span\\u003e\\u003cspan class=\\"sh\_\_token--sign\\" style=\\"color: var(--sh-sign)\\"\\u003e:\\u003c/span\\u003e\\u003cspan class=\\"sh\_\_token--space\\" style=\\"color: var(--sh-space)\\"\\u003e \\u003c/span\\u003e\\u003cspan class=\\"sh\_\_token--string\\" style=\\"color: var(--sh-string)\\"\\u003e\\u0026quot;\\u003c/span\\u003e\\u003cspan class=\\"sh\_\_token--string\\" style=\\"color: var(--sh-string)\\"\\u003eapplication/zip\\u003c/span\\u003e\\u003cspan class=\\"sh\_\_token--string\\" style=\\"color: var(--sh-string)\\"\\u003e\\u0026quot;\\u003c/span\\u003e\\u003cspan class=\\"sh\_\_token--sign\\" style=\\"color: var(--sh-sign)\\"\\u003e,\\u003c/span\\u003e\\u003cspan class=\\"sh\_\_token--break\\" style=\\"color: var(--sh-break)\\"\\u003e\\u003c/span\\u003e\\u003c/span\\u003e\\n\\u003cspan class=\\"sh\_\_line\\"\\u003e\\u003cspan class=\\"sh\_\_token--space\\" style=\\"color: var(--sh-space)\\"\\u003e \\u003c/span\\u003e\\u003cspan class=\\"sh\_\_token--string\\" style=\\"color: var(--sh-string)\\"\\u003e\\u0026quot;\\u003c/span\\u003e\\u003cspan class=\\"sh\_\_token--string\\" style=\\"color: var(--sh-string)\\"\\u003eContent-Length\\u003c/span\\u003e\\u003cspan class=\\"sh\_\_token--string\\" style=\\"color: var(--sh-string)\\"\\u003e\\u0026quot;\\u003c/span\\u003e\\u003cspan class=\\"sh\_\_token--sign\\" style=\\"color: var(--sh-sign)\\"\\u003e:\\u003c/span\\u003e\\u003cspan class=\\"sh\_\_token--space\\" style=\\"color: var(--sh-space)\\"\\u003e \\u003c/span\\u003e\\u003cspan class=\\"sh\_\_token--identifier\\" style=\\"color: var(--sh-identifier)\\"\\u003estats\\u003c/span\\u003e\\u003cspan class=\\"sh\_\_token--sign\\" style=\\"color: var(--sh-sign)\\"\\u003e.\\u003c/span\\u003e\\u003cspan class=\\"sh\_\_token--identifier\\" style=\\"color: var(--sh-identifier)\\"\\u003esize\\u003c/span\\u003e\\u003cspan class=\\"sh\_\_token--sign\\" style=\\"color: var(--sh-sign)\\"\\u003e,\\u003c/span\\u003e\\u003cspan class=\\"sh\_\_token--break\\" style=\\"color: var(--sh-break)\\"\\u003e\\u003c/span\\u003e\\u003c/span\\u003e\\n\\u003cspan class=\\"sh\_\_line\\"\\u003e\\u003cspan class=\\"sh\_\_token--space\\" style=\\"color: var(--sh-space)\\"\\u003e \\u003c/span\\u003e\\u003cspan class=\\"sh\_\_token--sign\\" style=\\"color: var(--sh-sign)\\"\\u003e}\\u003c/span\\u003e\\u003cspan class=\\"sh\_\_token--sign\\" style=\\"color: var(--sh-sign)\\"\\u003e)\\u003c/span\\u003e\\u003cspan class=\\"sh\_\_token--sign\\" style=\\"color: var(--sh-sign)\\"\\u003e;\\u003c/span\\u003e\\u003cspan class=\\"sh\_\_token--break\\" style=\\"color: var(--sh-break)\\"\\u003e\\u003c/span\\u003e\\u003c/span\\u003e\\n\\u003cspan class=\\"sh\_\_line\\"\\u003e\\u003cspan class=\\"sh\_\_token--space\\" style=\\"color: var(--sh-space)\\"\\u003e \\u003c/span\\u003e\\u003cspan class=\\"sh\_\_token--keyword\\" style=\\"color: var(--sh-keyword)\\"\\u003eawait\\u003c/span\\u003e\\u003cspan class=\\"sh\_\_token--space\\" style=\\"color: var(--sh-space)\\"\\u003e \\u003c/span\\u003e\\u003cspan class=\\"sh\_\_token--keyword\\" style=\\"color: var(--sh-keyword)\\"\\u003enew\\u003c/span\\u003e\\u003cspan class=\\"sh\_\_token--space\\" style=\\"color: var(--sh-space)\\"\\u003e \\u003c/span\\u003e\\u003cspan class=\\"sh\_\_token--class\\" style=\\"color: var(--sh-class)\\"\\u003ePromise\\u003c/span\\u003e\\u003cspan class=\\"sh\_\_token--sign\\" style=\\"color: var(--sh-sign)\\"\\u003e(\\u003c/span\\u003e\\u003cspan class=\\"sh\_\_token--keyword\\" style=\\"color: var(--sh-keyword)\\"\\u003efunction\\u003c/span\\u003e\\u003cspan class=\\"sh\_\_token--space\\" style=\\"color: var(--sh-space)\\"\\u003e \\u003c/span\\u003e\\u003cspan class=\\"sh\_\_token--sign\\" style=\\"color: var(--sh-sign)\\"\\u003e(\\u003c/span\\u003e\\u003cspan class=\\"sh\_\_token--identifier\\" style=\\"color: var(--sh-identifier)\\"\\u003eresolve\\u003c/span\\u003e\\u003cspan class=\\"sh\_\_token--sign\\" style=\\"color: var(--sh-sign)\\"\\u003e)\\u003c/span\\u003e\\u003cspan class=\\"sh\_\_token--space\\" style=\\"color: var(--sh-space)\\"\\u003e \\u003c/span\\u003e\\u003cspan class=\\"sh\_\_token--sign\\" style=\\"color: var(--sh-sign)\\"\\u003e{\\u003c/span\\u003e\\u003cspan class=\\"sh\_\_token--break\\" style=\\"color: var(--sh-break)\\"\\u003e\\u003c/span\\u003e\\u003c/span\\u003e\\n\\u003cspan class=\\"sh\_\_line\\"\\u003e\\u003cspan class=\\"sh\_\_token--space\\" style=\\"color: var(--sh-space)\\"\\u003e \\u003c/span\\u003e\\u003cspan class=\\"sh\_\_token--keyword\\" style=\\"color: var(--sh-keyword)\\"\\u003econst\\u003c/span\\u003e\\u003cspan class=\\"sh\_\_token--space\\" style=\\"color: var(--sh-space)\\"\\u003e \\u003c/span\\u003e\\u003cspan class=\\"sh\_\_token--identifier\\" style=\\"color: var(--sh-identifier)\\"\\u003enodeStream\\u003c/span\\u003e\\u003cspan class=\\"sh\_\_token--space\\" style=\\"color: var(--sh-space)\\"\\u003e \\u003c/span\\u003e\\u003cspan class=\\"sh\_\_token--sign\\" style=\\"color: var(--sh-sign)\\"\\u003e=\\u003c/span\\u003e\\u003cspan class=\\"sh\_\_token--space\\" style=\\"color: var(--sh-space)\\"\\u003e \\u003c/span\\u003e\\u003cspan class=\\"sh\_\_token--identifier\\" style=\\"color: var(--sh-identifier)\\"\\u003efs\\u003c/span\\u003e\\u003cspan class=\\"sh\_\_token--sign\\" style=\\"color: var(--sh-sign)\\"\\u003e.\\u003c/span\\u003e\\u003cspan class=\\"sh\_\_token--identifier\\" style=\\"color: var(--sh-identifier)\\"\\u003ecreateReadStream\\u003c/span\\u003e\\u003cspan class=\\"sh\_\_token--sign\\" style=\\"color: var(--sh-sign)\\"\\u003e(\\u003c/span\\u003e\\u003cspan class=\\"sh\_\_token--identifier\\" style=\\"color: var(--sh-identifier)\\"\\u003efilePath\\u003c/span\\u003e\\u003cspan class=\\"sh\_\_token--sign\\" style=\\"color: var(--sh-sign)\\"\\u003e)\\u003c/span\\u003e\\u003cspan class=\\"sh\_\_token--sign\\" style=\\"color: var(--sh-sign)\\"\\u003e;\\u003c/span\\u003e\\u003cspan class=\\"sh\_\_token--break\\" style=\\"color: var(--sh-break)\\"\\u003e\\u003c/span\\u003e\\u003c/span\\u003e\\n\\u003cspan class=\\"sh\_\_line\\"\\u003e\\u003cspan class=\\"sh\_\_token--space\\" style=\\"color: var(--sh-space)\\"\\u003e \\u003c/span\\u003e\\u003cspan class=\\"sh\_\_token--identifier\\" style=\\"color: var(--sh-identifier)\\"\\u003enodeStream\\u003c/span\\u003e\\u003cspan class=\\"sh\_\_token--sign\\" style=\\"color: var(--sh-sign)\\"\\u003e.\\u003c/span\\u003e\\u003cspan class=\\"sh\_\_token--identifier\\" style=\\"color: var(--sh-identifier)\\"\\u003epipe\\u003c/span\\u003e\\u003cspan class=\\"sh\_\_token--sign\\" style=\\"color: var(--sh-sign)\\"\\u003e(\\u003c/span\\u003e\\u003cspan class=\\"sh\_\_token--identifier\\" style=\\"color: var(--sh-identifier)\\"\\u003eres\\u003c/span\\u003e\\u003cspan class=\\"sh\_\_token--sign\\" style=\\"color: var(--sh-sign)\\"\\u003e)\\u003c/span\\u003e\\u003cspan class=\\"sh\_\_token--sign\\" style=\\"color: var(--sh-sign)\\"\\u003e;\\u003c/span\\u003e\\u003cspan class=\\"sh\_\_token--break\\" style=\\"color: var(--sh-break)\\"\\u003e\\u003c/span\\u003e\\u003c/span\\u003e\\n\\u003cspan class=\\"sh\_\_line\\"\\u003e\\u003cspan class=\\"sh\_\_token--space\\" style=\\"color: var(--sh-space)\\"\\u003e \\u003c/span\\u003e\\u003cspan class=\\"sh\_\_token--identifier\\" style=\\"color: var(--sh-identifier)\\"\\u003enodeStream\\u003c/span\\u003e\\u003cspan class=\\"sh\_\_token--sign\\" style=\\"color: var(--sh-sign)\\"\\u003e.\\u003c/span\\u003e\\u003cspan class=\\"sh\_\_token--identifier\\" style=\\"color: var(--sh-identifier)\\"\\u003eon\\u003c/span\\u003e\\u003cspan class=\\"sh\_\_token--sign\\" style=\\"color: var(--sh-sign)\\"\\u003e(\\u003c/span\\u003e\\u003cspan class=\\"sh\_\_token--string\\" style=\\"color: var(--sh-string)\\"\\u003e\\u0026quot;\\u003c/span\\u003e\\u003cspan class=\\"sh\_\_token--string\\" style=\\"color: var(--sh-string)\\"\\u003eend\\u003c/span\\u003e\\u003cspan class=\\"sh\_\_token--string\\" style=\\"color: var(--sh-string)\\"\\u003e\\u0026quot;\\u003c/span\\u003e\\u003cspan class=\\"sh\_\_token--sign\\" style=\\"color: var(--sh-sign)\\"\\u003e,\\u003c/span\\u003e\\u003cspan class=\\"sh\_\_token--space\\" style=\\"color: var(--sh-space)\\"\\u003e \\u003c/span\\u003e\\u003cspan class=\\"sh\_\_token--identifier\\" style=\\"color: var(--sh-identifier)\\"\\u003eresolve\\u003c/span\\u003e\\u003cspan class=\\"sh\_\_token--sign\\" style=\\"color: var(--sh-sign)\\"\\u003e)\\u003c/span\\u003e\\u003cspan class=\\"sh\_\_token--sign\\" style=\\"color: var(--sh-sign)\\"\\u003e;\\u003c/span\\u003e\\u003cspan class=\\"sh\_\_token--break\\" style=\\"color: var(--sh-break)\\"\\u003e\\u003c/span\\u003e\\u003c/span\\u003e\\n\\u003cspan class=\\"sh\_\_line\\"\\u003e\\u003cspan class=\\"sh\_\_token--space\\" style=\\"color: var(--sh-space)\\"\\u003e \\u003c/span\\u003e\\u003cspan class=\\"sh\_\_token--sign\\" style=\\"color: var(--sh-sign)\\"\\u003e}\\u003c/span\\u003e\\u003cspan class=\\"sh\_\_token--sign\\" style=\\"color: var(--sh-sign)\\"\\u003e)\\u003c/span\\u003e\\u003cspan class=\\"sh\_\_token--sign\\" style=\\"color: var(--sh-sign)\\"\\u003e;\\u003c/span\\u003e\\u003cspan class=\\"sh\_\_token--break\\" style=\\"color: var(--sh-break)\\"\\u003e\\u003c/span\\u003e\\u003c/span\\u003e\\n\\u003cspan class=\\"sh\_\_line\\"\\u003e\\u003cspan class=\\"sh\_\_token--sign\\" style=\\"color: var(--sh-sign)\\"\\u003e}\\u003c/span\\u003e\\u003cspan class=\\"sh\_\_token--break\\" style=\\"color: var(--sh-break)\\"\\u003e\\u003c/span\\u003e\\u003c/span\\u003e"\])self.\_\_next\_f.push(\[1,"26:Tc93,"\])self.\_\_next\_f.push(\[1,"\\u003cspan class=\\"sh\_\_line\\"\\u003e\\u003cspan class=\\"sh\_\_token--comment\\" style=\\"color: var(--sh-comment)\\"\\u003e// create a \\u0026quot;ReadStream\\u0026quot; \\u003c/span\\u003e\\u003c/span\\u003e\\n\\u003cspan class=\\"sh\_\_line\\"\\u003e\\u003cspan class=\\"sh\_\_token--comment\\" style=\\"color: var(--sh-comment)\\"\\u003e\\u003c/span\\u003e\\u003cspan class=\\"sh\_\_token--keyword\\" style=\\"color: var(--sh-keyword)\\"\\u003econst\\u003c/span\\u003e\\u003cspan class=\\"sh\_\_token--space\\" style=\\"color: var(--sh-space)\\"\\u003e \\u003c/span\\u003e\\u003cspan class=\\"sh\_\_token--identifier\\" style=\\"color: var(--sh-identifier)\\"\\u003enodeStream\\u003c/span\\u003e\\u003cspan class=\\"sh\_\_token--space\\" style=\\"color: var(--sh-space)\\"\\u003e \\u003c/span\\u003e\\u003cspan class=\\"sh\_\_token--sign\\" style=\\"color: var(--sh-sign)\\"\\u003e=\\u003c/span\\u003e\\u003cspan class=\\"sh\_\_token--space\\" style=\\"color: var(--sh-space)\\"\\u003e \\u003c/span\\u003e\\u003cspan class=\\"sh\_\_token--identifier\\" style=\\"color: var(--sh-identifier)\\"\\u003efs\\u003c/span\\u003e\\u003cspan class=\\"sh\_\_token--sign\\" style=\\"color: var(--sh-sign)\\"\\u003e.\\u003c/span\\u003e\\u003cspan class=\\"sh\_\_token--identifier\\" style=\\"color: var(--sh-identifier)\\"\\u003ecreateReadStream\\u003c/span\\u003e\\u003cspan class=\\"sh\_\_token--sign\\" style=\\"color: var(--sh-sign)\\"\\u003e(\\u003c/span\\u003e\\u003cspan class=\\"sh\_\_token--identifier\\" style=\\"color: var(--sh-identifier)\\"\\u003efilePath\\u003c/span\\u003e\\u003cspan class=\\"sh\_\_token--sign\\" style=\\"color: var(--sh-sign)\\"\\u003e)\\u003c/span\\u003e\\u003cspan class=\\"sh\_\_token--sign\\" style=\\"color: var(--sh-sign)\\"\\u003e;\\u003c/span\\u003e\\u003cspan class=\\"sh\_\_token--break\\" style=\\"color: var(--sh-break)\\"\\u003e\\u003c/span\\u003e\\u003c/span\\u003e\\n\\u003cspan class=\\"sh\_\_line\\"\\u003e\\u003cspan class=\\"sh\_\_token--space\\" style=\\"color: var(--sh-space)\\"\\u003e \\u003c/span\\u003e\\u003cspan class=\\"sh\_\_token--comment\\" style=\\"color: var(--sh-comment)\\"\\u003e// and pass it to a Response, which accepts a \\u0026quot;ReadStream\\u0026quot; object\\u003c/span\\u003e\\u003c/span\\u003e\\n\\u003cspan class=\\"sh\_\_line\\"\\u003e\\u003cspan class=\\"sh\_\_token--comment\\" style=\\"color: var(--sh-comment)\\"\\u003e\\u003c/span\\u003e\\u003cspan class=\\"sh\_\_token--space\\" style=\\"color: var(--sh-space)\\"\\u003e \\u003c/span\\u003e\\u003cspan class=\\"sh\_\_token--keyword\\" style=\\"color: var(--sh-keyword)\\"\\u003ereturn\\u003c/span\\u003e\\u003cspan class=\\"sh\_\_token--space\\" style=\\"color: var(--sh-space)\\"\\u003e \\u003c/span\\u003e\\u003cspan class=\\"sh\_\_token--keyword\\" style=\\"color: var(--sh-keyword)\\"\\u003enew\\u003c/span\\u003e\\u003cspan class=\\"sh\_\_token--space\\" style=\\"color: var(--sh-space)\\"\\u003e \\u003c/span\\u003e\\u003cspan class=\\"sh\_\_token--class\\" style=\\"color: var(--sh-class)\\"\\u003eResponse\\u003c/span\\u003e\\u003cspan class=\\"sh\_\_token--sign\\" style=\\"color: var(--sh-sign)\\"\\u003e(\\u003c/span\\u003e\\u003cspan class=\\"sh\_\_token--break\\" style=\\"color: var(--sh-break)\\"\\u003e\\u003c/span\\u003e\\u003c/span\\u003e\\n\\u003cspan class=\\"sh\_\_line\\"\\u003e\\u003cspan class=\\"sh\_\_token--space\\" style=\\"color: var(--sh-space)\\"\\u003e \\u003c/span\\u003e\\u003cspan class=\\"sh\_\_token--comment\\" style=\\"color: var(--sh-comment)\\"\\u003e// ❌ nope, that won\\u0026#039;t work! \\u003c/span\\u003e\\u003c/span\\u003e\\n\\u003cspan class=\\"sh\_\_line\\"\\u003e\\u003cspan class=\\"sh\_\_token--comment\\" style=\\"color: var(--sh-comment)\\"\\u003e\\u003c/span\\u003e\\u003cspan class=\\"sh\_\_token--space\\" style=\\"color: var(--sh-space)\\"\\u003e \\u003c/span\\u003e\\u003cspan class=\\"sh\_\_token--comment\\" style=\\"color: var(--sh-comment)\\"\\u003e// This is not the right type of \\u0026quot;stream\\u0026quot;!\\u003c/span\\u003e\\u003c/span\\u003e\\n\\u003cspan class=\\"sh\_\_line\\"\\u003e\\u003cspan class=\\"sh\_\_token--comment\\" style=\\"color: var(--sh-comment)\\"\\u003e\\u003c/span\\u003e\\u003cspan class=\\"sh\_\_token--space\\" style=\\"color: var(--sh-space)\\"\\u003e \\u003c/span\\u003e\\u003cspan class=\\"sh\_\_token--identifier\\" style=\\"color: var(--sh-identifier)\\"\\u003enodeStream\\u003c/span\\u003e\\u003cspan class=\\"sh\_\_token--sign\\" style=\\"color: var(--sh-sign)\\"\\u003e,\\u003c/span\\u003e\\u003cspan class=\\"sh\_\_token--space\\" style=\\"color: var(--sh-space)\\"\\u003e \\u003c/span\\u003e\\u003cspan class=\\"sh\_\_token--break\\" style=\\"color: var(--sh-break)\\"\\u003e\\u003c/span\\u003e\\u003c/span\\u003e"\])self.\_\_next\_f.push(\[1,"27:T1751,"\])self.\_\_next\_f.push(\[1,"\\u003cspan class=\\"sh\_\_line\\"\\u003e\\u003cspan class=\\"sh\_\_token--comment\\" style=\\"color: var(--sh-comment)\\"\\u003e// API route style for basic JSON data\\u003c/span\\u003e\\u003c/span\\u003e\\n\\u003cspan class=\\"sh\_\_line\\"\\u003e\\u003cspan class=\\"sh\_\_token--comment\\" style=\\"color: var(--sh-comment)\\"\\u003e\\u003c/span\\u003e\\u003cspan class=\\"sh\_\_token--identifier\\" style=\\"color: var(--sh-identifier)\\"\\u003eres\\u003c/span\\u003e\\u003cspan class=\\"sh\_\_token--sign\\" style=\\"color: var(--sh-sign)\\"\\u003e.\\u003c/span\\u003e\\u003cspan class=\\"sh\_\_token--identifier\\" style=\\"color: var(--sh-identifier)\\"\\u003esend\\u003c/span\\u003e\\u003cspan class=\\"sh\_\_token--sign\\" style=\\"color: var(--sh-sign)\\"\\u003e(\\u003c/span\\u003e\\u003cspan class=\\"sh\_\_token--sign\\" style=\\"color: var(--sh-sign)\\"\\u003e{\\u003c/span\\u003e\\u003cspan class=\\"sh\_\_token--identifier\\" style=\\"color: var(--sh-identifier)\\"\\u003efoo\\u003c/span\\u003e\\u003cspan class=\\"sh\_\_token--sign\\" style=\\"color: var(--sh-sign)\\"\\u003e:\\u003c/span\\u003e\\u003cspan class=\\"sh\_\_token--space\\" style=\\"color: var(--sh-space)\\"\\u003e \\u003c/span\\u003e\\u003cspan class=\\"sh\_\_token--string\\" style=\\"color: var(--sh-string)\\"\\u003e\\u0026quot;\\u003c/span\\u003e\\u003cspan class=\\"sh\_\_token--string\\" style=\\"color: var(--sh-string)\\"\\u003ebar\\u003c/span\\u003e\\u003cspan class=\\"sh\_\_token--string\\" style=\\"color: var(--sh-string)\\"\\u003e\\u0026quot;\\u003c/span\\u003e\\u003cspan class=\\"sh\_\_token--sign\\" style=\\"color: var(--sh-sign)\\"\\u003e}\\u003c/span\\u003e\\u003cspan class=\\"sh\_\_token--sign\\" style=\\"color: var(--sh-sign)\\"\\u003e)\\u003c/span\\u003e\\u003cspan class=\\"sh\_\_token--break\\" style=\\"color: var(--sh-break)\\"\\u003e\\u003c/span\\u003e\\u003c/span\\u003e\\n\\u003cspan class=\\"sh\_\_line\\"\\u003e\\u003cspan class=\\"sh\_\_token--break\\" style=\\"color: var(--sh-break)\\"\\u003e\\u003c/span\\u003e\\u003c/span\\u003e\\n\\u003cspan class=\\"sh\_\_line\\"\\u003e\\u003cspan class=\\"sh\_\_token--comment\\" style=\\"color: var(--sh-comment)\\"\\u003e// API route style for streaming files: \\u003c/span\\u003e\\u003c/span\\u003e\\n\\u003cspan class=\\"sh\_\_line\\"\\u003e\\u003cspan class=\\"sh\_\_token--comment\\" style=\\"color: var(--sh-comment)\\"\\u003e\\u003c/span\\u003e\\u003cspan class=\\"sh\_\_token--comment\\" style=\\"color: var(--sh-comment)\\"\\u003e// piping will send the HTTP response directly to the client\\u003c/span\\u003e\\u003c/span\\u003e\\n\\u003cspan class=\\"sh\_\_line\\"\\u003e\\u003cspan class=\\"sh\_\_token--comment\\" style=\\"color: var(--sh-comment)\\"\\u003e\\u003c/span\\u003e\\u003cspan class=\\"sh\_\_token--keyword\\" style=\\"color: var(--sh-keyword)\\"\\u003econst\\u003c/span\\u003e\\u003cspan class=\\"sh\_\_token--space\\" style=\\"color: var(--sh-space)\\"\\u003e \\u003c/span\\u003e\\u003cspan class=\\"sh\_\_token--identifier\\" style=\\"color: var(--sh-identifier)\\"\\u003enodeStream\\u003c/span\\u003e\\u003cspan class=\\"sh\_\_token--space\\" style=\\"color: var(--sh-space)\\"\\u003e \\u003c/span\\u003e\\u003cspan class=\\"sh\_\_token--sign\\" style=\\"color: var(--sh-sign)\\"\\u003e=\\u003c/span\\u003e\\u003cspan class=\\"sh\_\_token--space\\" style=\\"color: var(--sh-space)\\"\\u003e \\u003c/span\\u003e\\u003cspan class=\\"sh\_\_token--identifier\\" style=\\"color: var(--sh-identifier)\\"\\u003efs\\u003c/span\\u003e\\u003cspan class=\\"sh\_\_token--sign\\" style=\\"color: var(--sh-sign)\\"\\u003e.\\u003c/span\\u003e\\u003cspan class=\\"sh\_\_token--identifier\\" style=\\"color: var(--sh-identifier)\\"\\u003ecreateReadStream\\u003c/span\\u003e\\u003cspan class=\\"sh\_\_token--sign\\" style=\\"color: var(--sh-sign)\\"\\u003e(\\u003c/span\\u003e\\u003cspan class=\\"sh\_\_token--identifier\\" style=\\"color: var(--sh-identifier)\\"\\u003efilePath\\u003c/span\\u003e\\u003cspan class=\\"sh\_\_token--sign\\" style=\\"color: var(--sh-sign)\\"\\u003e)\\u003c/span\\u003e\\u003cspan class=\\"sh\_\_token--sign\\" style=\\"color: var(--sh-sign)\\"\\u003e;\\u003c/span\\u003e\\u003cspan class=\\"sh\_\_token--break\\" style=\\"color: var(--sh-break)\\"\\u003e\\u003c/span\\u003e\\u003c/span\\u003e\\n\\u003cspan class=\\"sh\_\_line\\"\\u003e\\u003cspan class=\\"sh\_\_token--identifier\\" style=\\"color: var(--sh-identifier)\\"\\u003enodeStream\\u003c/span\\u003e\\u003cspan class=\\"sh\_\_token--sign\\" style=\\"color: var(--sh-sign)\\"\\u003e.\\u003c/span\\u003e\\u003cspan class=\\"sh\_\_token--identifier\\" style=\\"color: var(--sh-identifier)\\"\\u003epipe\\u003c/span\\u003e\\u003cspan class=\\"sh\_\_token--sign\\" style=\\"color: var(--sh-sign)\\"\\u003e(\\u003c/span\\u003e\\u003cspan class=\\"sh\_\_token--identifier\\" style=\\"color: var(--sh-identifier)\\"\\u003eres\\u003c/span\\u003e\\u003cspan class=\\"sh\_\_token--sign\\" style=\\"color: var(--sh-sign)\\"\\u003e)\\u003c/span\\u003e\\u003cspan class=\\"sh\_\_token--sign\\" style=\\"color: var(--sh-sign)\\"\\u003e;\\u003c/span\\u003e\\u003cspan class=\\"sh\_\_token--break\\" style=\\"color: var(--sh-break)\\"\\u003e\\u003c/span\\u003e\\u003c/span\\u003e\\n\\u003cspan class=\\"sh\_\_line\\"\\u003e\\u003cspan class=\\"sh\_\_token--break\\" style=\\"color: var(--sh-break)\\"\\u003e\\u003c/span\\u003e\\u003c/span\\u003e\\n\\u003cspan class=\\"sh\_\_line\\"\\u003e\\u003cspan class=\\"sh\_\_token--comment\\" style=\\"color: var(--sh-comment)\\"\\u003e// Route Handler style for streaming: you return a Response object\\u003c/span\\u003e\\u003c/span\\u003e\\n\\u003cspan class=\\"sh\_\_line\\"\\u003e\\u003cspan class=\\"sh\_\_token--comment\\" style=\\"color: var(--sh-comment)\\"\\u003e\\u003c/span\\u003e\\u003cspan class=\\"sh\_\_token--comment\\" style=\\"color: var(--sh-comment)\\"\\u003e// and Next takes care of actually send an HTTP response\\u003c/span\\u003e\\u003c/span\\u003e\\n\\u003cspan class=\\"sh\_\_line\\"\\u003e\\u003cspan class=\\"sh\_\_token--comment\\" style=\\"color: var(--sh-comment)\\"\\u003e\\u003c/span\\u003e\\u003cspan class=\\"sh\_\_token--comment\\" style=\\"color: var(--sh-comment)\\"\\u003e// streamFile is the function we want to build in this article!\\u003c/span\\u003e\\u003c/span\\u003e\\n\\u003cspan class=\\"sh\_\_line\\"\\u003e\\u003cspan class=\\"sh\_\_token--comment\\" style=\\"color: var(--sh-comment)\\"\\u003e\\u003c/span\\u003e\\u003cspan class=\\"sh\_\_token--keyword\\" style=\\"color: var(--sh-keyword)\\"\\u003econst\\u003c/span\\u003e\\u003cspan class=\\"sh\_\_token--space\\" style=\\"color: var(--sh-space)\\"\\u003e \\u003c/span\\u003e\\u003cspan class=\\"sh\_\_token--identifier\\" style=\\"color: var(--sh-identifier)\\"\\u003ewebPlatformStream\\u003c/span\\u003e\\u003cspan class=\\"sh\_\_token--space\\" style=\\"color: var(--sh-space)\\"\\u003e \\u003c/span\\u003e\\u003cspan class=\\"sh\_\_token--sign\\" style=\\"color: var(--sh-sign)\\"\\u003e=\\u003c/span\\u003e\\u003cspan class=\\"sh\_\_token--space\\" style=\\"color: var(--sh-space)\\"\\u003e \\u003c/span\\u003e\\u003cspan class=\\"sh\_\_token--identifier\\" style=\\"color: var(--sh-identifier)\\"\\u003estreamFile\\u003c/span\\u003e\\u003cspan class=\\"sh\_\_token--sign\\" style=\\"color: var(--sh-sign)\\"\\u003e(\\u003c/span\\u003e\\u003cspan class=\\"sh\_\_token--identifier\\" style=\\"color: var(--sh-identifier)\\"\\u003efilePath\\u003c/span\\u003e\\u003cspan class=\\"sh\_\_token--sign\\" style=\\"color: var(--sh-sign)\\"\\u003e)\\u003c/span\\u003e\\u003cspan class=\\"sh\_\_token--break\\" style=\\"color: var(--sh-break)\\"\\u003e\\u003c/span\\u003e\\u003c/span\\u003e\\n\\u003cspan class=\\"sh\_\_line\\"\\u003e\\u003cspan class=\\"sh\_\_token--keyword\\" style=\\"color: var(--sh-keyword)\\"\\u003ereturn\\u003c/span\\u003e\\u003cspan class=\\"sh\_\_token--space\\" style=\\"color: var(--sh-space)\\"\\u003e \\u003c/span\\u003e\\u003cspan class=\\"sh\_\_token--class\\" style=\\"color: var(--sh-class)\\"\\u003eResponse\\u003c/span\\u003e\\u003cspan class=\\"sh\_\_token--sign\\" style=\\"color: var(--sh-sign)\\"\\u003e(\\u003c/span\\u003e\\u003cspan class=\\"sh\_\_token--identifier\\" style=\\"color: var(--sh-identifier)\\"\\u003ewebPlatformStream\\u003c/span\\u003e\\u003cspan class=\\"sh\_\_token--sign\\" style=\\"color: var(--sh-sign)\\"\\u003e)\\u003c/span\\u003e\\u003cspan class=\\"sh\_\_token--space\\" style=\\"color: var(--sh-space)\\"\\u003e \\u003c/span\\u003e\\u003cspan class=\\"sh\_\_token--comment\\" style=\\"color: var(--sh-comment)\\"\\u003e// the return is important\\u003c/span\\u003e\\u003c/span\\u003e\\n\\u003cspan class=\\"sh\_\_line\\"\\u003e\\u003cspan class=\\"sh\_\_token--comment\\" style=\\"color: var(--sh-comment)\\"\\u003e\\u003c/span\\u003e\\u003c/span\\u003e"\])self.\_\_next\_f.push(\[1,"28:T14da,"\])self.\_\_next\_f.push(\[1,"\\u003cspan class=\\"sh\_\_line\\"\\u003e\\u003cspan class=\\"sh\_\_token--comment\\" style=\\"color: var(--sh-comment)\\"\\u003e// Syntax taken from \\u003c/span\\u003e\\u003c/span\\u003e\\n\\u003cspan class=\\"sh\_\_line\\"\\u003e\\u003cspan class=\\"sh\_\_token--comment\\" style=\\"color: var(--sh-comment)\\"\\u003e\\u003c/span\\u003e\\u003cspan class=\\"sh\_\_token--comment\\" style=\\"color: var(--sh-comment)\\"\\u003e// https://github.com/MattMorgis/async-stream-generator\\u003c/span\\u003e\\u003c/span\\u003e\\n\\u003cspan class=\\"sh\_\_line\\"\\u003e\\u003cspan class=\\"sh\_\_token--comment\\" style=\\"color: var(--sh-comment)\\"\\u003e\\u003c/span\\u003e\\u003cspan class=\\"sh\_\_token--comment\\" style=\\"color: var(--sh-comment)\\"\\u003e// itself taken from \\u003c/span\\u003e\\u003c/span\\u003e\\n\\u003cspan class=\\"sh\_\_line\\"\\u003e\\u003cspan class=\\"sh\_\_token--comment\\" style=\\"color: var(--sh-comment)\\"\\u003e\\u003c/span\\u003e\\u003cspan class=\\"sh\_\_token--comment\\" style=\\"color: var(--sh-comment)\\"\\u003e// https://nextjs.org/docs/app/building-your-application/routing/router-handlers#streaming\\u003c/span\\u003e\\u003c/span\\u003e\\n\\u003cspan class=\\"sh\_\_line\\"\\u003e\\u003cspan class=\\"sh\_\_token--comment\\" style=\\"color: var(--sh-comment)\\"\\u003e\\u003c/span\\u003e\\u003cspan class=\\"sh\_\_token--comment\\" style=\\"color: var(--sh-comment)\\"\\u003e// probably itself taken from \\u003c/span\\u003e\\u003c/span\\u003e\\n\\u003cspan class=\\"sh\_\_line\\"\\u003e\\u003cspan class=\\"sh\_\_token--comment\\" style=\\"color: var(--sh-comment)\\"\\u003e\\u003c/span\\u003e\\u003cspan class=\\"sh\_\_token--comment\\" style=\\"color: var(--sh-comment)\\"\\u003e// https://nodejs.org/api/stream.html\\u003c/span\\u003e\\u003c/span\\u003e\\n\\u003cspan class=\\"sh\_\_line\\"\\u003e\\u003cspan class=\\"sh\_\_token--comment\\" style=\\"color: var(--sh-comment)\\"\\u003e\\u003c/span\\u003e\\u003cspan class=\\"sh\_\_token--comment\\" style=\\"color: var(--sh-comment)\\"\\u003e// Always quote your sources!\\u003c/span\\u003e\\u003c/span\\u003e\\n\\u003cspan class=\\"sh\_\_line\\"\\u003e\\u003cspan class=\\"sh\_\_token--comment\\" style=\\"color: var(--sh-comment)\\"\\u003e\\u003c/span\\u003e\\u003cspan class=\\"sh\_\_token--keyword\\" style=\\"color: var(--sh-keyword)\\"\\u003easync\\u003c/span\\u003e\\u003cspan class=\\"sh\_\_token--space\\" style=\\"color: var(--sh-space)\\"\\u003e \\u003c/span\\u003e\\u003cspan class=\\"sh\_\_token--keyword\\" style=\\"color: var(--sh-keyword)\\"\\u003efunction\\u003c/span\\u003e\\u003cspan class=\\"sh\_\_token--sign\\" style=\\"color: var(--sh-sign)\\"\\u003e\*\\u003c/span\\u003e\\u003cspan class=\\"sh\_\_token--space\\" style=\\"color: var(--sh-space)\\"\\u003e \\u003c/span\\u003e\\u003cspan class=\\"sh\_\_token--identifier\\" style=\\"color: var(--sh-identifier)\\"\\u003enodeStreamToIterator\\u003c/span\\u003e\\u003cspan class=\\"sh\_\_token--sign\\" style=\\"color: var(--sh-sign)\\"\\u003e(\\u003c/span\\u003e\\u003cspan class=\\"sh\_\_token--identifier\\" style=\\"color: var(--sh-identifier)\\"\\u003estream\\u003c/span\\u003e\\u003cspan class=\\"sh\_\_token--sign\\" style=\\"color: var(--sh-sign)\\"\\u003e:\\u003c/span\\u003e\\u003cspan class=\\"sh\_\_token--space\\" style=\\"color: var(--sh-space)\\"\\u003e \\u003c/span\\u003e\\u003cspan class=\\"sh\_\_token--identifier\\" style=\\"color: var(--sh-identifier)\\"\\u003efs\\u003c/span\\u003e\\u003cspan class=\\"sh\_\_token--sign\\" style=\\"color: var(--sh-sign)\\"\\u003e.\\u003c/span\\u003e\\u003cspan class=\\"sh\_\_token--class\\" style=\\"color: var(--sh-class)\\"\\u003eReadStream\\u003c/span\\u003e\\u003cspan class=\\"sh\_\_token--sign\\" style=\\"color: var(--sh-sign)\\"\\u003e)\\u003c/span\\u003e\\u003cspan class=\\"sh\_\_token--space\\" style=\\"color: var(--sh-space)\\"\\u003e \\u003c/span\\u003e\\u003cspan class=\\"sh\_\_token--sign\\" style=\\"color: var(--sh-sign)\\"\\u003e{\\u003c/span\\u003e\\u003cspan class=\\"sh\_\_token--break\\" style=\\"color: var(--sh-break)\\"\\u003e\\u003c/span\\u003e\\u003c/span\\u003e\\n\\u003cspan class=\\"sh\_\_line\\"\\u003e\\u003cspan class=\\"sh\_\_token--space\\" style=\\"color: var(--sh-space)\\"\\u003e \\u003c/span\\u003e\\u003cspan class=\\"sh\_\_token--keyword\\" style=\\"color: var(--sh-keyword)\\"\\u003efor\\u003c/span\\u003e\\u003cspan class=\\"sh\_\_token--space\\" style=\\"color: var(--sh-space)\\"\\u003e \\u003c/span\\u003e\\u003cspan class=\\"sh\_\_token--keyword\\" style=\\"color: var(--sh-keyword)\\"\\u003eawait\\u003c/span\\u003e\\u003cspan class=\\"sh\_\_token--space\\" style=\\"color: var(--sh-space)\\"\\u003e \\u003c/span\\u003e\\u003cspan class=\\"sh\_\_token--sign\\" style=\\"color: var(--sh-sign)\\"\\u003e(\\u003c/span\\u003e\\u003cspan class=\\"sh\_\_token--keyword\\" style=\\"color: var(--sh-keyword)\\"\\u003econst\\u003c/span\\u003e\\u003cspan class=\\"sh\_\_token--space\\" style=\\"color: var(--sh-space)\\"\\u003e \\u003c/span\\u003e\\u003cspan class=\\"sh\_\_token--identifier\\" style=\\"color: var(--sh-identifier)\\"\\u003echunk\\u003c/span\\u003e\\u003cspan class=\\"sh\_\_token--space\\" style=\\"color: var(--sh-space)\\"\\u003e \\u003c/span\\u003e\\u003cspan class=\\"sh\_\_token--identifier\\" style=\\"color: var(--sh-identifier)\\"\\u003eof\\u003c/span\\u003e\\u003cspan class=\\"sh\_\_token--space\\" style=\\"color: var(--sh-space)\\"\\u003e \\u003c/span\\u003e\\u003cspan class=\\"sh\_\_token--identifier\\" style=\\"color: var(--sh-identifier)\\"\\u003estream\\u003c/span\\u003e\\u003cspan class=\\"sh\_\_token--sign\\" style=\\"color: var(--sh-sign)\\"\\u003e)\\u003c/span\\u003e\\u003cspan class=\\"sh\_\_token--space\\" style=\\"color: var(--sh-space)\\"\\u003e \\u003c/span\\u003e\\u003cspan class=\\"sh\_\_token--sign\\" style=\\"color: var(--sh-sign)\\"\\u003e{\\u003c/span\\u003e\\u003cspan class=\\"sh\_\_token--break\\" style=\\"color: var(--sh-break)\\"\\u003e\\u003c/span\\u003e\\u003c/span\\u003e\\n\\u003cspan class=\\"sh\_\_line\\"\\u003e\\u003cspan class=\\"sh\_\_token--space\\" style=\\"color: var(--sh-space)\\"\\u003e \\u003c/span\\u003e\\u003cspan class=\\"sh\_\_token--keyword\\" style=\\"color: var(--sh-keyword)\\"\\u003eyield\\u003c/span\\u003e\\u003cspan class=\\"sh\_\_token--space\\" style=\\"color: var(--sh-space)\\"\\u003e \\u003c/span\\u003e\\u003cspan class=\\"sh\_\_token--keyword\\" style=\\"color: var(--sh-keyword)\\"\\u003enew\\u003c/span\\u003e\\u003cspan class=\\"sh\_\_token--space\\" style=\\"color: var(--sh-space)\\"\\u003e \\u003c/span\\u003e\\u003cspan class=\\"sh\_\_token--class\\" style=\\"color: var(--sh-class)\\"\\u003eUint8Array\\u003c/span\\u003e\\u003cspan class=\\"sh\_\_token--sign\\" style=\\"color: var(--sh-sign)\\"\\u003e(\\u003c/span\\u003e\\u003cspan class=\\"sh\_\_token--identifier\\" style=\\"color: var(--sh-identifier)\\"\\u003echunk\\u003c/span\\u003e\\u003cspan class=\\"sh\_\_token--sign\\" style=\\"color: var(--sh-sign)\\"\\u003e)\\u003c/span\\u003e\\u003cspan class=\\"sh\_\_token--sign\\" style=\\"color: var(--sh-sign)\\"\\u003e;\\u003c/span\\u003e\\u003cspan class=\\"sh\_\_token--break\\" style=\\"color: var(--sh-break)\\"\\u003e\\u003c/span\\u003e\\u003c/span\\u003e\\n\\u003cspan class=\\"sh\_\_line\\"\\u003e\\u003cspan class=\\"sh\_\_token--space\\" style=\\"color: var(--sh-space)\\"\\u003e \\u003c/span\\u003e\\u003cspan class=\\"sh\_\_token--sign\\" style=\\"color: var(--sh-sign)\\"\\u003e}\\u003c/span\\u003e\\u003cspan class=\\"sh\_\_token--break\\" style=\\"color: var(--sh-break)\\"\\u003e\\u003c/span\\u003e\\u003c/span\\u003e\\n\\u003cspan class=\\"sh\_\_line\\"\\u003e\\u003cspan class=\\"sh\_\_token--sign\\" style=\\"color: var(--sh-sign)\\"\\u003e}\\u003c/span\\u003e\\u003cspan class=\\"sh\_\_token--break\\" style=\\"color: var(--sh-break)\\"\\u003e\\u003c/span\\u003e\\u003c/span\\u003e"\])self.\_\_next\_f.push(\[1,"29:T2008,"\])self.\_\_next\_f.push(\[1,"\\u003cspan class=\\"sh\_\_line\\"\\u003e\\u003cspan class=\\"sh\_\_token--comment\\" style=\\"color: var(--sh-comment)\\"\\u003e// Provided by Mozilla Developer documentation\\u003c/span\\u003e\\u003c/span\\u003e\\n\\u003cspan class=\\"sh\_\_line\\"\\u003e\\u003cspan class=\\"sh\_\_token--comment\\" style=\\"color: var(--sh-comment)\\"\\u003e\\u003c/span\\u003e\\u003cspan class=\\"sh\_\_token--comment\\" style=\\"color: var(--sh-comment)\\"\\u003e// https://developer.mozilla.org/en-US/docs/Web/API/ReadableStream#convert\_async\_iterator\_to\_stream\\u003c/span\\u003e\\u003c/span\\u003e\\n\\u003cspan class=\\"sh\_\_line\\"\\u003e\\u003cspan class=\\"sh\_\_token--comment\\" style=\\"color: var(--sh-comment)\\"\\u003e\\u003c/span\\u003e\\u003cspan class=\\"sh\_\_token--comment\\" style=\\"color: var(--sh-comment)\\"\\u003e// Please say thanks to Mozilla !!\\u003c/span\\u003e\\u003c/span\\u003e\\n\\u003cspan class=\\"sh\_\_line\\"\\u003e\\u003cspan class=\\"sh\_\_token--comment\\" style=\\"color: var(--sh-comment)\\"\\u003e\\u003c/span\\u003e\\u003cspan class=\\"sh\_\_token--keyword\\" style=\\"color: var(--sh-keyword)\\"\\u003efunction\\u003c/span\\u003e\\u003cspan class=\\"sh\_\_token--space\\" style=\\"color: var(--sh-space)\\"\\u003e \\u003c/span\\u003e\\u003cspan class=\\"sh\_\_token--identifier\\" style=\\"color: var(--sh-identifier)\\"\\u003eiteratorToStream\\u003c/span\\u003e\\u003cspan class=\\"sh\_\_token--sign\\" style=\\"color: var(--sh-sign)\\"\\u003e(\\u003c/span\\u003e\\u003cspan class=\\"sh\_\_token--identifier\\" style=\\"color: var(--sh-identifier)\\"\\u003eiterator\\u003c/span\\u003e\\u003cspan class=\\"sh\_\_token--sign\\" style=\\"color: var(--sh-sign)\\"\\u003e)\\u003c/span\\u003e\\u003cspan class=\\"sh\_\_token--space\\" style=\\"color: var(--sh-space)\\"\\u003e \\u003c/span\\u003e\\u003cspan class=\\"sh\_\_token--sign\\" style=\\"color: var(--sh-sign)\\"\\u003e{\\u003c/span\\u003e\\u003cspan class=\\"sh\_\_token--break\\" style=\\"color: var(--sh-break)\\"\\u003e\\u003c/span\\u003e\\u003c/span\\u003e\\n\\u003cspan class=\\"sh\_\_line\\"\\u003e\\u003cspan class=\\"sh\_\_token--space\\" style=\\"color: var(--sh-space)\\"\\u003e \\u003c/span\\u003e\\u003cspan class=\\"sh\_\_token--keyword\\" style=\\"color: var(--sh-keyword)\\"\\u003ereturn\\u003c/span\\u003e\\u003cspan class=\\"sh\_\_token--space\\" style=\\"color: var(--sh-space)\\"\\u003e \\u003c/span\\u003e\\u003cspan class=\\"sh\_\_token--keyword\\" style=\\"color: var(--sh-keyword)\\"\\u003enew\\u003c/span\\u003e\\u003cspan class=\\"sh\_\_token--space\\" style=\\"color: var(--sh-space)\\"\\u003e \\u003c/span\\u003e\\u003cspan class=\\"sh\_\_token--class\\" style=\\"color: var(--sh-class)\\"\\u003eReadableStream\\u003c/span\\u003e\\u003cspan class=\\"sh\_\_token--sign\\" style=\\"color: var(--sh-sign)\\"\\u003e(\\u003c/span\\u003e\\u003cspan class=\\"sh\_\_token--sign\\" style=\\"color: var(--sh-sign)\\"\\u003e{\\u003c/span\\u003e\\u003cspan class=\\"sh\_\_token--break\\" style=\\"color: var(--sh-break)\\"\\u003e\\u003c/span\\u003e\\u003c/span\\u003e\\n\\u003cspan class=\\"sh\_\_line\\"\\u003e\\u003cspan class=\\"sh\_\_token--space\\" style=\\"color: var(--sh-space)\\"\\u003e \\u003c/span\\u003e\\u003cspan class=\\"sh\_\_token--keyword\\" style=\\"color: var(--sh-keyword)\\"\\u003easync\\u003c/span\\u003e\\u003cspan class=\\"sh\_\_token--space\\" style=\\"color: var(--sh-space)\\"\\u003e \\u003c/span\\u003e\\u003cspan class=\\"sh\_\_token--identifier\\" style=\\"color: var(--sh-identifier)\\"\\u003epull\\u003c/span\\u003e\\u003cspan class=\\"sh\_\_token--sign\\" style=\\"color: var(--sh-sign)\\"\\u003e(\\u003c/span\\u003e\\u003cspan class=\\"sh\_\_token--identifier\\" style=\\"color: var(--sh-identifier)\\"\\u003econtroller\\u003c/span\\u003e\\u003cspan class=\\"sh\_\_token--sign\\" style=\\"color: var(--sh-sign)\\"\\u003e)\\u003c/span\\u003e\\u003cspan class=\\"sh\_\_token--space\\" style=\\"color: var(--sh-space)\\"\\u003e \\u003c/span\\u003e\\u003cspan class=\\"sh\_\_token--sign\\" style=\\"color: var(--sh-sign)\\"\\u003e{\\u003c/span\\u003e\\u003cspan class=\\"sh\_\_token--break\\" style=\\"color: var(--sh-break)\\"\\u003e\\u003c/span\\u003e\\u003c/span\\u003e\\n\\u003cspan class=\\"sh\_\_line\\"\\u003e\\u003cspan class=\\"sh\_\_token--space\\" style=\\"color: var(--sh-space)\\"\\u003e \\u003c/span\\u003e\\u003cspan class=\\"sh\_\_token--keyword\\" style=\\"color: var(--sh-keyword)\\"\\u003econst\\u003c/span\\u003e\\u003cspan class=\\"sh\_\_token--space\\" style=\\"color: var(--sh-space)\\"\\u003e \\u003c/span\\u003e\\u003cspan class=\\"sh\_\_token--sign\\" style=\\"color: var(--sh-sign)\\"\\u003e{\\u003c/span\\u003e\\u003cspan class=\\"sh\_\_token--space\\" style=\\"color: var(--sh-space)\\"\\u003e \\u003c/span\\u003e\\u003cspan class=\\"sh\_\_token--identifier\\" style=\\"color: var(--sh-identifier)\\"\\u003evalue\\u003c/span\\u003e\\u003cspan class=\\"sh\_\_token--sign\\" style=\\"color: var(--sh-sign)\\"\\u003e,\\u003c/span\\u003e\\u003cspan class=\\"sh\_\_token--space\\" style=\\"color: var(--sh-space)\\"\\u003e \\u003c/span\\u003e\\u003cspan class=\\"sh\_\_token--identifier\\" style=\\"color: var(--sh-identifier)\\"\\u003edone\\u003c/span\\u003e\\u003cspan class=\\"sh\_\_token--space\\" style=\\"color: var(--sh-space)\\"\\u003e \\u003c/span\\u003e\\u003cspan class=\\"sh\_\_token--sign\\" style=\\"color: var(--sh-sign)\\"\\u003e}\\u003c/span\\u003e\\u003cspan class=\\"sh\_\_token--space\\" style=\\"color: var(--sh-space)\\"\\u003e \\u003c/span\\u003e\\u003cspan class=\\"sh\_\_token--sign\\" style=\\"color: var(--sh-sign)\\"\\u003e=\\u003c/span\\u003e\\u003cspan class=\\"sh\_\_token--space\\" style=\\"color: var(--sh-space)\\"\\u003e \\u003c/span\\u003e\\u003cspan class=\\"sh\_\_token--keyword\\" style=\\"color: var(--sh-keyword)\\"\\u003eawait\\u003c/span\\u003e\\u003cspan class=\\"sh\_\_token--space\\" style=\\"color: var(--sh-space)\\"\\u003e \\u003c/span\\u003e\\u003cspan class=\\"sh\_\_token--identifier\\" style=\\"color: var(--sh-identifier)\\"\\u003eiterator\\u003c/span\\u003e\\u003cspan class=\\"sh\_\_token--sign\\" style=\\"color: var(--sh-sign)\\"\\u003e.\\u003c/span\\u003e\\u003cspan class=\\"sh\_\_token--identifier\\" style=\\"color: var(--sh-identifier)\\"\\u003enext\\u003c/span\\u003e\\u003cspan class=\\"sh\_\_token--sign\\" style=\\"color: var(--sh-sign)\\"\\u003e(\\u003c/span\\u003e\\u003cspan class=\\"sh\_\_token--sign\\" style=\\"color: var(--sh-sign)\\"\\u003e)\\u003c/span\\u003e\\u003cspan class=\\"sh\_\_token--sign\\" style=\\"color: var(--sh-sign)\\"\\u003e;\\u003c/span\\u003e\\u003cspan class=\\"sh\_\_token--break\\" style=\\"color: var(--sh-break)\\"\\u003e\\u003c/span\\u003e\\u003c/span\\u003e\\n\\u003cspan class=\\"sh\_\_line\\"\\u003e\\u003cspan class=\\"sh\_\_token--space\\" style=\\"color: var(--sh-space)\\"\\u003e \\u003c/span\\u003e\\u003cspan class=\\"sh\_\_token--keyword\\" style=\\"color: var(--sh-keyword)\\"\\u003eif\\u003c/span\\u003e\\u003cspan class=\\"sh\_\_token--space\\" style=\\"color: var(--sh-space)\\"\\u003e \\u003c/span\\u003e\\u003cspan class=\\"sh\_\_token--sign\\" style=\\"color: var(--sh-sign)\\"\\u003e(\\u003c/span\\u003e\\u003cspan class=\\"sh\_\_token--identifier\\" style=\\"color: var(--sh-identifier)\\"\\u003edone\\u003c/span\\u003e\\u003cspan class=\\"sh\_\_token--sign\\" style=\\"color: var(--sh-sign)\\"\\u003e)\\u003c/span\\u003e\\u003cspan class=\\"sh\_\_token--space\\" style=\\"color: var(--sh-space)\\"\\u003e \\u003c/span\\u003e\\u003cspan class=\\"sh\_\_token--sign\\" style=\\"color: var(--sh-sign)\\"\\u003e{\\u003c/span\\u003e\\u003cspan class=\\"sh\_\_token--break\\" style=\\"color: var(--sh-break)\\"\\u003e\\u003c/span\\u003e\\u003c/span\\u003e\\n\\u003cspan class=\\"sh\_\_line\\"\\u003e\\u003cspan class=\\"sh\_\_token--space\\" style=\\"color: var(--sh-space)\\"\\u003e \\u003c/span\\u003e\\u003cspan class=\\"sh\_\_token--identifier\\" style=\\"color: var(--sh-identifier)\\"\\u003econtroller\\u003c/span\\u003e\\u003cspan class=\\"sh\_\_token--sign\\" style=\\"color: var(--sh-sign)\\"\\u003e.\\u003c/span\\u003e\\u003cspan class=\\"sh\_\_token--identifier\\" style=\\"color: var(--sh-identifier)\\"\\u003eclose\\u003c/span\\u003e\\u003cspan class=\\"sh\_\_token--sign\\" style=\\"color: var(--sh-sign)\\"\\u003e(\\u003c/span\\u003e\\u003cspan class=\\"sh\_\_token--sign\\" style=\\"color: var(--sh-sign)\\"\\u003e)\\u003c/span\\u003e\\u003cspan class=\\"sh\_\_token--sign\\" style=\\"color: var(--sh-sign)\\"\\u003e;\\u003c/span\\u003e\\u003cspan class=\\"sh\_\_token--break\\" style=\\"color: var(--sh-break)\\"\\u003e\\u003c/span\\u003e\\u003c/span\\u003e\\n\\u003cspan class=\\"sh\_\_line\\"\\u003e\\u003cspan class=\\"sh\_\_token--space\\" style=\\"color: var(--sh-space)\\"\\u003e \\u003c/span\\u003e\\u003cspan class=\\"sh\_\_token--sign\\" style=\\"color: var(--sh-sign)\\"\\u003e}\\u003c/span\\u003e\\u003cspan class=\\"sh\_\_token--space\\" style=\\"color: var(--sh-space)\\"\\u003e \\u003c/span\\u003e\\u003cspan class=\\"sh\_\_token--keyword\\" style=\\"color: var(--sh-keyword)\\"\\u003eelse\\u003c/span\\u003e\\u003cspan class=\\"sh\_\_token--space\\" style=\\"color: var(--sh-space)\\"\\u003e \\u003c/span\\u003e\\u003cspan class=\\"sh\_\_token--sign\\" style=\\"color: var(--sh-sign)\\"\\u003e{\\u003c/span\\u003e\\u003cspan class=\\"sh\_\_token--break\\" style=\\"color: var(--sh-break)\\"\\u003e\\u003c/span\\u003e\\u003c/span\\u003e\\n\\u003cspan class=\\"sh\_\_line\\"\\u003e\\u003cspan class=\\"sh\_\_token--space\\" style=\\"color: var(--sh-space)\\"\\u003e \\u003c/span\\u003e\\u003cspan class=\\"sh\_\_token--identifier\\" style=\\"color: var(--sh-identifier)\\"\\u003econtroller\\u003c/span\\u003e\\u003cspan class=\\"sh\_\_token--sign\\" style=\\"color: var(--sh-sign)\\"\\u003e.\\u003c/span\\u003e\\u003cspan class=\\"sh\_\_token--identifier\\" style=\\"color: var(--sh-identifier)\\"\\u003eenqueue\\u003c/span\\u003e\\u003cspan class=\\"sh\_\_token--sign\\" style=\\"color: var(--sh-sign)\\"\\u003e(\\u003c/span\\u003e\\u003cspan class=\\"sh\_\_token--identifier\\" style=\\"color: var(--sh-identifier)\\"\\u003evalue\\u003c/span\\u003e\\u003cspan class=\\"sh\_\_token--sign\\" style=\\"color: var(--sh-sign)\\"\\u003e)\\u003c/span\\u003e\\u003cspan class=\\"sh\_\_token--sign\\" style=\\"color: var(--sh-sign)\\"\\u003e;\\u003c/span\\u003e\\u003cspan class=\\"sh\_\_token--break\\" style=\\"color: var(--sh-break)\\"\\u003e\\u003c/span\\u003e\\u003c/span\\u003e\\n\\u003cspan class=\\"sh\_\_line\\"\\u003e\\u003cspan class=\\"sh\_\_token--space\\" style=\\"color: var(--sh-space)\\"\\u003e \\u003c/span\\u003e\\u003cspan class=\\"sh\_\_token--sign\\" style=\\"color: var(--sh-sign)\\"\\u003e}\\u003c/span\\u003e\\u003cspan class=\\"sh\_\_token--break\\" style=\\"color: var(--sh-break)\\"\\u003e\\u003c/span\\u003e\\u003c/span\\u003e\\n\\u003cspan class=\\"sh\_\_line\\"\\u003e\\u003cspan class=\\"sh\_\_token--space\\" style=\\"color: var(--sh-space)\\"\\u003e \\u003c/span\\u003e\\u003cspan class=\\"sh\_\_token--sign\\" style=\\"color: var(--sh-sign)\\"\\u003e}\\u003c/span\\u003e\\u003cspan class=\\"sh\_\_token--sign\\" style=\\"color: var(--sh-sign)\\"\\u003e,\\u003c/span\\u003e\\u003cspan class=\\"sh\_\_token--break\\" style=\\"color: var(--sh-break)\\"\\u003e\\u003c/span\\u003e\\u003c/span\\u003e\\n\\u003cspan class=\\"sh\_\_line\\"\\u003e\\u003cspan class=\\"sh\_\_token--space\\" style=\\"color: var(--sh-space)\\"\\u003e \\u003c/span\\u003e\\u003cspan class=\\"sh\_\_token--sign\\" style=\\"color: var(--sh-sign)\\"\\u003e}\\u003c/span\\u003e\\u003cspan class=\\"sh\_\_token--sign\\" style=\\"color: var(--sh-sign)\\"\\u003e)\\u003c/span\\u003e\\u003cspan class=\\"sh\_\_token--sign\\" style=\\"color: var(--sh-sign)\\"\\u003e;\\u003c/span\\u003e\\u003cspan class=\\"sh\_\_token--break\\" style=\\"color: var(--sh-break)\\"\\u003e\\u003c/span\\u003e\\u003c/span\\u003e\\n\\u003cspan class=\\"sh\_\_line\\"\\u003e\\u003cspan class=\\"sh\_\_token--sign\\" style=\\"color: var(--sh-sign)\\"\\u003e}\\u003c/span\\u003e\\u003cspan class=\\"sh\_\_token--break\\" style=\\"color: var(--sh-break)\\"\\u003e\\u003c/span\\u003e\\u003c/span\\u003e"\])self.\_\_next\_f.push(\[1,"2a:T14dc,"\])self.\_\_next\_f.push(\[1,"\\u003cspan class=\\"sh\_\_line\\"\\u003e\\u003cspan class=\\"sh\_\_token--comment\\" style=\\"color: var(--sh-comment)\\"\\u003e// This finally turns a file path into a ReadableStream!\\u003c/span\\u003e\\u003c/span\\u003e\\n\\u003cspan class=\\"sh\_\_line\\"\\u003e\\u003cspan class=\\"sh\_\_token--comment\\" style=\\"color: var(--sh-comment)\\"\\u003e\\u003c/span\\u003e\\u003cspan class=\\"sh\_\_token--keyword\\" style=\\"color: var(--sh-keyword)\\"\\u003eexport\\u003c/span\\u003e\\u003cspan class=\\"sh\_\_token--space\\" style=\\"color: var(--sh-space)\\"\\u003e \\u003c/span\\u003e\\u003cspan class=\\"sh\_\_token--keyword\\" style=\\"color: var(--sh-keyword)\\"\\u003efunction\\u003c/span\\u003e\\u003cspan class=\\"sh\_\_token--space\\" style=\\"color: var(--sh-space)\\"\\u003e \\u003c/span\\u003e\\u003cspan class=\\"sh\_\_token--identifier\\" style=\\"color: var(--sh-identifier)\\"\\u003estreamFile\\u003c/span\\u003e\\u003cspan class=\\"sh\_\_token--sign\\" style=\\"color: var(--sh-sign)\\"\\u003e(\\u003c/span\\u003e\\u003cspan class=\\"sh\_\_token--identifier\\" style=\\"color: var(--sh-identifier)\\"\\u003epath\\u003c/span\\u003e\\u003cspan class=\\"sh\_\_token--sign\\" style=\\"color: var(--sh-sign)\\"\\u003e:\\u003c/span\\u003e\\u003cspan class=\\"sh\_\_token--space\\" style=\\"color: var(--sh-space)\\"\\u003e \\u003c/span\\u003e\\u003cspan class=\\"sh\_\_token--identifier\\" style=\\"color: var(--sh-identifier)\\"\\u003estring\\u003c/span\\u003e\\u003cspan class=\\"sh\_\_token--sign\\" style=\\"color: var(--sh-sign)\\"\\u003e)\\u003c/span\\u003e\\u003cspan class=\\"sh\_\_token--sign\\" style=\\"color: var(--sh-sign)\\"\\u003e:\\u003c/span\\u003e\\u003cspan class=\\"sh\_\_token--space\\" style=\\"color: var(--sh-space)\\"\\u003e \\u003c/span\\u003e\\u003cspan class=\\"sh\_\_token--class\\" style=\\"color: var(--sh-class)\\"\\u003eReadableStream\\u003c/span\\u003e\\u003cspan class=\\"sh\_\_token--space\\" style=\\"color: var(--sh-space)\\"\\u003e \\u003c/span\\u003e\\u003cspan class=\\"sh\_\_token--sign\\" style=\\"color: var(--sh-sign)\\"\\u003e{\\u003c/span\\u003e\\u003cspan class=\\"sh\_\_token--break\\" style=\\"color: var(--sh-break)\\"\\u003e\\u003c/span\\u003e\\u003c/span\\u003e\\n\\u003cspan class=\\"sh\_\_line\\"\\u003e\\u003cspan class=\\"sh\_\_token--space\\" style=\\"color: var(--sh-space)\\"\\u003e \\u003c/span\\u003e\\u003cspan class=\\"sh\_\_token--keyword\\" style=\\"color: var(--sh-keyword)\\"\\u003econst\\u003c/span\\u003e\\u003cspan class=\\"sh\_\_token--space\\" style=\\"color: var(--sh-space)\\"\\u003e \\u003c/span\\u003e\\u003cspan class=\\"sh\_\_token--identifier\\" style=\\"color: var(--sh-identifier)\\"\\u003enodeStream\\u003c/span\\u003e\\u003cspan class=\\"sh\_\_token--space\\" style=\\"color: var(--sh-space)\\"\\u003e \\u003c/span\\u003e\\u003cspan class=\\"sh\_\_token--sign\\" style=\\"color: var(--sh-sign)\\"\\u003e=\\u003c/span\\u003e\\u003cspan class=\\"sh\_\_token--space\\" style=\\"color: var(--sh-space)\\"\\u003e \\u003c/span\\u003e\\u003cspan class=\\"sh\_\_token--identifier\\" style=\\"color: var(--sh-identifier)\\"\\u003efs\\u003c/span\\u003e\\u003cspan class=\\"sh\_\_token--sign\\" style=\\"color: var(--sh-sign)\\"\\u003e.\\u003c/span\\u003e\\u003cspan class=\\"sh\_\_token--identifier\\" style=\\"color: var(--sh-identifier)\\"\\u003ecreateReadStream\\u003c/span\\u003e\\u003cspan class=\\"sh\_\_token--sign\\" style=\\"color: var(--sh-sign)\\"\\u003e(\\u003c/span\\u003e\\u003cspan class=\\"sh\_\_token--identifier\\" style=\\"color: var(--sh-identifier)\\"\\u003epath\\u003c/span\\u003e\\u003cspan class=\\"sh\_\_token--sign\\" style=\\"color: var(--sh-sign)\\"\\u003e)\\u003c/span\\u003e\\u003cspan class=\\"sh\_\_token--sign\\" style=\\"color: var(--sh-sign)\\"\\u003e;\\u003c/span\\u003e\\u003cspan class=\\"sh\_\_token--break\\" style=\\"color: var(--sh-break)\\"\\u003e\\u003c/span\\u003e\\u003c/span\\u003e\\n\\u003cspan class=\\"sh\_\_line\\"\\u003e\\u003cspan class=\\"sh\_\_token--space\\" style=\\"color: var(--sh-space)\\"\\u003e \\u003c/span\\u003e\\u003cspan class=\\"sh\_\_token--keyword\\" style=\\"color: var(--sh-keyword)\\"\\u003econst\\u003c/span\\u003e\\u003cspan class=\\"sh\_\_token--space\\" style=\\"color: var(--sh-space)\\"\\u003e \\u003c/span\\u003e\\u003cspan class=\\"sh\_\_token--identifier\\" style=\\"color: var(--sh-identifier)\\"\\u003edata\\u003c/span\\u003e\\u003cspan class=\\"sh\_\_token--sign\\" style=\\"color: var(--sh-sign)\\"\\u003e:\\u003c/span\\u003e\\u003cspan class=\\"sh\_\_token--space\\" style=\\"color: var(--sh-space)\\"\\u003e \\u003c/span\\u003e\\u003cspan class=\\"sh\_\_token--class\\" style=\\"color: var(--sh-class)\\"\\u003eReadableStream\\u003c/span\\u003e\\u003cspan class=\\"sh\_\_token--space\\" style=\\"color: var(--sh-space)\\"\\u003e \\u003c/span\\u003e\\u003cspan class=\\"sh\_\_token--sign\\" style=\\"color: var(--sh-sign)\\"\\u003e=\\u003c/span\\u003e\\u003cspan class=\\"sh\_\_token--space\\" style=\\"color: var(--sh-space)\\"\\u003e \\u003c/span\\u003e\\u003cspan class=\\"sh\_\_token--identifier\\" style=\\"color: var(--sh-identifier)\\"\\u003eiteratorToStream\\u003c/span\\u003e\\u003cspan class=\\"sh\_\_token--sign\\" style=\\"color: var(--sh-sign)\\"\\u003e(\\u003c/span\\u003e\\u003cspan class=\\"sh\_\_token--break\\" style=\\"color: var(--sh-break)\\"\\u003e\\u003c/span\\u003e\\u003c/span\\u003e\\n\\u003cspan class=\\"sh\_\_line\\"\\u003e\\u003cspan class=\\"sh\_\_token--space\\" style=\\"color: var(--sh-space)\\"\\u003e \\u003c/span\\u003e\\u003cspan class=\\"sh\_\_token--identifier\\" style=\\"color: var(--sh-identifier)\\"\\u003enodeStreamToIterator\\u003c/span\\u003e\\u003cspan class=\\"sh\_\_token--sign\\" style=\\"color: var(--sh-sign)\\"\\u003e(\\u003c/span\\u003e\\u003cspan class=\\"sh\_\_token--break\\" style=\\"color: var(--sh-break)\\"\\u003e\\u003c/span\\u003e\\u003c/span\\u003e\\n\\u003cspan class=\\"sh\_\_line\\"\\u003e\\u003cspan class=\\"sh\_\_token--space\\" style=\\"color: var(--sh-space)\\"\\u003e \\u003c/span\\u003e\\u003cspan class=\\"sh\_\_token--identifier\\" style=\\"color: var(--sh-identifier)\\"\\u003enodeStream\\u003c/span\\u003e\\u003cspan class=\\"sh\_\_token--break\\" style=\\"color: var(--sh-break)\\"\\u003e\\u003c/span\\u003e\\u003c/span\\u003e\\n\\u003cspan class=\\"sh\_\_line\\"\\u003e\\u003cspan class=\\"sh\_\_token--space\\" style=\\"color: var(--sh-space)\\"\\u003e \\u003c/span\\u003e\\u003cspan class=\\"sh\_\_token--sign\\" style=\\"color: var(--sh-sign)\\"\\u003e)\\u003c/span\\u003e\\u003cspan class=\\"sh\_\_token--break\\" style=\\"color: var(--sh-break)\\"\\u003e\\u003c/span\\u003e\\u003c/span\\u003e\\n\\u003cspan class=\\"sh\_\_line\\"\\u003e\\u003cspan class=\\"sh\_\_token--space\\" style=\\"color: var(--sh-space)\\"\\u003e \\u003c/span\\u003e\\u003cspan class=\\"sh\_\_token--sign\\" style=\\"color: var(--sh-sign)\\"\\u003e)\\u003c/span\\u003e\\u003cspan class=\\"sh\_\_token--break\\" style=\\"color: var(--sh-break)\\"\\u003e\\u003c/span\\u003e\\u003c/span\\u003e\\n\\u003cspan class=\\"sh\_\_line\\"\\u003e\\u003cspan class=\\"sh\_\_token--space\\" style=\\"color: var(--sh-space)\\"\\u003e \\u003c/span\\u003e\\u003cspan class=\\"sh\_\_token--keyword\\" style=\\"color: var(--sh-keyword)\\"\\u003ereturn\\u003c/span\\u003e\\u003cspan class=\\"sh\_\_token--space\\" style=\\"color: var(--sh-space)\\"\\u003e \\u003c/span\\u003e\\u003cspan class=\\"sh\_\_token--identifier\\" style=\\"color: var(--sh-identifier)\\"\\u003edata\\u003c/span\\u003e\\u003cspan class=\\"sh\_\_token--break\\" style=\\"color: var(--sh-break)\\"\\u003e\\u003c/span\\u003e\\u003c/span\\u003e\\n\\u003cspan class=\\"sh\_\_line\\"\\u003e\\u003cspan class=\\"sh\_\_token--sign\\" style=\\"color: var(--sh-sign)\\"\\u003e}\\u003c/span\\u003e\\u003cspan class=\\"sh\_\_token--break\\" style=\\"color: var(--sh-break)\\"\\u003e\\u003c/span\\u003e\\u003c/span\\u003e"\])self.\_\_next\_f.push(\[1,"2b:T2782,"\])self.\_\_next\_f.push(\[1,"\\u003cspan class=\\"sh\_\_line\\"\\u003e\\u003cspan class=\\"sh\_\_token--space\\" style=\\"color: var(--sh-space)\\"\\u003e \\u003c/span\\u003e\\u003cspan class=\\"sh\_\_token--comment\\" style=\\"color: var(--sh-comment)\\"\\u003e// File \\u0026quot;app/api/serve-file/route.ts\\u0026quot;\\u003c/span\\u003e\\u003c/span\\u003e\\n\\u003cspan class=\\"sh\_\_line\\"\\u003e\\u003cspan class=\\"sh\_\_token--comment\\" style=\\"color: var(--sh-comment)\\"\\u003e\\u003c/span\\u003e\\u003cspan class=\\"sh\_\_token--space\\" style=\\"color: var(--sh-space)\\"\\u003e \\u003c/span\\u003e\\u003cspan class=\\"sh\_\_token--comment\\" style=\\"color: var(--sh-comment)\\"\\u003e// This is the final code, \\u003c/span\\u003e\\u003c/span\\u003e\\n\\u003cspan class=\\"sh\_\_line\\"\\u003e\\u003cspan class=\\"sh\_\_token--comment\\" style=\\"color: var(--sh-comment)\\"\\u003e\\u003c/span\\u003e\\u003cspan class=\\"sh\_\_token--space\\" style=\\"color: var(--sh-space)\\"\\u003e \\u003c/span\\u003e\\u003cspan class=\\"sh\_\_token--comment\\" style=\\"color: var(--sh-comment)\\"\\u003e// reusing the \\u0026quot;streamFile\\u0026quot; helper\\u003c/span\\u003e\\u003c/span\\u003e\\n\\u003cspan class=\\"sh\_\_line\\"\\u003e\\u003cspan class=\\"sh\_\_token--comment\\" style=\\"color: var(--sh-comment)\\"\\u003e\\u003c/span\\u003e\\u003cspan class=\\"sh\_\_token--space\\" style=\\"color: var(--sh-space)\\"\\u003e \\u003c/span\\u003e\\u003cspan class=\\"sh\_\_token--comment\\" style=\\"color: var(--sh-comment)\\"\\u003e// that we have crafted above\\u003c/span\\u003e\\u003c/span\\u003e\\n\\u003cspan class=\\"sh\_\_line\\"\\u003e\\u003cspan class=\\"sh\_\_token--comment\\" style=\\"color: var(--sh-comment)\\"\\u003e\\u003c/span\\u003e\\u003cspan class=\\"sh\_\_token--space\\" style=\\"color: var(--sh-space)\\"\\u003e \\u003c/span\\u003e\\u003cspan class=\\"sh\_\_token--keyword\\" style=\\"color: var(--sh-keyword)\\"\\u003econst\\u003c/span\\u003e\\u003cspan class=\\"sh\_\_token--space\\" style=\\"color: var(--sh-space)\\"\\u003e \\u003c/span\\u003e\\u003cspan class=\\"sh\_\_token--identifier\\" style=\\"color: var(--sh-identifier)\\"\\u003estats\\u003c/span\\u003e\\u003cspan class=\\"sh\_\_token--space\\" style=\\"color: var(--sh-space)\\"\\u003e \\u003c/span\\u003e\\u003cspan class=\\"sh\_\_token--sign\\" style=\\"color: var(--sh-sign)\\"\\u003e=\\u003c/span\\u003e\\u003cspan class=\\"sh\_\_token--space\\" style=\\"color: var(--sh-space)\\"\\u003e \\u003c/span\\u003e\\u003cspan class=\\"sh\_\_token--keyword\\" style=\\"color: var(--sh-keyword)\\"\\u003eawait\\u003c/span\\u003e\\u003cspan class=\\"sh\_\_token--space\\" style=\\"color: var(--sh-space)\\"\\u003e \\u003c/span\\u003e\\u003cspan class=\\"sh\_\_token--identifier\\" style=\\"color: var(--sh-identifier)\\"\\u003efsPromises\\u003c/span\\u003e\\u003cspan class=\\"sh\_\_token--sign\\" style=\\"color: var(--sh-sign)\\"\\u003e.\\u003c/span\\u003e\\u003cspan class=\\"sh\_\_token--identifier\\" style=\\"color: var(--sh-identifier)\\"\\u003estat\\u003c/span\\u003e\\u003cspan class=\\"sh\_\_token--sign\\" style=\\"color: var(--sh-sign)\\"\\u003e(\\u003c/span\\u003e\\u003cspan class=\\"sh\_\_token--identifier\\" style=\\"color: var(--sh-identifier)\\"\\u003efilePath\\u003c/span\\u003e\\u003cspan class=\\"sh\_\_token--sign\\" style=\\"color: var(--sh-sign)\\"\\u003e)\\u003c/span\\u003e\\u003cspan class=\\"sh\_\_token--sign\\" style=\\"color: var(--sh-sign)\\"\\u003e;\\u003c/span\\u003e\\u003cspan class=\\"sh\_\_token--break\\" style=\\"color: var(--sh-break)\\"\\u003e\\u003c/span\\u003e\\u003c/span\\u003e\\n\\u003cspan class=\\"sh\_\_line\\"\\u003e\\u003cspan class=\\"sh\_\_token--space\\" style=\\"color: var(--sh-space)\\"\\u003e \\u003c/span\\u003e\\u003cspan class=\\"sh\_\_token--keyword\\" style=\\"color: var(--sh-keyword)\\"\\u003econst\\u003c/span\\u003e\\u003cspan class=\\"sh\_\_token--space\\" style=\\"color: var(--sh-space)\\"\\u003e \\u003c/span\\u003e\\u003cspan class=\\"sh\_\_token--identifier\\" style=\\"color: var(--sh-identifier)\\"\\u003estream\\u003c/span\\u003e\\u003cspan class=\\"sh\_\_token--sign\\" style=\\"color: var(--sh-sign)\\"\\u003e:\\u003c/span\\u003e\\u003cspan class=\\"sh\_\_token--space\\" style=\\"color: var(--sh-space)\\"\\u003e \\u003c/span\\u003e\\u003cspan class=\\"sh\_\_token--class\\" style=\\"color: var(--sh-class)\\"\\u003eReadableStream\\u003c/span\\u003e\\u003cspan class=\\"sh\_\_token--space\\" style=\\"color: var(--sh-space)\\"\\u003e \\u003c/span\\u003e\\u003cspan class=\\"sh\_\_token--sign\\" style=\\"color: var(--sh-sign)\\"\\u003e=\\u003c/span\\u003e\\u003cspan class=\\"sh\_\_token--space\\" style=\\"color: var(--sh-space)\\"\\u003e \\u003c/span\\u003e\\u003cspan class=\\"sh\_\_token--identifier\\" style=\\"color: var(--sh-identifier)\\"\\u003estreamFile\\u003c/span\\u003e\\u003cspan class=\\"sh\_\_token--sign\\" style=\\"color: var(--sh-sign)\\"\\u003e(\\u003c/span\\u003e\\u003cspan class=\\"sh\_\_token--identifier\\" style=\\"color: var(--sh-identifier)\\"\\u003efilePath\\u003c/span\\u003e\\u003cspan class=\\"sh\_\_token--sign\\" style=\\"color: var(--sh-sign)\\"\\u003e)\\u003c/span\\u003e\\u003cspan class=\\"sh\_\_token--break\\" style=\\"color: var(--sh-break)\\"\\u003e\\u003c/span\\u003e\\u003c/span\\u003e\\n\\u003cspan class=\\"sh\_\_line\\"\\u003e\\u003cspan class=\\"sh\_\_token--space\\" style=\\"color: var(--sh-space)\\"\\u003e \\u003c/span\\u003e\\u003cspan class=\\"sh\_\_token--keyword\\" style=\\"color: var(--sh-keyword)\\"\\u003ereturn\\u003c/span\\u003e\\u003cspan class=\\"sh\_\_token--space\\" style=\\"color: var(--sh-space)\\"\\u003e \\u003c/span\\u003e\\u003cspan class=\\"sh\_\_token--keyword\\" style=\\"color: var(--sh-keyword)\\"\\u003enew\\u003c/span\\u003e\\u003cspan class=\\"sh\_\_token--space\\" style=\\"color: var(--sh-space)\\"\\u003e \\u003c/span\\u003e\\u003cspan class=\\"sh\_\_token--class\\" style=\\"color: var(--sh-class)\\"\\u003eResponse\\u003c/span\\u003e\\u003cspan class=\\"sh\_\_token--sign\\" style=\\"color: var(--sh-sign)\\"\\u003e(\\u003c/span\\u003e\\u003cspan class=\\"sh\_\_token--identifier\\" style=\\"color: var(--sh-identifier)\\"\\u003estream\\u003c/span\\u003e\\u003cspan class=\\"sh\_\_token--sign\\" style=\\"color: var(--sh-sign)\\"\\u003e,\\u003c/span\\u003e\\u003cspan class=\\"sh\_\_token--space\\" style=\\"color: var(--sh-space)\\"\\u003e \\u003c/span\\u003e\\u003cspan class=\\"sh\_\_token--sign\\" style=\\"color: var(--sh-sign)\\"\\u003e{\\u003c/span\\u003e\\u003cspan class=\\"sh\_\_token--break\\" style=\\"color: var(--sh-break)\\"\\u003e\\u003c/span\\u003e\\u003c/span\\u003e\\n\\u003cspan class=\\"sh\_\_line\\"\\u003e\\u003cspan class=\\"sh\_\_token--space\\" style=\\"color: var(--sh-space)\\"\\u003e \\u003c/span\\u003e\\u003cspan class=\\"sh\_\_token--identifier\\" style=\\"color: var(--sh-identifier)\\"\\u003estatus\\u003c/span\\u003e\\u003cspan class=\\"sh\_\_token--sign\\" style=\\"color: var(--sh-sign)\\"\\u003e:\\u003c/span\\u003e\\u003cspan class=\\"sh\_\_token--space\\" style=\\"color: var(--sh-space)\\"\\u003e \\u003c/span\\u003e\\u003cspan class=\\"sh\_\_token--class\\" style=\\"color: var(--sh-class)\\"\\u003e200\\u003c/span\\u003e\\u003cspan class=\\"sh\_\_token--sign\\" style=\\"color: var(--sh-sign)\\"\\u003e,\\u003c/span\\u003e\\u003cspan class=\\"sh\_\_token--break\\" style=\\"color: var(--sh-break)\\"\\u003e\\u003c/span\\u003e\\u003c/span\\u003e\\n\\u003cspan class=\\"sh\_\_line\\"\\u003e\\u003cspan class=\\"sh\_\_token--space\\" style=\\"color: var(--sh-space)\\"\\u003e \\u003c/span\\u003e\\u003cspan class=\\"sh\_\_token--identifier\\" style=\\"color: var(--sh-identifier)\\"\\u003eheaders\\u003c/span\\u003e\\u003cspan class=\\"sh\_\_token--sign\\" style=\\"color: var(--sh-sign)\\"\\u003e:\\u003c/span\\u003e\\u003cspan class=\\"sh\_\_token--space\\" style=\\"color: var(--sh-space)\\"\\u003e \\u003c/span\\u003e\\u003cspan class=\\"sh\_\_token--keyword\\" style=\\"color: var(--sh-keyword)\\"\\u003enew\\u003c/span\\u003e\\u003cspan class=\\"sh\_\_token--space\\" style=\\"color: var(--sh-space)\\"\\u003e \\u003c/span\\u003e\\u003cspan class=\\"sh\_\_token--class\\" style=\\"color: var(--sh-class)\\"\\u003eHeaders\\u003c/span\\u003e\\u003cspan class=\\"sh\_\_token--sign\\" style=\\"color: var(--sh-sign)\\"\\u003e(\\u003c/span\\u003e\\u003cspan class=\\"sh\_\_token--sign\\" style=\\"color: var(--sh-sign)\\"\\u003e{\\u003c/span\\u003e\\u003cspan class=\\"sh\_\_token--break\\" style=\\"color: var(--sh-break)\\"\\u003e\\u003c/span\\u003e\\u003c/span\\u003e\\n\\u003cspan class=\\"sh\_\_line\\"\\u003e\\u003cspan class=\\"sh\_\_token--space\\" style=\\"color: var(--sh-space)\\"\\u003e \\u003c/span\\u003e\\u003cspan class=\\"sh\_\_token--string\\" style=\\"color: var(--sh-string)\\"\\u003e\\u0026quot;\\u003c/span\\u003e\\u003cspan class=\\"sh\_\_token--string\\" style=\\"color: var(--sh-string)\\"\\u003econtent-disposition\\u003c/span\\u003e\\u003cspan class=\\"sh\_\_token--string\\" style=\\"color: var(--sh-string)\\"\\u003e\\u0026quot;\\u003c/span\\u003e\\u003cspan class=\\"sh\_\_token--sign\\" style=\\"color: var(--sh-sign)\\"\\u003e:\\u003c/span\\u003e\\u003cspan class=\\"sh\_\_token--space\\" style=\\"color: var(--sh-space)\\"\\u003e \\u003c/span\\u003e\\u003cspan class=\\"sh\_\_token--break\\" style=\\"color: var(--sh-break)\\"\\u003e\\u003c/span\\u003e\\u003c/span\\u003e\\n\\u003cspan class=\\"sh\_\_line\\"\\u003e\\u003cspan class=\\"sh\_\_token--space\\" style=\\"color: var(--sh-space)\\"\\u003e \\u003c/span\\u003e\\u003cspan class=\\"sh\_\_token--string\\" style=\\"color: var(--sh-string)\\"\\u003e\`\\u003c/span\\u003e\\u003cspan class=\\"sh\_\_token--string\\" style=\\"color: var(--sh-string)\\"\\u003eattachment; filename=\\u003c/span\\u003e\\u003cspan class=\\"sh\_\_token--sign\\" style=\\"color: var(--sh-sign)\\"\\u003e${\\u003c/span\\u003e\\u003cspan class=\\"sh\_\_token--identifier\\" style=\\"color: var(--sh-identifier)\\"\\u003epath\\u003c/span\\u003e\\u003cspan class=\\"sh\_\_token--sign\\" style=\\"color: var(--sh-sign)\\"\\u003e.\\u003c/span\\u003e\\u003cspan class=\\"sh\_\_token--identifier\\" style=\\"color: var(--sh-identifier)\\"\\u003ebasename\\u003c/span\\u003e\\u003cspan class=\\"sh\_\_token--sign\\" style=\\"color: var(--sh-sign)\\"\\u003e(\\u003c/span\\u003e\\u003cspan class=\\"sh\_\_token--break\\" style=\\"color: var(--sh-break)\\"\\u003e\\u003c/span\\u003e\\u003c/span\\u003e\\n\\u003cspan class=\\"sh\_\_line\\"\\u003e\\u003cspan class=\\"sh\_\_token--space\\" style=\\"color: var(--sh-space)\\"\\u003e \\u003c/span\\u003e\\u003cspan class=\\"sh\_\_token--identifier\\" style=\\"color: var(--sh-identifier)\\"\\u003efilePath\\u003c/span\\u003e\\u003cspan class=\\"sh\_\_token--break\\" style=\\"color: var(--sh-break)\\"\\u003e\\u003c/span\\u003e\\u003c/span\\u003e\\n\\u003cspan class=\\"sh\_\_line\\"\\u003e\\u003cspan class=\\"sh\_\_token--space\\" style=\\"color: var(--sh-space)\\"\\u003e \\u003c/span\\u003e\\u003cspan class=\\"sh\_\_token--sign\\" style=\\"color: var(--sh-sign)\\"\\u003e)\\u003c/span\\u003e\\u003cspan class=\\"sh\_\_token--sign\\" style=\\"color: var(--sh-sign)\\"\\u003e}\\u003c/span\\u003e\\u003cspan class=\\"sh\_\_token--string\\" style=\\"color: var(--sh-string)\\"\\u003e\`\\u003c/span\\u003e\\u003cspan class=\\"sh\_\_token--sign\\" style=\\"color: var(--sh-sign)\\"\\u003e,\\u003c/span\\u003e\\u003cspan class=\\"sh\_\_token--break\\" style=\\"color: var(--sh-break)\\"\\u003e\\u003c/span\\u003e\\u003c/span\\u003e\\n\\u003cspan class=\\"sh\_\_line\\"\\u003e\\u003cspan class=\\"sh\_\_token--space\\" style=\\"color: var(--sh-space)\\"\\u003e \\u003c/span\\u003e\\u003cspan class=\\"sh\_\_token--string\\" style=\\"color: var(--sh-string)\\"\\u003e\\u0026quot;\\u003c/span\\u003e\\u003cspan class=\\"sh\_\_token--string\\" style=\\"color: var(--sh-string)\\"\\u003econtent-type\\u003c/span\\u003e\\u003cspan class=\\"sh\_\_token--string\\" style=\\"color: var(--sh-string)\\"\\u003e\\u0026quot;\\u003c/span\\u003e\\u003cspan class=\\"sh\_\_token--sign\\" style=\\"color: var(--sh-sign)\\"\\u003e:\\u003c/span\\u003e\\u003cspan class=\\"sh\_\_token--space\\" style=\\"color: var(--sh-space)\\"\\u003e \\u003c/span\\u003e\\u003cspan class=\\"sh\_\_token--string\\" style=\\"color: var(--sh-string)\\"\\u003e\\u0026quot;\\u003c/span\\u003e\\u003cspan class=\\"sh\_\_token--string\\" style=\\"color: var(--sh-string)\\"\\u003eapplication/zip\\u003c/span\\u003e\\u003cspan class=\\"sh\_\_token--string\\" style=\\"color: var(--sh-string)\\"\\u003e\\u0026quot;\\u003c/span\\u003e\\u003cspan class=\\"sh\_\_token--sign\\" style=\\"color: var(--sh-sign)\\"\\u003e,\\u003c/span\\u003e\\u003cspan class=\\"sh\_\_token--break\\" style=\\"color: var(--sh-break)\\"\\u003e\\u003c/span\\u003e\\u003c/span\\u003e\\n\\u003cspan class=\\"sh\_\_line\\"\\u003e\\u003cspan class=\\"sh\_\_token--space\\" style=\\"color: var(--sh-space)\\"\\u003e \\u003c/span\\u003e\\u003cspan class=\\"sh\_\_token--string\\" style=\\"color: var(--sh-string)\\"\\u003e\\u0026quot;\\u003c/span\\u003e\\u003cspan class=\\"sh\_\_token--string\\" style=\\"color: var(--sh-string)\\"\\u003econtent-length\\u003c/span\\u003e\\u003cspan class=\\"sh\_\_token--string\\" style=\\"color: var(--sh-string)\\"\\u003e\\u0026quot;\\u003c/span\\u003e\\u003cspan class=\\"sh\_\_token--sign\\" style=\\"color: var(--sh-sign)\\"\\u003e:\\u003c/span\\u003e\\u003cspan class=\\"sh\_\_token--space\\" style=\\"color: var(--sh-space)\\"\\u003e \\u003c/span\\u003e\\u003cspan class=\\"sh\_\_token--identifier\\" style=\\"color: var(--sh-identifier)\\"\\u003estats\\u003c/span\\u003e\\u003cspan class=\\"sh\_\_token--sign\\" style=\\"color: var(--sh-sign)\\"\\u003e.\\u003c/span\\u003e\\u003cspan class=\\"sh\_\_token--identifier\\" style=\\"color: var(--sh-identifier)\\"\\u003esize\\u003c/span\\u003e\\u003cspan class=\\"sh\_\_token--space\\" style=\\"color: var(--sh-space)\\"\\u003e \\u003c/span\\u003e\\u003cspan class=\\"sh\_\_token--sign\\" style=\\"color: var(--sh-sign)\\"\\u003e+\\u003c/span\\u003e\\u003cspan class=\\"sh\_\_token--space\\" style=\\"color: var(--sh-space)\\"\\u003e \\u003c/span\\u003e\\u003cspan class=\\"sh\_\_token--string\\" style=\\"color: var(--sh-string)\\"\\u003e\\u0026quot;\\u003c/span\\u003e\\u003cspan class=\\"sh\_\_token--string\\" style=\\"color: var(--sh-string)\\"\\u003e\\u0026quot;\\u003c/span\\u003e\\u003cspan class=\\"sh\_\_token--sign\\" style=\\"color: var(--sh-sign)\\"\\u003e,\\u003c/span\\u003e\\u003cspan class=\\"sh\_\_token--break\\" style=\\"color: var(--sh-break)\\"\\u003e\\u003c/span\\u003e\\u003c/span\\u003e\\n\\u003cspan class=\\"sh\_\_line\\"\\u003e\\u003cspan class=\\"sh\_\_token--space\\" style=\\"color: var(--sh-space)\\"\\u003e \\u003c/span\\u003e\\u003cspan class=\\"sh\_\_token--sign\\" style=\\"color: var(--sh-sign)\\"\\u003e}\\u003c/span\\u003e\\u003cspan class=\\"sh\_\_token--sign\\" style=\\"color: var(--sh-sign)\\"\\u003e)\\u003c/span\\u003e\\u003cspan class=\\"sh\_\_token--break\\" style=\\"color: var(--sh-break)\\"\\u003e\\u003c/span\\u003e\\u003c/span\\u003e"\])self.\_\_next\_f.push(\[1,"b:\[\[\\"$\\",\\"p\\",null,{\\"children\\":\[\\"$\\",\\"img\\",null,{\\"alt\\":\\"Cover image\\",\\"className\\":\\"rounded-lg mx-auto\\",\\"src\\":\\"/posts/nextjs-stream-files/filestream.png\\"}\]}\],\\"\\\\n\\",\[\\"$\\",\\"p\\",null,{\\"children\\":\\"Well, I've tried hard to write a catchy introduction, explaining why files are so important in a developer's life and that you should definitely read this article.\\"}\],\\"\\\\n\\",\[\\"$\\",\\"p\\",null,{\\"children\\":\\"But the thing is that unless you just got out of a time machine, I am pretty sure you already now what a file is, that files are important for computers, and that files can be big.\\"}\],\\"\\\\n\\",\[\\"$\\",\\"p\\",null,{\\"children\\":\\"So let's skip it the babbling and dive directly into the question that bothers you : how to stream files from Next.js Route Handlers.\\"}\],\\"\\\\n\\",\[\\"$\\",\\"p\\",null,{\\"children\\":\\"You will learn:\\"}\],\\"\\\\n\\",\[\\"$\\",\\"ul\\",null,{\\"children\\":\[\\"\\\\n\\",\[\\"$\\",\\"li\\",null,{\\"children\\":\\"How to serve big files with Next.js without bloating your RAM, using API Routes and Route Handlers\\"}\],\\"\\\\n\\",\[\\"$\\",\\"li\\",null,{\\"children\\":\\"What are streams in Node.js and the browser\\"}\],\\"\\\\n\\",\[\\"$\\",\\"li\\",null,{\\"children\\":\\"The philosophical differences between API Routes and Route Handlers\\"}\],\\"\\\\n\\"\]}\],\\"\\\\n\\",\[\\"$\\",\\"blockquote\\",null,{\\"children\\":\[\\"\\\\n\\",\[\\"$\\",\\"p\\",null,{\\"children\\":\[\\"$\\",\\"strong\\",null,{\\"children\\":\[\\"UPDATE: I've just released a live demo of this pattern on \\",\[\\"$\\",\\"a\\",null,{\\"target\\":\\"\_blank\\",\\"rel\\":\\"noopener noreferrer\\",\\"href\\":\\"https://nextpatterns.dev/p/gems/route-handlers-file-streaming\\",\\"children\\":\\"NextPatterns.dev\\"}\],\\"!\\"\]}\]}\],\\"\\\\n\\"\]}\],\\"\\\\n\\",\[\\"$\\",\\"h2\\",null,{\\"id\\":\\"why-using-an-api-endpoint-to-serve-files-rather-than-the-public-folder\\",\\"children\\":\[\[\[\\"$\\",\\"a\\",\\"link-why-using-an-api-endpoint-to-serve-files-rather-than-the-public-folder\\",{\\"href\\":\\"#why-using-an-api-endpoint-to-serve-files-rather-than-the-public-folder\\",\\"className\\":\\"anchor\\"}\]\],\\"Why using an API endpoint to serve files, rather than the \\\\\\"public\\\\\\" folder?\\"\]}\],\\"\\\\n\\",\[\\"$\\",\\"p\\",null,{\\"children\\":\\"In Node.js applications, we traditionally use a \\\\\\"public\\\\\\" folder to serve files, like images, fonts, vendor scripts or the latest version of your resume in PDF.\\"}\],\\"\\\\n\\",\[\\"$\\",\\"p\\",null,{\\"children\\":\[\\"In Express.js, the public folder is setup in a single line of code (\\",\[\\"$\\",\\"a\\",null,{\\"target\\":\\"\_blank\\",\\"rel\\":\\"noopener noreferrer\\",\\"href\\":\\"https://expressjs.com/en/starter/static-files.html\\",\\"children\\":\\"documented here\\"}\],\\"):\\"\]}\],\\"\\\\n\\",\[\\"$\\",\\"pre\\",null,{\\"children\\":\[\\"$\\",\\"code\\",null,{\\"dangerouslySetInnerHTML\\":{\\"\_\_html\\":\\"$21\\"},\\"className\\":\\"language-js\\"}\]}\],\\"\\\\n\\",\[\\"$\\",\\"p\\",null,{\\"children\\":\[\\"In Next.js, this is done in 0 lines of code, because \\",\[\\"$\\",\\"a\\",null,{\\"target\\":\\"\_blank\\",\\"rel\\":\\"noopener noreferrer\\",\\"href\\":\\"https://nextjs.org/docs/pages/building-your-application/optimizing/static-assets\\",\\"children\\":\\"it works out of the box\\"}\],\\".\\"\]}\],\\"\\\\n\\",\[\\"$\\",\\"p\\",null,{\\"children\\":\\"However this works only for public, generic files. Next.js calls them \\\\\\"static assets\\\\\\". Yet, some files are neither public nor generic or static.\\"}\],\\"\\\\n\\",\[\\"$\\",\\"p\\",null,{\\"children\\":\\"Some counter-examples that don't fit the public folder:\\"}\],\\"\\\\n\\",\[\\"$\\",\\"ul\\",null,{\\"children\\":\[\\"\\\\n\\",\[\\"$\\",\\"li\\",null,{\\"children\\":\\"Personalized files: a generic url \\\\\\"/user/profile-picture\\\\\\" may serve a different image depending on the currently logged user\\"}\],\\"\\\\n\\",\[\\"$\\",\\"li\\",null,{\\"children\\":\\"Private files: you may want to check some permissions before serving \\\\\\"extremely\_confidential\_report.docx\\\\\\"\\"}\],\\"\\\\n\\",\[\\"$\\",\\"li\\",null,{\\"children\\":\\"Generated files: the State of JavaScript administration app can generate CSV exports of the responses to the survey. This means we generate the file on the fly depending on the selected survey when we receive an export request.\\"}\],\\"\\\\n\\"\]}\],\\"\\\\n\\",\[\\"$\\",\\"p\\",null,{\\"children\\":\[\\"For these files, you need to craft an API endpoint that returns the content of the file. \\",\[\\"$\\",\\"strong\\",null,{\\"children\\":\\"Let's do that.\\"}\]\]}\],\\"\\\\n\\",\[\\"$\\",\\"h2\\",null,{\\"id\\":\\"how-to-serve-files-in-nextjs-with-route-handlers-the-easy-way\\",\\"children\\":\[\[\[\\"$\\",\\"a\\",\\"link-how-to-serve-files-in-nextjs-with-route-handlers-the-easy-way\\",{\\"href\\":\\"#how-to-serve-files-in-nextjs-with-route-handlers-the-easy-way\\",\\"className\\":\\"anchor\\"}\]\],\\"How to serve files in Next.js with Route Handlers, the easy way\\"\]}\],\\"\\\\n\\",\[\\"$\\",\\"p\\",null,{\\"children\\":\\"The easy way to serve files is to load them in memory and then return the result. Here is the full-code that you may copy-paste to create a new route handler.\\"}\],\\"\\\\n\\",\[\\"$\\",\\"pre\\",null,{\\"children\\":\[\\"$\\",\\"code\\",null,{\\"dangerouslySetInnerHTML\\":{\\"\_\_html\\":\\"$22\\"},\\"className\\":\\"language-ts\\"}\]}\],\\"\\\\n\\",\[\\"$\\",\\"blockquote\\",null,{\\"children\\":\[\\"\\\\n\\",\[\\"$\\",\\"p\\",null,{\\"children\\":\[\\"Sometimes, instead of \\",\[\\"$\\",\\"code\\",null,{\\"dangerouslySetInnerHTML\\":{\\"\_\_html\\":\\"\\u003cspan class=\\\\\\"sh\_\_line\\\\\\"\\u003e\\u003cspan class=\\\\\\"sh\_\_token--class\\\\\\" style=\\\\\\"color: var(--sh-class)\\\\\\"\\u003eRequest\\u003c/span\\u003e\\u003c/span\\u003e\\"}}\],\\" and \\",\[\\"$\\",\\"code\\",null,{\\"dangerouslySetInnerHTML\\":{\\"\_\_html\\":\\"\\u003cspan class=\\\\\\"sh\_\_line\\\\\\"\\u003e\\u003cspan class=\\\\\\"sh\_\_token--class\\\\\\" style=\\\\\\"color: var(--sh-class)\\\\\\"\\u003eResponse\\u003c/span\\u003e\\u003c/span\\u003e\\"}}\],\\", you'll see \\",\[\\"$\\",\\"code\\",null,{\\"dangerouslySetInnerHTML\\":{\\"\_\_html\\":\\"\\u003cspan class=\\\\\\"sh\_\_line\\\\\\"\\u003e\\u003cspan class=\\\\\\"sh\_\_token--class\\\\\\" style=\\\\\\"color: var(--sh-class)\\\\\\"\\u003eNextResponse\\u003c/span\\u003e\\u003c/span\\u003e\\"}}\],\\" and \\",\[\\"$\\",\\"code\\",null,{\\"dangerouslySetInnerHTML\\":{\\"\_\_html\\":\\"\\u003cspan class=\\\\\\"sh\_\_line\\\\\\"\\u003e\\u003cspan class=\\\\\\"sh\_\_token--class\\\\\\" style=\\\\\\"color: var(--sh-class)\\\\\\"\\u003eNextRequest\\u003c/span\\u003e\\u003c/span\\u003e\\"}}\],\\". The Next versions are just wrappers around native \\",\[\\"$\\",\\"code\\",null,{\\"dangerouslySetInnerHTML\\":{\\"\_\_html\\":\\"\\u003cspan class=\\\\\\"sh\_\_line\\\\\\"\\u003e\\u003cspan class=\\\\\\"sh\_\_token--class\\\\\\" style=\\\\\\"color: var(--sh-class)\\\\\\"\\u003eResponse\\u003c/span\\u003e\\u003c/span\\u003e\\"}}\],\\" and \\",\[\\"$\\",\\"code\\",null,{\\"dangerouslySetInnerHTML\\":{\\"\_\_html\\":\\"\\u003cspan class=\\\\\\"sh\_\_line\\\\\\"\\u003e\\u003cspan class=\\\\\\"sh\_\_token--class\\\\\\" style=\\\\\\"color: var(--sh-class)\\\\\\"\\u003eRequest\\u003c/span\\u003e\\u003c/span\\u003e\\"}}\],\\" objects. They provide a few helpers like the parsed URL in the \\",\[\\"$\\",\\"code\\",null,{\\"dangerouslySetInnerHTML\\":{\\"\_\_html\\":\\"\\u003cspan class=\\\\\\"sh\_\_line\\\\\\"\\u003e\\u003cspan class=\\\\\\"sh\_\_token--identifier\\\\\\" style=\\\\\\"color: var(--sh-identifier)\\\\\\"\\u003enextUrl\\u003c/span\\u003e\\u003c/span\\u003e\\"}}\],\\" field.\\"\]}\],\\"\\\\n\\"\]}\],\\"\\\\n\\",\[\\"$\\",\\"p\\",null,{\\"children\\":\\"This is an intuitive solution, totally fine if you operate at a small scale.\\"}\],\\"\\\\n\\",\[\\"$\\",\\"p\\",null,{\\"children\\":\\"But the problem is that you have to load the whole file in memory before returning it.\\"}\],\\"\\\\n\\",\[\\"$\\",\\"p\\",null,{\\"children\\":\\"This is not good if the file is very big. Even if the file is small, if you have a high number of requests, this will also bloat your RAM.\\"}\],\\"\\\\n\\",\[\\"$\\",\\"pre\\",null,{\\"children\\":\[\\"$\\",\\"code\\",null,{\\"dangerouslySetInnerHTML\\":{\\"\_\_html\\":\\"$23\\"},\\"className\\":\\"language-ts\\"}\]}\],\\"\\\\n\\",\[\\"$\\",\\"p\\",null,{\\"children\\":\\"The solution to this limitation consists in streaming the file. It will be read in chunks that are immediately sent to the end user, which reduces the pressure on your server's RAM.\\"}\],\\"\\\\n\\",\[\\"$\\",\\"h2\\",null,{\\"id\\":\\"2024-update-one-liner-solution\\",\\"children\\":\[\[\[\\"$\\",\\"a\\",\\"link-2024-update-one-liner-solution\\",{\\"href\\":\\"#2024-update-one-liner-solution\\",\\"className\\":\\"anchor\\"}\]\],\\"2024 UPDATE : one-liner solution\\"\]}\],\\"\\\\n\\",\[\\"$\\",\\"p\\",null,{\\"children\\":\[\\"A new API has been brought to my attention lately (thanks \\",\[\\"$\\",\\"a\\",null,{\\"target\\":\\"\_blank\\",\\"rel\\":\\"noopener noreferrer\\",\\"href\\":\\"https://github.com/karlhorky\\",\\"children\\":\\"Karl Horky!\\"}\],\\"): \\",\[\\"$\\",\\"a\\",null,{\\"target\\":\\"\_blank\\",\\"rel\\":\\"noopener noreferrer\\",\\"href\\":\\"https://nodejs.org/docs/v20.16.0/api/fs.html#filehandlereadablewebstreamoptions\\",\\"children\\":\[\\"$\\",\\"code\\",null,{\\"dangerouslySetInnerHTML\\":{\\"\_\_html\\":\\"\\u003cspan class=\\\\\\"sh\_\_line\\\\\\"\\u003e\\u003cspan class=\\\\\\"sh\_\_token--identifier\\\\\\" style=\\\\\\"color: var(--sh-identifier)\\\\\\"\\u003efilehandle\\u003c/span\\u003e\\u003cspan class=\\\\\\"sh\_\_token--sign\\\\\\" style=\\\\\\"color: var(--sh-sign)\\\\\\"\\u003e.\\u003c/span\\u003e\\u003cspan class=\\\\\\"sh\_\_token--identifier\\\\\\" style=\\\\\\"color: var(--sh-identifier)\\\\\\"\\u003ereadableWebStream\\u003c/span\\u003e\\u003c/span\\u003e\\"}}\]}\],\\".\\"\]}\],\\"\\\\n\\",\[\\"$\\",\\"p\\",null,{\\"children\\":\\"It's an experimental Node.js feature that solves our issue in a single line of code:\\"}\],\\"\\\\n\\",\[\\"$\\",\\"pre\\",null,{\\"children\\":\[\\"$\\",\\"code\\",null,{\\"dangerouslySetInnerHTML\\":{\\"\_\_html\\":\\"$24\\"},\\"className\\":\\"language-ts\\"}\]}\],\\"\\\\n\\",\[\\"$\\",\\"p\\",null,{\\"children\\":\\"The remainder of this article describes alternative methods that works outside of Node.js.\\"}\],\\"\\\\n\\",\[\\"$\\",\\"h2\\",null,{\\"id\\":\\"how-to-stream-big-files-the-old-way-with-api-routes-nextjs-9\\",\\"children\\":\[\[\[\\"$\\",\\"a\\",\\"link-how-to-stream-big-files-the-old-way-with-api-routes-nextjs-9\\",{\\"href\\":\\"#how-to-stream-big-files-the-old-way-with-api-routes-nextjs-9\\",\\"className\\":\\"anchor\\"}\]\],\\"How to stream big files, the old way with API routes (Next.js 9+)\\"\]}\],\\"\\\\n\\",\[\\"$\\",\\"p\\",null,{\\"children\\":\\"Let's start with the traditional solution, using Next.js API Routes from the \\\\\\"Page Router\\\\\\" (aka the \\\\\\"pages\\\\\\" folder). Here is how you would stream files in an API Route, without copying them in memory.\\"}\],\\"\\\\n\\",\[\\"$\\",\\"p\\",null,{\\"children\\":\\"This is similar to what you could find in a typical Express application.\\"}\],\\"\\\\n\\",\[\\"$\\",\\"pre\\",null,{\\"children\\":\[\\"$\\",\\"code\\",null,{\\"dangerouslySetInnerHTML\\":{\\"\_\_html\\":\\"$25\\"},\\"className\\":\\"language-ts\\"}\]}\],\\"\\\\n\\",\[\\"$\\",\\"blockquote\\",null,{\\"children\\":\[\\"\\\\n\\",\[\\"$\\",\\"p\\",null,{\\"children\\":\[\[\\"$\\",\\"code\\",null,{\\"dangerouslySetInnerHTML\\":{\\"\_\_html\\":\\"\\u003cspan class=\\\\\\"sh\_\_line\\\\\\"\\u003e\\u003cspan class=\\\\\\"sh\_\_token--class\\\\\\" style=\\\\\\"color: var(--sh-class)\\\\\\"\\u003eNextApiRequest\\u003c/span\\u003e\\u003c/span\\u003e\\"}}\],\\"/\\",\[\\"$\\",\\"code\\",null,{\\"dangerouslySetInnerHTML\\":{\\"\_\_html\\":\\"\\u003cspan class=\\\\\\"sh\_\_line\\\\\\"\\u003e\\u003cspan class=\\\\\\"sh\_\_token--class\\\\\\" style=\\\\\\"color: var(--sh-class)\\\\\\"\\u003eNextApiResponse\\u003c/span\\u003e\\u003c/span\\u003e\\"}}\],\\" are for API Routes (Next 9+), while \\",\[\\"$\\",\\"code\\",null,{\\"dangerouslySetInnerHTML\\":{\\"\_\_html\\":\\"\\u003cspan class=\\\\\\"sh\_\_line\\\\\\"\\u003e\\u003cspan class=\\\\\\"sh\_\_token--class\\\\\\" style=\\\\\\"color: var(--sh-class)\\\\\\"\\u003eNextRequest\\u003c/span\\u003e\\u003c/span\\u003e\\"}}\],\\" and \\",\[\\"$\\",\\"code\\",null,{\\"dangerouslySetInnerHTML\\":{\\"\_\_html\\":\\"\\u003cspan class=\\\\\\"sh\_\_line\\\\\\"\\u003e\\u003cspan class=\\\\\\"sh\_\_token--class\\\\\\" style=\\\\\\"color: var(--sh-class)\\\\\\"\\u003eNextResponse\\u003c/span\\u003e\\u003c/span\\u003e\\"}}\],\\" are for \\",\[\\"$\\",\\"code\\",null,{\\"dangerouslySetInnerHTML\\":{\\"\_\_html\\":\\"\\u003cspan class=\\\\\\"sh\_\_line\\\\\\"\\u003e\\u003cspan class=\\\\\\"sh\_\_token--class\\\\\\" style=\\\\\\"color: var(--sh-class)\\\\\\"\\u003eRoute\\u003c/span\\u003e\\u003cspan class=\\\\\\"sh\_\_token--space\\\\\\" style=\\\\\\"color: var(--sh-space)\\\\\\"\\u003e \\u003c/span\\u003e\\u003cspan class=\\\\\\"sh\_\_token--class\\\\\\" style=\\\\\\"color: var(--sh-class)\\\\\\"\\u003eHandlers\\u003c/span\\u003e\\u003c/span\\u003e\\"}}\],\\" (Next 13+). They are totally different things, and not directly compatible! We'll explain this difference in the next section.\\"\]}\],\\"\\\\n\\"\]}\],\\"\\\\n\\",\[\\"$\\",\\"h2\\",null,{\\"id\\":\\"moving-to-route-handlers-its-not-that-easy\\",\\"children\\":\[\[\[\\"$\\",\\"a\\",\\"link-moving-to-route-handlers-its-not-that-easy\\",{\\"href\\":\\"#moving-to-route-handlers-its-not-that-easy\\",\\"className\\":\\"anchor\\"}\]\],\\"Moving to route handlers: it's not that easy\\"\]}\],\\"\\\\n\\",\[\\"$\\",\\"p\\",null,{\\"children\\":\\"Now imagine that we want to move to route handlers,\\\\nthe new way of creating API endpoints brought by Next.js App Router.\\"}\],\\"\\\\n\\",\[\\"$\\",\\"p\\",null,{\\"children\\":\\"Sadly, we can't copy-paste the code we wrote for the API Route\\\\ninto a Route Handler.\\"}\],\\"\\\\n\\",\[\\"$\\",\\"p\\",null,{\\"children\\":\[\\"The problem is that the stream expected by Route Handlers, or more precisely by the \\",\[\\"$\\",\\"code\\",null,{\\"dangerouslySetInnerHTML\\":{\\"\_\_html\\":\\"\\u003cspan class=\\\\\\"sh\_\_line\\\\\\"\\u003e\\u003cspan class=\\\\\\"sh\_\_token--class\\\\\\" style=\\\\\\"color: var(--sh-class)\\\\\\"\\u003eResponse\\u003c/span\\u003e\\u003c/span\\u003e\\"}}\],\\" constructor, is a \\\\\\"web platform stream\\\\\\". It is totally different from the \\",\[\\"$\\",\\"code\\",null,{\\"dangerouslySetInnerHTML\\":{\\"\_\_html\\":\\"\\u003cspan class=\\\\\\"sh\_\_line\\\\\\"\\u003e\\u003cspan class=\\\\\\"sh\_\_token--class\\\\\\" style=\\\\\\"color: var(--sh-class)\\\\\\"\\u003eReadStream\\u003c/span\\u003e\\u003c/span\\u003e\\"}}\],\\" structure we use in API Routes, which is defined by Node.js \\",\[\\"$\\",\\"code\\",null,{\\"dangerouslySetInnerHTML\\":{\\"\_\_html\\":\\"\\u003cspan class=\\\\\\"sh\_\_line\\\\\\"\\u003e\\u003cspan class=\\\\\\"sh\_\_token--identifier\\\\\\" style=\\\\\\"color: var(--sh-identifier)\\\\\\"\\u003efs\\u003c/span\\u003e\\u003c/span\\u003e\\"}}\],\\" package!\\"\]}\],\\"\\\\n\\",\[\\"$\\",\\"p\\",null,{\\"children\\":\[\\"You cannot just pass the result of \\",\[\\"$\\",\\"code\\",null,{\\"dangerouslySetInnerHTML\\":{\\"\_\_html\\":\\"\\u003cspan class=\\\\\\"sh\_\_line\\\\\\"\\u003e\\u003cspan class=\\\\\\"sh\_\_token--identifier\\\\\\" style=\\\\\\"color: var(--sh-identifier)\\\\\\"\\u003efs\\u003c/span\\u003e\\u003cspan class=\\\\\\"sh\_\_token--sign\\\\\\" style=\\\\\\"color: var(--sh-sign)\\\\\\"\\u003e.\\u003c/span\\u003e\\u003cspan class=\\\\\\"sh\_\_token--identifier\\\\\\" style=\\\\\\"color: var(--sh-identifier)\\\\\\"\\u003ecreateReadStream\\u003c/span\\u003e\\u003c/span\\u003e\\"}}\],\\" to a \\",\[\\"$\\",\\"code\\",null,{\\"dangerouslySetInnerHTML\\":{\\"\_\_html\\":\\"\\u003cspan class=\\\\\\"sh\_\_line\\\\\\"\\u003e\\u003cspan class=\\\\\\"sh\_\_token--class\\\\\\" style=\\\\\\"color: var(--sh-class)\\\\\\"\\u003eResponse\\u003c/span\\u003e\\u003c/span\\u003e\\"}}\],\\" object. This means we need an additional conversion step.\\"\]}\],\\"\\\\n\\",\[\\"$\\",\\"pre\\",null,{\\"children\\":\[\\"$\\",\\"code\\",null,{\\"dangerouslySetInnerHTML\\":{\\"\_\_html\\":\\"$26\\"},\\"className\\":\\"language-ts\\"}\]}\],\\"\\\\n\\",\[\\"$\\",\\"p\\",null,{\\"children\\":\\"This is unsettling, a stream is a stream, so why does this fail?\\"}\],\\"\\\\n\\",\[\\"$\\",\\"h2\\",null,{\\"id\\":\\"route-handlers-and-api-routes-are-built-on-different-paradigms\\",\\"children\\":\[\[\[\\"$\\",\\"a\\",\\"link-route-handlers-and-api-routes-are-built-on-different-paradigms\\",{\\"href\\":\\"#route-handlers-and-api-routes-are-built-on-different-paradigms\\",\\"className\\":\\"anchor\\"}\]\],\\"Route Handlers and API Routes are built on different paradigms\\"\]}\],\\"\\\\n\\",\[\\"$\\",\\"p\\",null,{\\"children\\":\\"The new Route Handlers differ quite a lot from traditional API Routes.\\"}\],\\"\\\\n\\",\[\\"$\\",\\"ul\\",null,{\\"children\\":\[\\"\\\\n\\",\[\\"$\\",\\"li\\",null,{\\"children\\":\[\\"\\\\n\\",\[\\"$\\",\\"p\\",null,{\\"children\\":\\"Next.js API Routes, which exist since version 9 and will be kept around likely forever, are based on Node.js. They are cousins to Express, that's why you can easily use Express middlewares and libraries, like Passport for authentication, in Next.js.\\"}\],\\"\\\\n\\"\]}\],\\"\\\\n\\",\[\\"$\\",\\"li\\",null,{\\"children\\":\[\\"\\\\n\\",\[\\"$\\",\\"p\\",null,{\\"children\\":\\"Route Handlers are newcomers brought by version 13. The main difference with API routes is that they are not strictly tied to Node.js. They will still use Node as the default runtime, but you can optionally use a lighter alternative called the \\\\\\"Edge Runtime\\\\\\".\\\\nMore broadly, this approach favors using JavaScript data structure that should exist in any runtime, be it Node.js, the Edge runtime, Deno, Bun or the runtime you are maybe building in your garage 'cause we need more.\\"}\],\\"\\\\n\\"\]}\],\\"\\\\n\\"\]}\],\\"\\\\n\\",\[\\"$\\",\\"p\\",null,{\\"children\\":\[\\"That's why Route Handlers use generic \\",\[\\"$\\",\\"code\\",null,{\\"dangerouslySetInnerHTML\\":{\\"\_\_html\\":\\"\\u003cspan class=\\\\\\"sh\_\_line\\\\\\"\\u003e\\u003cspan class=\\\\\\"sh\_\_token--class\\\\\\" style=\\\\\\"color: var(--sh-class)\\\\\\"\\u003eResponse\\u003c/span\\u003e\\u003c/span\\u003e\\"}}\],\\" and \\",\[\\"$\\",\\"code\\",null,{\\"dangerouslySetInnerHTML\\":{\\"\_\_html\\":\\"\\u003cspan class=\\\\\\"sh\_\_line\\\\\\"\\u003e\\u003cspan class=\\\\\\"sh\_\_token--class\\\\\\" style=\\\\\\"color: var(--sh-class)\\\\\\"\\u003eRequest\\u003c/span\\u003e\\u003c/span\\u003e\\"}}\],\\" objects, that were originally designed for the browser \\",\[\\"$\\",\\"code\\",null,{\\"dangerouslySetInnerHTML\\":{\\"\_\_html\\":\\"\\u003cspan class=\\\\\\"sh\_\_line\\\\\\"\\u003e\\u003cspan class=\\\\\\"sh\_\_token--identifier\\\\\\" style=\\\\\\"color: var(--sh-identifier)\\\\\\"\\u003efetch\\u003c/span\\u003e\\u003c/span\\u003e\\"}}\],\\" API.\\"\]}\],\\"\\\\n\\",\[\\"$\\",\\"p\\",null,{\\"children\\":\[\\"Also, handlers use a different approach for \\\\\\"responding\\\\\\" to the user HTTP request. In an API route, you call \\",\[\\"$\\",\\"code\\",null,{\\"dangerouslySetInnerHTML\\":{\\"\_\_html\\":\\"\\u003cspan class=\\\\\\"sh\_\_line\\\\\\"\\u003e\\u003cspan class=\\\\\\"sh\_\_token--identifier\\\\\\" style=\\\\\\"color: var(--sh-identifier)\\\\\\"\\u003eres\\u003c/span\\u003e\\u003cspan class=\\\\\\"sh\_\_token--sign\\\\\\" style=\\\\\\"color: var(--sh-sign)\\\\\\"\\u003e.\\u003c/span\\u003e\\u003cspan class=\\\\\\"sh\_\_token--identifier\\\\\\" style=\\\\\\"color: var(--sh-identifier)\\\\\\"\\u003esend\\u003c/span\\u003e\\u003c/span\\u003e\\"}}\],\\", or you pipe a stream to the \\",\[\\"$\\",\\"code\\",null,{\\"dangerouslySetInnerHTML\\":{\\"\_\_html\\":\\"\\u003cspan class=\\\\\\"sh\_\_line\\\\\\"\\u003e\\u003cspan class=\\\\\\"sh\_\_token--identifier\\\\\\" style=\\\\\\"color: var(--sh-identifier)\\\\\\"\\u003eres\\u003c/span\\u003e\\u003c/span\\u003e\\"}}\],\\" object. You don't need to return anything. In a Route Handler, you must return a \\",\[\\"$\\",\\"code\\",null,{\\"dangerouslySetInnerHTML\\":{\\"\_\_html\\":\\"\\u003cspan class=\\\\\\"sh\_\_line\\\\\\"\\u003e\\u003cspan class=\\\\\\"sh\_\_token--class\\\\\\" style=\\\\\\"color: var(--sh-class)\\\\\\"\\u003eResponse\\u003c/span\\u003e\\u003c/span\\u003e\\"}}\],\\" object. Then Next.js takes care of turning that into an HTTP response.\\"\]}\],\\"\\\\n\\",\[\\"$\\",\\"p\\",null,{\\"children\\":\\"Here is how the code will look like in each paradigm:\\"}\],\\"\\\\n\\",\[\\"$\\",\\"pre\\",null,{\\"children\\":\[\\"$\\",\\"code\\",null,{\\"dangerouslySetInnerHTML\\":{\\"\_\_html\\":\\"$27\\"},\\"className\\":\\"language-ts\\"}\]}\],\\"\\\\n\\",\[\\"$\\",\\"p\\",null,{\\"children\\":\\"I'd like to mention that you don't have to use Route Handlers at all if you don't want to!\\"}\],\\"\\\\n\\",\[\\"$\\",\\"p\\",null,{\\"children\\":\\"API Routes are fine and will be fine in any forseeable future. Features brought by Next 13+ App Router are great, but they are also sharp and hard to use. It's totally safe to wait a year or even more before even getting started with them.\\"}\],\\"\\\\n\\",\[\\"$\\",\\"p\\",null,{\\"children\\":\\"Now we understand why we have 2 different approaches. Route Handlers aim to be more generic than API routes, that are specific to Node.js.\\"}\],\\"\\\\n\\",\[\\"$\\",\\"p\\",null,{\\"children\\":\\"Still, if we do want a route handler, this means we need to learn how to convert Node-specific structures into generic web platform structures, and it requires a bit of work. Let's see how to get things done for streaming files.\\"}\],\\"\\\\n\\",\[\\"$\\",\\"h2\\",null,{\\"id\\":\\"from-nodejs-streams-to-web-platform-streams-via-generators\\",\\"children\\":\[\[\[\\"$\\",\\"a\\",\\"link-from-nodejs-streams-to-web-platform-streams-via-generators\\",{\\"href\\":\\"#from-nodejs-streams-to-web-platform-streams-via-generators\\",\\"className\\":\\"anchor\\"}\]\],\\"From Node.js streams to web platform streams via generators\\"\]}\],\\"\\\\n\\",\[\\"$\\",\\"p\\",null,{\\"children\\":\[\\"So, our problem is that we need to convert a Node.js \\",\[\\"$\\",\\"code\\",null,{\\"dangerouslySetInnerHTML\\":{\\"\_\_html\\":\\"\\u003cspan class=\\\\\\"sh\_\_line\\\\\\"\\u003e\\u003cspan class=\\\\\\"sh\_\_token--identifier\\\\\\" style=\\\\\\"color: var(--sh-identifier)\\\\\\"\\u003efs\\u003c/span\\u003e\\u003cspan class=\\\\\\"sh\_\_token--sign\\\\\\" style=\\\\\\"color: var(--sh-sign)\\\\\\"\\u003e.\\u003c/span\\u003e\\u003cspan class=\\\\\\"sh\_\_token--class\\\\\\" style=\\\\\\"color: var(--sh-class)\\\\\\"\\u003eReadStream\\u003c/span\\u003e\\u003c/span\\u003e\\"}}\],\\" to a web platform \\",\[\\"$\\",\\"code\\",null,{\\"dangerouslySetInnerHTML\\":{\\"\_\_html\\":\\"\\u003cspan class=\\\\\\"sh\_\_line\\\\\\"\\u003e\\u003cspan class=\\\\\\"sh\_\_token--class\\\\\\" style=\\\\\\"color: var(--sh-class)\\\\\\"\\u003eReadableStream\\u003c/span\\u003e\\u003c/span\\u003e\\"}}\],\\". We also need to take the difference of syntaxes between both worlds.\\"\]}\],\\"\\\\n\\",\[\\"$\\",\\"p\\",null,{\\"children\\":\[\\"When I first digged this issue, there was no documented solution, so I had to craft one. More precisely, I sewed various pieces of code found on Stack Overflow and Google (remember Lurch from the Adams Family? he's my fav). You can read the gory details on \\",\[\\"$\\",\\"a\\",null,{\\"target\\":\\"\_blank\\",\\"rel\\":\\"noopener noreferrer\\",\\"href\\":\\"https://stackoverflow.com/a/76780381/5513532\\",\\"children\\":\\"Stack Overflow\\"}\],\\".\\"\]}\],\\"\\\\n\\",\[\\"$\\",\\"p\\",null,{\\"children\\":\\"Generators are a generic data structure in JavaScript, so it should be possible to use them as an intermediate language between Node and the web platform.\\"}\],\\"\\\\n\\",\[\\"$\\",\\"blockquote\\",null,{\\"children\\":\[\\"\\\\n\\",\[\\"$\\",\\"p\\",null,{\\"children\\":\[\\"I will use the terms generator and iterator interchangeably. Formally, you use a generator function to produce an iterator. More details in \\",\[\\"$\\",\\"a\\",null,{\\"target\\":\\"\_blank\\",\\"rel\\":\\"noopener noreferrer\\",\\"href\\":\\"https://developer.mozilla.org/en-US/docs/Web/JavaScript/Guide/Iterators\_and\_generators\\",\\"children\\":\\"Mozilla Developer documentation\\"}\],\\".\\"\]}\],\\"\\\\n\\"\]}\],\\"\\\\n\\",\[\\"$\\",\\"p\\",null,{\\"children\\":\\"So here is the pseudocode we want to implement:\\"}\],\\"\\\\n\\",\[\\"$\\",\\"ol\\",null,{\\"children\\":\[\\"\\\\n\\",\[\\"$\\",\\"li\\",null,{\\"children\\":\[\\"Convert \\",\[\\"$\\",\\"code\\",null,{\\"dangerouslySetInnerHTML\\":{\\"\_\_html\\":\\"\\u003cspan class=\\\\\\"sh\_\_line\\\\\\"\\u003e\\u003cspan class=\\\\\\"sh\_\_token--identifier\\\\\\" style=\\\\\\"color: var(--sh-identifier)\\\\\\"\\u003efs\\u003c/span\\u003e\\u003cspan class=\\\\\\"sh\_\_token--sign\\\\\\" style=\\\\\\"color: var(--sh-sign)\\\\\\"\\u003e.\\u003c/span\\u003e\\u003cspan class=\\\\\\"sh\_\_token--class\\\\\\" style=\\\\\\"color: var(--sh-class)\\\\\\"\\u003eReadStream\\u003c/span\\u003e\\u003c/span\\u003e\\"}}\],\\" (given by Node.js) to a JavaScript iterator\\"\]}\],\\"\\\\n\\",\[\\"$\\",\\"li\\",null,{\\"children\\":\[\\"Convert JavaScript iterator to\\",\[\\"$\\",\\"code\\",null,{\\"dangerouslySetInnerHTML\\":{\\"\_\_html\\":\\"\\u003cspan class=\\\\\\"sh\_\_line\\\\\\"\\u003e\\u003cspan class=\\\\\\"sh\_\_token--class\\\\\\" style=\\\\\\"color: var(--sh-class)\\\\\\"\\u003eReadableStream\\u003c/span\\u003e\\u003c/span\\u003e\\"}}\],\\" (wanted by Next.js route handlers)\\"\]}\],\\"\\\\n\\"\]}\],\\"\\\\n\\",\[\\"$\\",\\"p\\",null,{\\"children\\":\\"If that sounds tricky, this is because it is tricky. We are trying to establish a link between 2 completely different worlds, Node.js world and the web platform world. I mean, it's literally involving generators!\\"}\],\\"\\\\n\\",\[\\"$\\",\\"h3\\",null,{\\"id\\":\\"step-1-from-fsreadstream-to-iterator\\",\\"children\\":\[\[\[\\"$\\",\\"a\\",\\"link-step-1-from-fsreadstream-to-iterator\\",{\\"href\\":\\"#step-1-from-fsreadstream-to-iterator\\",\\"className\\":\\"anchor\\"}\]\],\\"Step 1: from fs.ReadStream to iterator\\"\]}\],\\"\\\\n\\",\[\\"$\\",\\"p\\",null,{\\"children\\":\[\\"Here is a generator function that returns an iterator over an \\",\[\\"$\\",\\"code\\",null,{\\"dangerouslySetInnerHTML\\":{\\"\_\_html\\":\\"\\u003cspan class=\\\\\\"sh\_\_line\\\\\\"\\u003e\\u003cspan class=\\\\\\"sh\_\_token--identifier\\\\\\" style=\\\\\\"color: var(--sh-identifier)\\\\\\"\\u003efs\\u003c/span\\u003e\\u003cspan class=\\\\\\"sh\_\_token--sign\\\\\\" style=\\\\\\"color: var(--sh-sign)\\\\\\"\\u003e.\\u003c/span\\u003e\\u003cspan class=\\\\\\"sh\_\_token--class\\\\\\" style=\\\\\\"color: var(--sh-class)\\\\\\"\\u003eReadStream\\u003c/span\\u003e\\u003c/span\\u003e\\"}}\],\\":\\"\]}\],\\"\\\\n\\",\[\\"$\\",\\"pre\\",null,{\\"children\\":\[\\"$\\",\\"code\\",null,{\\"dangerouslySetInnerHTML\\":{\\"\_\_html\\":\\"$28\\"},\\"className\\":\\"language-ts\\"}\]}\],\\"\\\\n\\",\[\\"$\\",\\"p\\",null,{\\"children\\":\[\\"The \\",\[\\"$\\",\\"code\\",null,{\\"dangerouslySetInnerHTML\\":{\\"\_\_html\\":\\"\\u003cspan class=\\\\\\"sh\_\_line\\\\\\"\\u003e\\u003cspan class=\\\\\\"sh\_\_token--keyword\\\\\\" style=\\\\\\"color: var(--sh-keyword)\\\\\\"\\u003econst\\u003c/span\\u003e\\u003cspan class=\\\\\\"sh\_\_token--space\\\\\\" style=\\\\\\"color: var(--sh-space)\\\\\\"\\u003e \\u003c/span\\u003e\\u003cspan class=\\\\\\"sh\_\_token--identifier\\\\\\" style=\\\\\\"color: var(--sh-identifier)\\\\\\"\\u003echunk\\u003c/span\\u003e\\u003cspan class=\\\\\\"sh\_\_token--space\\\\\\" style=\\\\\\"color: var(--sh-space)\\\\\\"\\u003e \\u003c/span\\u003e\\u003cspan class=\\\\\\"sh\_\_token--identifier\\\\\\" style=\\\\\\"color: var(--sh-identifier)\\\\\\"\\u003eof\\u003c/span\\u003e\\u003cspan class=\\\\\\"sh\_\_token--space\\\\\\" style=\\\\\\"color: var(--sh-space)\\\\\\"\\u003e \\u003c/span\\u003e\\u003cspan class=\\\\\\"sh\_\_token--identifier\\\\\\" style=\\\\\\"color: var(--sh-identifier)\\\\\\"\\u003estream\\u003c/span\\u003e\\u003c/span\\u003e\\"}}\],\\" part read the file one chunk at a time. The \\",\[\\"$\\",\\"code\\",null,{\\"dangerouslySetInnerHTML\\":{\\"\_\_html\\":\\"\\u003cspan class=\\\\\\"sh\_\_line\\\\\\"\\u003e\\u003cspan class=\\\\\\"sh\_\_token--keyword\\\\\\" style=\\\\\\"color: var(--sh-keyword)\\\\\\"\\u003eawait\\u003c/span\\u003e\\u003c/span\\u003e\\"}}\],\\" part is just there because reading a chunk of a file is an asynchronous operation, similarly to reading the whole file. This is possible because Node.js streams are \\",\[\\"$\\",\\"a\\",null,{\\"target\\":\\"\_blank\\",\\"rel\\":\\"noopener noreferrer\\",\\"href\\":\\"https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global\_Objects/AsyncIterator\\",\\"children\\":\\"asynchronous iterators\\"}\],\\", so this syntax works on them.\\"\]}\],\\"\\\\n\\",\[\\"$\\",\\"p\\",null,{\\"children\\":\\"You may not be used to iterators, but basically think of them as arrays of arbitrary size (even infinite) that you can read one value by one value. That's why you \\\\\\"yield\\\\\\" one chunk of data, instead of returning the whole file.\\"}\],\\"\\\\n\\",\[\\"$\\",\\"p\\",null,{\\"children\\":\[\\"The \\",\[\\"$\\",\\"code\\",null,{\\"dangerouslySetInnerHTML\\":{\\"\_\_html\\":\\"\\u003cspan class=\\\\\\"sh\_\_line\\\\\\"\\u003e\\u003cspan class=\\\\\\"sh\_\_token--keyword\\\\\\" style=\\\\\\"color: var(--sh-keyword)\\\\\\"\\u003enew\\u003c/span\\u003e\\u003cspan class=\\\\\\"sh\_\_token--space\\\\\\" style=\\\\\\"color: var(--sh-space)\\\\\\"\\u003e \\u003c/span\\u003e\\u003cspan class=\\\\\\"sh\_\_token--class\\\\\\" style=\\\\\\"color: var(--sh-class)\\\\\\"\\u003eUint8Array\\u003c/span\\u003e\\u003c/span\\u003e\\"}}\],\\" call is needed so your data get the proper encoding. I am serving binary files here, for text file you may want to use \\",\[\\"$\\",\\"a\\",null,{\\"target\\":\\"\_blank\\",\\"rel\\":\\"noopener noreferrer\\",\\"href\\":\\"https://developer.mozilla.org/en-US/docs/Web/API/TextEncoder\\",\\"children\\":\\"TextEncoder\\"}\],\\" instead. See \\",\[\\"$\\",\\"a\\",null,{\\"target\\":\\"\_blank\\",\\"rel\\":\\"noopener noreferrer\\",\\"href\\":\\"https://github.com/vercel/next.js/issues/38736\\",\\"children\\":\\"this GitHub ticket\\"}\],\\" for more info.\\"\]}\],\\"\\\\n\\",\[\\"$\\",\\"blockquote\\",null,{\\"children\\":\[\\"\\\\n\\",\[\\"$\\",\\"p\\",null,{\\"children\\":\[\\"In Node.js, streams are meant to be consumed primarily via events. According to Node.js documentation, setting a \\\\\\"data\\\\\\" event handler on a stream will make it flowing. You can also use the \\",\[\\"$\\",\\"code\\",null,{\\"dangerouslySetInnerHTML\\":{\\"\_\_html\\":\\"\\u003cspan class=\\\\\\"sh\_\_line\\\\\\"\\u003e\\u003cspan class=\\\\\\"sh\_\_token--identifier\\\\\\" style=\\\\\\"color: var(--sh-identifier)\\\\\\"\\u003epipe\\u003c/span\\u003e\\u003c/span\\u003e\\"}}\],\\" method as demonstrate earlier. This explains why the iterator version is less common in the wild, yet it's better suited for our goal.\\"\]}\],\\"\\\\n\\"\]}\],\\"\\\\n\\",\[\\"$\\",\\"h3\\",null,{\\"id\\":\\"step-2-from-iterator-to-readablestream\\",\\"children\\":\[\[\[\\"$\\",\\"a\\",\\"link-step-2-from-iterator-to-readablestream\\",{\\"href\\":\\"#step-2-from-iterator-to-readablestream\\",\\"className\\":\\"anchor\\"}\]\],\\"Step 2: from iterator to ReadableStream\\"\]}\],\\"\\\\n\\",\[\\"$\\",\\"p\\",null,{\\"children\\":\[\\"Now that we have an iterator, \\",\[\\"$\\",\\"a\\",null,{\\"target\\":\\"\_blank\\",\\"rel\\":\\"noopener noreferrer\\",\\"href\\":\\"https://developer.mozilla.org/en-US/docs/Web/API/ReadableStream#convert\_async\_iterator\_to\_stream\\",\\"children\\":\\"Mozilla documentation\\"}\],\\" shows us how to convert it into a web platform \\",\[\\"$\\",\\"code\\",null,{\\"dangerouslySetInnerHTML\\":{\\"\_\_html\\":\\"\\u003cspan class=\\\\\\"sh\_\_line\\\\\\"\\u003e\\u003cspan class=\\\\\\"sh\_\_token--class\\\\\\" style=\\\\\\"color: var(--sh-class)\\\\\\"\\u003eReadableStream\\u003c/span\\u003e\\u003c/span\\u003e\\"}}\],\\":\\"\]}\],\\"\\\\n\\",\[\\"$\\",\\"pre\\",null,{\\"children\\":\[\\"$\\",\\"code\\",null,{\\"dangerouslySetInnerHTML\\":{\\"\_\_html\\":\\"$29\\"},\\"className\\":\\"language-ts\\"}\]}\],\\"\\\\n\\",\[\\"$\\",\\"h3\\",null,{\\"id\\":\\"plugging-the-functions-together\\",\\"children\\":\[\[\[\\"$\\",\\"a\\",\\"link-plugging-the-functions-together\\",{\\"href\\":\\"#plugging-the-functions-together\\",\\"className\\":\\"anchor\\"}\]\],\\"Plugging the functions together\\"\]}\],\\"\\\\n\\",\[\\"$\\",\\"p\\",null,{\\"children\\":\\"So, we can convert a Node.js stream into an iterator, and an iterator into a web platform ReadableStream.\\"}\],\\"\\\\n\\",\[\\"$\\",\\"p\\",null,{\\"children\\":\[\\"We are ready to craft our \\",\[\\"$\\",\\"code\\",null,{\\"dangerouslySetInnerHTML\\":{\\"\_\_html\\":\\"\\u003cspan class=\\\\\\"sh\_\_line\\\\\\"\\u003e\\u003cspan class=\\\\\\"sh\_\_token--identifier\\\\\\" style=\\\\\\"color: var(--sh-identifier)\\\\\\"\\u003estreamFile\\u003c/span\\u003e\\u003c/span\\u003e\\"}}\],\\" function,\\\\nusable in Route Handlers!\\"\]}\],\\"\\\\n\\",\[\\"$\\",\\"pre\\",null,{\\"children\\":\[\\"$\\",\\"code\\",null,{\\"dangerouslySetInnerHTML\\":{\\"\_\_html\\":\\"$2a\\"},\\"className\\":\\"language-ts\\"}\]}\],\\"\\\\n\\",\[\\"$\\",\\"p\\",null,{\\"children\\":\[\\"You may notice that \\",\[\\"$\\",\\"code\\",null,{\\"dangerouslySetInnerHTML\\":{\\"\_\_html\\":\\"\\u003cspan class=\\\\\\"sh\_\_line\\\\\\"\\u003e\\u003cspan class=\\\\\\"sh\_\_token--identifier\\\\\\" style=\\\\\\"color: var(--sh-identifier)\\\\\\"\\u003ecreateReadStream\\u003c/span\\u003e\\u003c/span\\u003e\\"}}\],\\" is a Node.js function, so this code works only in Node.js despite returning a generic ReadableStream. It's not compatible with the Edge runtime.\\"\]}\],\\"\\\\n\\",\[\\"$\\",\\"p\\",null,{\\"children\\":\\"That's completely normal. Route Handlers are meant to be compatible with different runtimes, however you still have to write runtime specific code anytime you actually want to do a non-trivial operation. If you use Deno, you will have Deno specific code.\\"}\],\\"\\\\n\\",\[\\"$\\",\\"p\\",null,{\\"children\\":\[\\"Ideally, JavaScript would provide a generic function for opening files, that would return a  \\",\[\\"$\\",\\"code\\",null,{\\"dangerouslySetInnerHTML\\":{\\"\_\_html\\":\\"\\u003cspan class=\\\\\\"sh\_\_line\\\\\\"\\u003e\\u003cspan class=\\\\\\"sh\_\_token--class\\\\\\" style=\\\\\\"color: var(--sh-class)\\\\\\"\\u003eReadableStream\\u003c/span\\u003e\\u003c/span\\u003e\\"}}\],\\" out of the box. However I am not aware of such an API. Ping me on \\",\[\\"$\\",\\"a\\",null,{\\"target\\":\\"\_blank\\",\\"rel\\":\\"noopener noreferrer\\",\\"href\\":\\"https://twitter.com/ericbureltech\\",\\"children\\":\\"Twitter\\"}\],\\" if you have more info than I do!\\"\]}\],\\"\\\\n\\",\[\\"$\\",\\"h2\\",null,{\\"id\\":\\"serving-the-file-using-a-route-handler\\",\\"children\\":\[\[\[\\"$\\",\\"a\\",\\"link-serving-the-file-using-a-route-handler\\",{\\"href\\":\\"#serving-the-file-using-a-route-handler\\",\\"className\\":\\"anchor\\"}\]\],\\"Serving the file, using a Route Handler\\"\]}\],\\"\\\\n\\",\[\\"$\\",\\"p\\",null,{\\"children\\":\\"We've been so far into advanced JavaScript that we almost forgot the initial goal: we just wanted to stream a file in a route handler, to let the end user download something!\\"}\],\\"\\\\n\\",\[\\"$\\",\\"p\\",null,{\\"children\\":\[\\"Obtaining a \\",\[\\"$\\",\\"code\\",null,{\\"dangerouslySetInnerHTML\\":{\\"\_\_html\\":\\"\\u003cspan class=\\\\\\"sh\_\_line\\\\\\"\\u003e\\u003cspan class=\\\\\\"sh\_\_token--class\\\\\\" style=\\\\\\"color: var(--sh-class)\\\\\\"\\u003eReadableStream\\u003c/span\\u003e\\u003c/span\\u003e\\"}}\],\\" was the hardest part, now we just have to pass it to the \\",\[\\"$\\",\\"code\\",null,{\\"dangerouslySetInnerHTML\\":{\\"\_\_html\\":\\"\\u003cspan class=\\\\\\"sh\_\_line\\\\\\"\\u003e\\u003cspan class=\\\\\\"sh\_\_token--class\\\\\\" style=\\\\\\"color: var(--sh-class)\\\\\\"\\u003eResponse\\u003c/span\\u003e\\u003c/span\\u003e\\"}}\],\\" object:\\"\]}\],\\"\\\\n\\",\[\\"$\\",\\"pre\\",null,{\\"children\\":\[\\"$\\",\\"code\\",null,{\\"dangerouslySetInnerHTML\\":{\\"\_\_html\\":\\"$2b\\"},\\"className\\":\\"language-ts\\"}\]}\],\\"\\\\n\\",\[\\"$\\",\\"p\\",null,{\\"children\\":\[\\"You can see a real-file example usage in the \\",\[\\"$\\",\\"a\\",null,{\\"target\\":\\"\_blank\\",\\"rel\\":\\"noopener noreferrer\\",\\"href\\":\\"https://github.com/Devographics/Monorepo/blob/e1179268188111380ccaaa0a134318273d9f6594/surveyadmin/src/app/api/data-export/route.ts\\",\\"children\\":\\"State of JavaScript codebase\\"}\],\\", to download a CSV+JSON zip out of a Mongo database.\\"\]}\],\\"\\\\n\\",\[\\"$\\",\\"h2\\",null,{\\"id\\":\\"recap-and-conclusion\\",\\"children\\":\[\[\[\\"$\\",\\"a\\",\\"link-recap-and-conclusion\\",{\\"href\\":\\"#recap-and-conclusion\\",\\"className\\":\\"anchor\\"}\]\],\\"Recap and conclusion\\"\]}\],\\"\\\\n\\",\[\\"$\\",\\"p\\",null,{\\"children\\":\\"Let's try to recap what we have learnt in this article:\\"}\],\\"\\\\n\\",\[\\"$\\",\\"ul\\",null,{\\"children\\":\[\\"\\\\n\\",\[\\"$\\",\\"li\\",null,{\\"children\\":\\"Serving files via an API endpoint is necessary for custom, private or generated files\\"}\],\\"\\\\n\\",\[\\"$\\",\\"li\\",null,{\\"children\\":\\"Using a stream is necessary to avoid bloating your server RAM, it avoids loading the whole file in memory and instead returns it as chunks\\"}\],\\"\\\\n\\",\[\\"$\\",\\"li\\",null,{\\"children\\":\\"Next.js API routes are using Node.js syntax and data structure, it's easy to stream a file\\"}\],\\"\\\\n\\",\[\\"$\\",\\"li\\",null,{\\"children\\":\[\\"Next.js Route handlers strive to rely on more generic JavaScript built-in structures, namely the \\",\[\\"$\\",\\"code\\",null,{\\"dangerouslySetInnerHTML\\":{\\"\_\_html\\":\\"\\u003cspan class=\\\\\\"sh\_\_line\\\\\\"\\u003e\\u003cspan class=\\\\\\"sh\_\_token--class\\\\\\" style=\\\\\\"color: var(--sh-class)\\\\\\"\\u003eRequest\\u003c/span\\u003e\\u003c/span\\u003e\\"}}\],\\" and \\",\[\\"$\\",\\"code\\",null,{\\"dangerouslySetInnerHTML\\":{\\"\_\_html\\":\\"\\u003cspan class=\\\\\\"sh\_\_line\\\\\\"\\u003e\\u003cspan class=\\\\\\"sh\_\_token--class\\\\\\" style=\\\\\\"color: var(--sh-class)\\\\\\"\\u003eResponse\\u003c/span\\u003e\\u003c/span\\u003e\\"}}\],\\" objects from the fetch API\\"\]}\],\\"\\\\n\\",\[\\"$\\",\\"li\\",null,{\\"children\\":\[\\"We had to craft an helper to convert the stream produced by \\",\[\\"$\\",\\"code\\",null,{\\"dangerouslySetInnerHTML\\":{\\"\_\_html\\":\\"\\u003cspan class=\\\\\\"sh\_\_line\\\\\\"\\u003e\\u003cspan class=\\\\\\"sh\_\_token--identifier\\\\\\" style=\\\\\\"color: var(--sh-identifier)\\\\\\"\\u003efs\\u003c/span\\u003e\\u003cspan class=\\\\\\"sh\_\_token--sign\\\\\\" style=\\\\\\"color: var(--sh-sign)\\\\\\"\\u003e.\\u003c/span\\u003e\\u003cspan class=\\\\\\"sh\_\_token--identifier\\\\\\" style=\\\\\\"color: var(--sh-identifier)\\\\\\"\\u003ecreateReadStream\\u003c/span\\u003e\\u003cspan class=\\\\\\"sh\_\_token--sign\\\\\\" style=\\\\\\"color: var(--sh-sign)\\\\\\"\\u003e(\\u003c/span\\u003e\\u003cspan class=\\\\\\"sh\_\_token--identifier\\\\\\" style=\\\\\\"color: var(--sh-identifier)\\\\\\"\\u003efilePath\\u003c/span\\u003e\\u003cspan class=\\\\\\"sh\_\_token--sign\\\\\\" style=\\\\\\"color: var(--sh-sign)\\\\\\"\\u003e)\\u003c/span\\u003e\\u003c/span\\u003e\\"}}\],\\" , which is specific to Node.js, into a generic \\",\[\\"$\\",\\"code\\",null,{\\"dangerouslySetInnerHTML\\":{\\"\_\_html\\":\\"\\u003cspan class=\\\\\\"sh\_\_line\\\\\\"\\u003e\\u003cspan class=\\\\\\"sh\_\_token--class\\\\\\" style=\\\\\\"color: var(--sh-class)\\\\\\"\\u003eReadableStream\\u003c/span\\u003e\\u003c/span\\u003e\\"}}\]\]}\],\\"\\\\n\\",\[\\"$\\",\\"li\\",null,{\\"children\\":\[\\"Finally, we can pass the converted stream to the \\",\[\\"$\\",\\"code\\",null,{\\"dangerouslySetInnerHTML\\":{\\"\_\_html\\":\\"\\u003cspan class=\\\\\\"sh\_\_line\\\\\\"\\u003e\\u003cspan class=\\\\\\"sh\_\_token--class\\\\\\" style=\\\\\\"color: var(--sh-class)\\\\\\"\\u003eResponse\\u003c/span\\u003e\\u003c/span\\u003e\\"}}\],\\" object. Tada!\\"\]}\],\\"\\\\n\\"\]}\],\\"\\\\n\\",\[\\"$\\",\\"p\\",null,{\\"children\\":\[\\"Thanks \\",\[\\"$\\",\\"a\\",null,{\\"target\\":\\"\_blank\\",\\"rel\\":\\"noopener noreferrer\\",\\"href\\":\\"https://github.com/rohithandique\\",\\"children\\":\\"@rohithandique\\"}\],\\" for the feedback \\",\[\\"$\\",\\"a\\",null,{\\"target\\":\\"\_blank\\",\\"rel\\":\\"noopener noreferrer\\",\\"href\\":\\"https://github.com/vercel/next.js/discussions/15453#discussioncomment-6565699\\",\\"children\\":\\"on Next.js GitHub\\"}\],\\"\\\\nand the many people whose code I had to copy paste and merge to produce this beauty.\\"\]}\],\\"\\\\n\\",\[\\"$\\",\\"h2\\",null,{\\"id\\":\\"bonus\\",\\"children\\":\[\[\[\\"$\\",\\"a\\",\\"link-bonus\\",{\\"href\\":\\"#bonus\\",\\"className\\":\\"anchor\\"}\]\],\\"Bonus\\"\]}\],\\"\\\\n\\",\[\\"$\\",\\"p\\",null,{\\"children\\":\[\\"As a final experiment, I've also tried to convert \\",\[\\"$\\",\\"code\\",null,{\\"dangerouslySetInnerHTML\\":{\\"\_\_html\\":\\"\\u003cspan class=\\\\\\"sh\_\_line\\\\\\"\\u003e\\u003cspan class=\\\\\\"sh\_\_token--class\\\\\\" style=\\\\\\"color: var(--sh-class)\\\\\\"\\u003eRequest\\u003c/span\\u003e\\u003c/span\\u003e\\"}}\],\\" to \\",\[\\"$\\",\\"code\\",null,{\\"dangerouslySetInnerHTML\\":{\\"\_\_html\\":\\"\\u003cspan class=\\\\\\"sh\_\_line\\\\\\"\\u003e\\u003cspan class=\\\\\\"sh\_\_token--class\\\\\\" style=\\\\\\"color: var(--sh-class)\\\\\\"\\u003eNextAPIRequest\\u003c/span\\u003e\\u003c/span\\u003e\\"}}\],\\", in order to be able to reuse Express/Connect logic in route handlers, which would enable using Passport namely. If you are interested, you can contribute to this GitHub issue on \\",\[\\"$\\",\\"a\\",null,{\\"target\\":\\"\_blank\\",\\"rel\\":\\"noopener noreferrer\\",\\"href\\":\\"https://github.com/hoangvvo/next-connect/issues/228\\",\\"children\\":\\"the next-connect project\\"}\],\\".\\"\]}\],\\"\\\\n\\",\[\\"$\\",\\"p\\",null,{\\"children\\":\[\\"If you want to learn more about streams in Next.js, I recommend this article from \\",\[\\"$\\",\\"a\\",null,{\\"target\\":\\"\_blank\\",\\"rel\\":\\"noopener noreferrer\\",\\"href\\":\\"https://minimalistweb.dev/p/streams-and-react-server-components\\",\\"children\\":\\"Mohammad (Minimalist Web Dev)\\"}\],\\". It explains how stream are used by React Server Components to deliver HTML progressively.\\"\]}\]\]\\n"\])self.\_\_next\_f.push(\[1,"1e:\[\\"$\\",\\"$2c\\",\\"16M1bzlVOguXVUbvk6Z69\\",{\\"children\\":\[\[\\"$\\",\\"meta\\",\\"0\\",{\\"name\\":\\"viewport\\",\\"content\\":\\"width=device-width, initial-scale=1\\"}\],\[\\"$\\",\\"meta\\",\\"1\\",{\\"charSet\\":\\"utf-8\\"}\],\[\\"$\\",\\"title\\",\\"2\\",{\\"children\\":\\"How to stream files from Next.js Route Handlers | Eric Burel Tech Blog\\"}\],\[\\"$\\",\\"meta\\",\\"3\\",{\\"name\\":\\"description\\",\\"content\\":\\"Learn how the Route Handlers paradigm affects file streaming in Next.js\\"}\],\[\\"$\\",\\"meta\\",\\"4\\",{\\"name\\":\\"robots\\",\\"content\\":\\"index, follow\\"}\],\[\\"$\\",\\"meta\\",\\"5\\",{\\"name\\":\\"googlebot\\",\\"content\\":\\"index, follow, max-video-preview:-1, max-image-preview:large, max-snippet:-1\\"}\],\[\\"$\\",\\"link\\",\\"6\\",{\\"rel\\":\\"canonical\\",\\"href\\":\\"https://www.ericburel.tech/blog/nextjs-stream-files\\"}\],\[\\"$\\",\\"link\\",\\"7\\",{\\"rel\\":\\"alternate\\",\\"hrefLang\\":\\"fr\\",\\"href\\":\\"https://www.formationnextjs.fr/ressources/route-handlers-et-fichiers\\"}\],\[\\"$\\",\\"meta\\",\\"8\\",{\\"property\\":\\"og:title\\",\\"content\\":\\"How to stream files from Next.js Route Handlers\\"}\],\[\\"$\\",\\"meta\\",\\"9\\",{\\"property\\":\\"og:description\\",\\"content\\":\\"Learn how the Route Handlers paradigm affects file streaming in Next.js\\"}\],\[\\"$\\",\\"meta\\",\\"10\\",{\\"property\\":\\"og:url\\",\\"content\\":\\"https://www.ericburel.tech/blog/nextjs-stream-files\\"}\],\[\\"$\\",\\"meta\\",\\"11\\",{\\"property\\":\\"og:image\\",\\"content\\":\\"https://www.ericburel.tech/posts/nextjs-stream-files/filestream.png\\"}\],\[\\"$\\",\\"meta\\",\\"12\\",{\\"property\\":\\"og:type\\",\\"content\\":\\"article\\"}\],\[\\"$\\",\\"meta\\",\\"13\\",{\\"property\\":\\"article:published\_time\\",\\"content\\":\\"2024-01-31\\"}\],\[\\"$\\",\\"meta\\",\\"14\\",{\\"name\\":\\"twitter:card\\",\\"content\\":\\"summary\_large\_image\\"}\],\[\\"$\\",\\"meta\\",\\"15\\",{\\"name\\":\\"twitter:title\\",\\"content\\":\\"How to stream files from Next.js Route Handlers\\"}\],\[\\"$\\",\\"meta\\",\\"16\\",{\\"name\\":\\"twitter:description\\",\\"content\\":\\"Learn how the Route Handlers paradigm affects file streaming in Next.js\\"}\],\[\\"$\\",\\"meta\\",\\"17\\",{\\"name\\":\\"twitter:image\\",\\"content\\":\\"https://www.ericburel.tech/posts/nextjs-stream-files/filestream.png\\"}\],\[\\"$\\",\\"link\\",\\"18\\",{\\"rel\\":\\"icon\\",\\"href\\":\\"/favicon.ico\\",\\"type\\":\\"image/x-icon\\",\\"sizes\\":\\"49x49\\"}\],\[\\"$\\",\\"meta\\",\\"19\\",{\\"name\\":\\"next-size-adjust\\"}\]\]}\]\\n8:null\\n"\])self.\_\_next\_f.push(\[1,"19:\[\\"$\\",\\"p\\",null,{\\"className\\":\\"text-neutral-600 dark:text-neutral-400 mb-0\\",\\"children\\":\\"14,570 views\\"}\]\\n18:\[\\"$\\",\\"p\\",null,{\\"className\\":\\"text-neutral-600 dark:text-neutral-400 mb-0\\",\\"children\\":\\"12,895 views\\"}\]\\n17:\[\\"$\\",\\"p\\",null,{\\"className\\":\\"text-neutral-600 dark:text-neutral-400 mb-0\\",\\"children\\":\\"5,695 views\\"}\]\\n16:\[\\"$\\",\\"p\\",null,{\\"className\\":\\"text-neutral-600 dark:text-neutral-400 mb-0\\",\\"children\\":\\"1,416 views\\"}\]\\n15:\[\\"$\\",\\"p\\",null,{\\"className\\":\\"text-neutral-600 dark:text-neutral-400 mb-0\\",\\"children\\":\\"599 views\\"}\]\\n14:\[\\"$\\",\\"p\\",null,{\\"className\\":\\"text-neutral-600 dark:text-neutral-400 mb-0\\",\\"children\\":\\"508 views\\"}\]\\n13:\[\\"$\\",\\"p\\",null,{\\"className\\":\\"text-neutral-600 dark:text-neutral-400 mb-0\\",\\"children\\":\\"391 views\\"}\]\\n12:\[\\"$\\",\\"p\\",null,{\\"className\\":\\"text-neutral-600 dark:text-neutral-400 mb-0\\",\\"children\\":\\"290 views\\"}\]\\na:\[\\"$\\",\\"p\\",null,{\\"className\\":\\"text-neutral-600 dark:text-neutral-400 mb-0\\",\\"children\\":\\"14,574 views\\"}\]\\n"\])

14,574 views

$RC=function(b,c,e){c=document.getElementById(c);c.parentNode.removeChild(c);var a=document.getElementById(b);if(a){b=a.previousSibling;if(e)b.data="$!",a.setAttribute("data-dgst",e);else{e=b.parentNode;a=b.nextSibling;var f=0;do{if(a&&8===a.nodeType){var d=a.data;if("/$"===d)if(0===f)break;else f--;else"$"!==d&&"$?"!==d&&"$!"!==d||f++}d=a.nextSibling;e.removeChild(a);a=d}while(a);for(;c.firstChild;)e.insertBefore(c.firstChild,a);b.data="$"}b.\_reactRetry&&b.\_reactRetry()}};$RC("B:1","S:1")